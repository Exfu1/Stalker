(function (plugin, vendetta, metro, patcher, common, ui, assets, toasts, storage, components) { "use strict"; var findByStoreName = metro.findByStoreName, findByProps = metro.findByProps; var React = common.React, ReactNative = common.ReactNative; var View = (components.General || findByProps("View", "Text")).View; var Text = (components.General || findByProps("View", "Text")).Text; var Forms = components.Forms || findByProps("FormSection", "FormRow"); var FormSection = Forms.FormSection, FormRow = Forms.FormRow, FormDivider = Forms.FormDivider; var getAssetIDByName = assets.getAssetIDByName; var showToast = toasts.showToast; var UserStore = findByStoreName("UserStore"); var GuildStore = findByStoreName("GuildStore"); var ChannelStore = findByStoreName("ChannelStore"); var MessageStore = findByStoreName("MessageStore"); var GuildMemberStore = findByStoreName("GuildMemberStore"); var patches = []; function getMutualGuilds(userId) { var guilds = GuildStore ? Object.values(GuildStore.getGuilds() || {}) : [], mutual = []; for (var i = 0; i < guilds.length; i++) { var member = GuildMemberStore ? GuildMemberStore.getMember(guilds[i].id, userId) : null; if (member) mutual.push(guilds[i]) } return mutual } function findRecentMessages(userId, mutualGuilds) { var results = []; for (var i = 0; i < mutualGuilds.length; i++) { var guild = mutualGuilds[i]; try { var channels = ChannelStore ? Object.values(ChannelStore.getChannels?.() || ChannelStore.getMutableGuildChannels?.() || {}) : []; var textChannels = channels.filter(function (c) { return c.guild_id === guild.id && c.type === 0 }); for (var j = 0; j < textChannels.length; j++) { var channel = textChannels[j]; var messages = MessageStore ? MessageStore.getMessages(channel.id) : null; if (messages && messages._array) { var userMsgs = messages._array.filter(function (m) { return m.author && m.author.id === userId }); for (var k = 0; k < Math.min(userMsgs.length, 3); k++) { results.push({ id: userMsgs[k].id, content: (userMsgs[k].content || "").substring(0, 50), channel: channel.name, guild: guild.name }) } } } } catch (e) { } } return results.slice(0, 10) } plugin.onLoad = function () { try { var UserProfile = findByProps("UserProfileSection"); if (UserProfile && UserProfile.default) { patches.push(patcher.after("default", UserProfile, function (args, res) { var userId = args[0] ? args[0].userId : null; if (!userId) return res; var currentUser = UserStore ? UserStore.getCurrentUser() : null; if (currentUser && userId === currentUser.id) return res; if (res && res.props && res.props.children && Array.isArray(res.props.children)) { var mutualGuilds = getMutualGuilds(userId); var stalkerSection = React.createElement(FormSection, { key: "stalker-pro", title: "ðŸ” Stalker Pro" }, [React.createElement(FormRow, { key: "recent", label: "Recent Messages", subLabel: "Find their messages across servers", trailing: FormRow.Arrow ? React.createElement(FormRow.Arrow, null) : null, onPress: function () { var msgs = findRecentMessages(userId, mutualGuilds); showToast("Found " + msgs.length + " messages", getAssetIDByName("Check")) } }), React.createElement(FormDivider, { key: "div" }), React.createElement(FormRow, { key: "hidden", label: "Hidden Channels", subLabel: "Channels they can see but you can't", trailing: FormRow.Arrow ? React.createElement(FormRow.Arrow, null) : null, onPress: function () { showToast("Checking " + mutualGuilds.length + " servers", getAssetIDByName("Check")) } })]); res.props.children.push(stalkerSection) } return res })) } showToast("Stalker Pro loaded!", getAssetIDByName("Check")) } catch (e) { console.error("Stalker Pro:", e) } }; plugin.onUnload = function () { for (var i = 0; i < patches.length; i++) { if (patches[i]) patches[i]() } }; return plugin })({}, vendetta, vendetta.metro, vendetta.patcher, vendetta.metro.common, vendetta.ui, vendetta.ui.assets, vendetta.ui.toasts, vendetta.storage, vendetta.ui.components);
