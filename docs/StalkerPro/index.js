(function(m,g,r,n,D,l,u){"use strict";var E,T;const{FormSection:I,FormRow:h,FormInput:k,FormDivider:X}=D.Forms,{ScrollView:U,View:Y,Text:Z,TouchableOpacity:J,ActivityIndicator:Q,Modal:ee,Dimensions:N}=D.General;(E=N?.get)!=null&&E.call(N,"window");const y=r.findByStoreName("UserStore"),v=r.findByStoreName("GuildStore"),B=r.findByStoreName("GuildMemberStore"),F=r.findByStoreName("ChannelStore");r.findByStoreName("SelectedGuildStore"),r.findByStoreName("PermissionStore");const o=((T=n.ReactNative)==null?void 0:T.Clipboard)||r.findByProps("setString","getString"),b=r.findByProps("getAPIBaseURL","get")||r.findByProps("API_HOST","get");r.findByProps("jumpToMessage"),r.findByProps("VIEW_CHANNEL","SEND_MESSAGES");let p="",w=!1,C="",A=null;function L(e){if(!v||!B)return[];try{return Object.values(v.getGuilds()||{}).filter(function(t){return B.getMember(t.id,e)})}catch{return[]}}async function P(e,t){var c;if(!(b!=null&&b.get))return[];try{const a=await b.get({url:`/guilds/${e}/messages/search`,query:{author_id:t,include_nsfw:!0}});return(((c=a?.body)==null?void 0:c.messages)||[]).map(function(i){return{id:i[0].id,content:i[0].content||"[No text]",channelId:i[0].channel_id,guildId:e,timestamp:i[0].timestamp}})}catch{return[]}}function G(e){var t;return((t=F?.getChannel(e))==null?void 0:t.name)||"unknown"}function M(e){var t;return((t=v?.getGuild(e))==null?void 0:t.name)||"Unknown"}function $(e){const t=y?.getUser(e);return t?{username:t.username,globalName:t.globalName,id:t.id}:null}function H(e){return e?/^\d{17,19}$/.test(e.trim()):!1}async function R(e){var t;const c=(t=y?.getCurrentUser)==null?void 0:t.call(y);if(c&&e===c.id)return;const a=L(e),i=$(e);if(a.length===0){u.showToast("\u274C No mutual servers",l.getAssetIDByName("Small"));return}const q=i?.globalName||i?.username||`User ${e.slice(-4)}`;u.showToast(`\u{1F50D} Searching ${q}...`,l.getAssetIDByName("ic_search"));let f=[];for(let s=0;s<Math.min(a.length,8);s++){try{const d=await P(a[s].id,e);f.push(...d)}catch{}s<a.length-1&&await new Promise(function(d){return setTimeout(d,250)})}if(f.sort(function(s,d){return new Date(d.timestamp).getTime()-new Date(s.timestamp).getTime()}),f.length===0){u.showToast("\u{1F4ED} No messages found",l.getAssetIDByName("Small"));return}u.showToast(`\u2705 Found ${f.length} messages!`,l.getAssetIDByName("Check"));const S=f[0],x=G(S.channelId),W=M(S.guildId),z=`https://discord.com/channels/${S.guildId}/${S.channelId}/${S.id}`;setTimeout(function(){u.showToast(`\u{1F4CD} #${x} in ${W}`,l.getAssetIDByName("ic_message"))},1500),setTimeout(async function(){try{o!=null&&o.setString&&(o.setString(z),u.showToast("\u{1F4CB} Link copied!",l.getAssetIDByName("Check")))}catch(s){g.logger.error("Copy failed:",s)}},3e3)}async function O(){try{if(!(o!=null&&o.getString))return;const e=await o.getString();if(e&&e!==C&&H(e)){C=e;const t=e.trim();u.showToast("\u{1F3AF} User ID detected!",l.getAssetIDByName("Check")),setTimeout(function(){return R(t)},1e3)}}catch(e){g.logger.error("Clipboard error:",e)}}function _(){const[e,t]=n.React.useState(p),[c,a]=n.React.useState(!1),i=async function(){if(!e||e.length<17){u.showToast("Invalid User ID",l.getAssetIDByName("Small"));return}a(!0),p=e,await R(e),a(!1)};return n.React.createElement(U,{style:{flex:1,backgroundColor:"#1e1f22"}},[n.React.createElement(I,{key:"info",title:"\u{1F4F1} STALKER PRO v3.0"},[n.React.createElement(h,{key:"v1",label:"\u{1F512} Hidden Channel Detector",subLabel:"Tap the floating \u{1F512} button anywhere!"}),n.React.createElement(h,{key:"v2",label:"\u{1F4CB} Auto Message Search",subLabel:"Copy any User ID to auto-search"})]),n.React.createElement(I,{key:"search",title:"\u{1F50D} MANUAL SEARCH"},[n.React.createElement(k,{key:"in",title:"User ID",placeholder:"Enter User ID",value:e,onChangeText:t,keyboardType:"numeric"}),n.React.createElement(h,{key:"btn",label:c?"\u23F3 Searching...":"\u{1F50D} Search",onPress:c?void 0:i})]),n.React.createElement(I,{key:"status",title:"\u2699\uFE0F STATUS"},[n.React.createElement(h,{key:"s1",label:"Clipboard Monitor",subLabel:w?"\u2705 Active":"\u274C Inactive"}),n.React.createElement(h,{key:"s2",label:"Hidden Channel FAB",subLabel:"\u2705 Active"})])])}const K=_,V=function(){g.logger.log("=== STALKER PRO v3.0 LOADING ==="),o!=null&&o.getString&&(w=!0,A=setInterval(O,2e3));try{u.showToast("\u{1F512} Stalker Pro v3.0 ready!",l.getAssetIDByName("Check")),u.showToast("Tap \u{1F512} button for Hidden Channels",l.getAssetIDByName("Arrow"))}catch(e){g.logger.error("FAB setup failed:",e)}},j=function(){g.logger.log("=== STALKER PRO UNLOADING ==="),A&&(clearInterval(A),A=null,w=!1)};return m.onLoad=V,m.onUnload=j,m.settings=K,m})({},vendetta,vendetta.metro,vendetta.metro.common,vendetta.ui.components,vendetta.ui.assets,vendetta.ui.toasts);
