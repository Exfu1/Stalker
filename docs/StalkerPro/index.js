(function(z,f,v,e,V,y,h){"use strict";var q;const{FormSection:M,FormRow:B,FormInput:J,FormDivider:ve,FormSwitchRow:Ee}=V.Forms,{ScrollView:ne,View:A,Text:c,TouchableOpacity:L,ActivityIndicator:ke}=V.General,D=v.findByStoreName("UserStore"),E=v.findByStoreName("GuildStore"),U=v.findByStoreName("GuildMemberStore"),b=v.findByStoreName("ChannelStore"),T=v.findByStoreName("SelectedGuildStore"),G=v.findByStoreName("PermissionStore"),O=v.findByStoreName("GuildChannelStore"),I=((q=e.ReactNative)==null?void 0:q.Clipboard)||v.findByProps("setString","getString"),x=v.findByProps("getAPIBaseURL","get")||v.findByProps("API_HOST","get"),K=1024;let W=!1,Q="",P=null;function X(t){switch(t){case 0:return"\u{1F4AC}";case 2:return"\u{1F50A}";case 4:return"\u{1F4C1}";case 5:return"\u{1F4E2}";case 13:return"\u{1F3AD}";case 15:return"\u{1F4CB}";default:return"\u{1F4DD}"}}function Y(t){var a,g,i,o;const s=[];try{f.logger.log("=== SCANNING FOR HIDDEN CHANNELS ==="),f.logger.log("Guild ID:",t);let r=[];if(O!=null&&O.getChannels){const n=O.getChannels(t);if(f.logger.log("GuildChannelStore.getChannels result:",JSON.stringify(Object.keys(n||{}))),n)for(const d of Object.keys(n)){const S=n[d];if(Array.isArray(S))for(const N of S){const u=N?.channel||N;u&&u.id&&r.push(u)}}}if(r.length===0){const n=((a=b?.getGuildChannelsVersion)==null?void 0:a.call(b,t))||((g=b?.getMutableGuildChannels)==null?void 0:g.call(b))||{};r=Object.values(n).filter(function(d){return d?.guild_id===t})}f.logger.log("Total channels found:",r.length);for(const n of r){if(!n||!n.id||n.type===4||n.type===11||n.type===12)continue;let d=!0;if(G!=null&&G.can)try{d=G.can(K,n)}catch{}if(!d){const S=re(n,t);s.push({id:n.id,name:n.name||"unknown",type:n.type||0,parentName:n.parent_id&&((o=(i=b?.getChannel)==null?void 0:i.call(b,n.parent_id))==null?void 0:o.name)||"",rolesWithAccess:S})}}f.logger.log("Hidden channels found:",s.length)}catch(r){f.logger.error("Error scanning channels:",r)}return s.sort(function(r,n){return r.name.localeCompare(n.name)})}function re(t,a){var g,i;const o=[];try{const s=t.permissionOverwrites||{},r=(g=E?.getGuild)==null?void 0:g.call(E,a);for(const[n,d]of Object.entries(s))if(d&&Number(d.allow||0)&K&&(d.type===0||d.type==="role")){const S=(i=r?.roles)==null?void 0:i[n];S&&S.name!=="@everyone"&&o.push({id:S.id,name:S.name,color:S.color||0})}}catch{}return o}function le(t,a){var g;const i=Y(t),o=(g=U?.getMember)==null?void 0:g.call(U,t,a);return o!=null&&o.roles?i.filter(function(s){return s.rolesWithAccess.some(function(r){return o.roles.includes(r.id)})}):[]}function ae(t){if(!E||!U)return[];try{return Object.values(E.getGuilds()||{}).filter(function(a){return U.getMember(a.id,t)})}catch{return[]}}async function ie(t,a){var g;if(!(x!=null&&x.get))return[];try{const i=await x.get({url:`/guilds/${t}/messages/search`,query:{author_id:a,include_nsfw:!0,sort_by:"timestamp",sort_order:"desc"}}),o=(((g=i?.body)==null?void 0:g.messages)||[]).map(function(s){return{id:s[0].id,content:s[0].content||"[No text]",channelId:s[0].channel_id,guildId:t,timestamp:s[0].timestamp}});return f.logger.log(`Found ${o.length} messages in guild ${t}`),o}catch(i){return f.logger.error("Search error:",i),[]}}function oe(t){var a;return((a=b?.getChannel(t))==null?void 0:a.name)||"unknown"}function ce(t){var a;return((a=E?.getGuild(t))==null?void 0:a.name)||"Unknown"}function ue(t){const a=D?.getUser(t);return a?{username:a.username,globalName:a.globalName,id:a.id}:null}function se(t){return t?/^\d{17,19}$/.test(t.trim()):!1}async function Z(t){var a;const g=(a=D?.getCurrentUser)==null?void 0:a.call(D);if(g&&t===g.id)return;const i=ae(t),o=ue(t);if(i.length===0){h.showToast("\u274C No mutual servers",y.getAssetIDByName("Small"));return}const s=o?.globalName||o?.username||"User";h.showToast(`\u{1F50D} Searching ${s}...`,y.getAssetIDByName("ic_search"));let r=[];for(let u=0;u<Math.min(i.length,8);u++){try{const m=await ie(i[u].id,t);r.push(...m)}catch{}u<i.length-1&&await new Promise(function(m){return setTimeout(m,250)})}if(r.sort(function(u,m){const w=new Date(u.timestamp).getTime();return new Date(m.timestamp).getTime()-w}),f.logger.log(`Total messages across all servers: ${r.length}`),r.length>0&&f.logger.log(`Most recent message timestamp: ${r[0].timestamp}`),r.length===0){h.showToast("\u{1F4ED} No messages found",y.getAssetIDByName("Small"));return}h.showToast(`\u2705 Found ${r.length} messages!`,y.getAssetIDByName("Check"));const n=r[0],d=oe(n.channelId),S=ce(n.guildId),N=`https://discord.com/channels/${n.guildId}/${n.channelId}/${n.id}`;setTimeout(function(){const u=new Date(n.timestamp),m=new Date().getTime()-u.getTime(),w=Math.floor(m/6e4),F=Math.floor(w/60),H=Math.floor(F/24);let k="";w<60?k=`${w}m ago`:F<24?k=`${F}h ago`:k=`${H}d ago`,h.showToast(`\u{1F4CD} #${d} (${k})`,y.getAssetIDByName("ic_message"))},1500),setTimeout(async function(){try{I!=null&&I.setString&&(I.setString(N),h.showToast(`\u{1F4CB} Link copied to ${S}!`,y.getAssetIDByName("Check")))}catch(u){f.logger.error("Copy failed:",u)}},3e3)}async function de(){try{if(!(I!=null&&I.getString))return;const t=await I.getString();t&&t!==Q&&se(t)&&(Q=t,h.showToast("\u{1F3AF} User ID detected!",y.getAssetIDByName("Check")),setTimeout(function(){return Z(t.trim())},1e3))}catch{}}function ge(){const[t,a]=e.React.useState("hidden"),[g,i]=e.React.useState([]),[o,s]=e.React.useState(!1),[r,n]=e.React.useState(null),[d,S]=e.React.useState(null),[N,u]=e.React.useState(""),[m,w]=e.React.useState(""),[F,H]=e.React.useState([]),[k,Se]=e.React.useState(""),[_,ee]=e.React.useState(!1);e.React.useEffect(function(){te()},[]);const te=function(){var l,R;s(!0),u("Scanning...");try{const p=(l=T?.getGuildId)==null?void 0:l.call(T);if(f.logger.log("Current guild ID:",p),p){const $=(R=E?.getGuild)==null?void 0:R.call(E,p);n($);const C=Y(p);i(C),u(`Found ${C.length} hidden channels`),C.length>0?h.showToast(`\u{1F512} Found ${C.length} hidden!`,y.getAssetIDByName("Check")):h.showToast("\u2728 No hidden channels",y.getAssetIDByName("Check"))}else n(null),i([]),u("No server selected - open a server first!"),h.showToast("Open a server first!",y.getAssetIDByName("Small"))}catch(p){f.logger.error("Scan error:",p),u(`Error: ${p}`)}finally{s(!1)}},me=async function(){if(!k||k.length<17){h.showToast("Enter valid User ID",y.getAssetIDByName("Small"));return}ee(!0),await Z(k),ee(!1)},pe=function(){var l,R;if(!m||m.length<17){h.showToast("Enter valid User ID",y.getAssetIDByName("Small"));return}const p=(l=T?.getGuildId)==null?void 0:l.call(T);if(!p){h.showToast("Open a server first!",y.getAssetIDByName("Small"));return}const $=le(p,m);H($);const C=(R=D?.getUser)==null?void 0:R.call(D,m),Re=C?.globalName||C?.username||"User";h.showToast(`${Re}: ${$.length} hidden channels`,y.getAssetIDByName("Check"))},be=function(l){return l?`#${l.toString(16).padStart(6,"0")}`:"#99AAB5"},j=function({id:l,label:R,icon:p}){return e.React.createElement(L,{style:{flex:1,padding:10,backgroundColor:t===l?"#5865F2":"#2b2d31",borderRadius:8,marginHorizontal:2},onPress:function(){return a(l)}},e.React.createElement(c,{style:{color:"#fff",textAlign:"center",fontSize:12,fontWeight:t===l?"bold":"normal"}},`${p} ${R}`))};return e.React.createElement(ne,{style:{flex:1,backgroundColor:"#1e1f22"}},[e.React.createElement(A,{key:"hdr",style:{padding:16,backgroundColor:"#2b2d31",marginBottom:8}},[e.React.createElement(c,{key:"t",style:{color:"#fff",fontSize:20,fontWeight:"bold",textAlign:"center"}},"\u{1F50D} Stalker Pro v3.1"),e.React.createElement(c,{key:"s",style:{color:"#b5bac1",fontSize:12,textAlign:"center",marginTop:4}},r?`\u{1F4CD} ${r.name}`:"Open a server to scan")]),e.React.createElement(A,{key:"tabs",style:{flexDirection:"row",padding:8,marginBottom:8}},[e.React.createElement(j,{key:"1",id:"hidden",label:"Hidden",icon:"\u{1F512}"}),e.React.createElement(j,{key:"2",id:"user",label:"User",icon:"\u{1F464}"}),e.React.createElement(j,{key:"3",id:"search",label:"Messages",icon:"\u{1F4AC}"})]),t==="hidden"&&[e.React.createElement(L,{key:"scan",style:{margin:12,padding:14,backgroundColor:"#5865F2",borderRadius:12,alignItems:"center"},onPress:te},e.React.createElement(c,{style:{color:"#fff",fontWeight:"bold",fontSize:16}},o?"\u23F3 Scanning...":"\u{1F504} Scan Current Server")),e.React.createElement(c,{key:"log",style:{color:"#b5bac1",textAlign:"center",marginBottom:12,fontSize:13}},N),e.React.createElement(c,{key:"debug",style:{color:"#949ba4",textAlign:"center",fontSize:10,marginBottom:8}},`GuildChannelStore: ${O?"\u2705":"\u274C"} | PermissionStore: ${G?"\u2705":"\u274C"}`),...g.map(function(l,R){return e.React.createElement(L,{key:`c${R}`,style:{margin:8,marginTop:4,padding:14,backgroundColor:"#2b2d31",borderRadius:12,borderLeftWidth:4,borderLeftColor:"#5865F2"},onPress:function(){return S(d===l.id?null:l.id)}},[e.React.createElement(A,{key:"h",style:{flexDirection:"row",alignItems:"center"}},[e.React.createElement(c,{key:"i",style:{fontSize:18,marginRight:10}},X(l.type)),e.React.createElement(A,{key:"n",style:{flex:1}},[e.React.createElement(c,{key:"nm",style:{color:"#fff",fontSize:16,fontWeight:"bold"}},l.name),l.parentName&&e.React.createElement(c,{key:"p",style:{color:"#949ba4",fontSize:12}},`in ${l.parentName}`)]),e.React.createElement(c,{key:"a",style:{color:"#b5bac1"}},d===l.id?"\u25BC":"\u25B6")]),e.React.createElement(c,{key:"r",style:{color:"#00b894",fontSize:12,marginTop:6}},`\u{1F465} ${l.rolesWithAccess.length} roles with access`),d===l.id&&e.React.createElement(A,{key:"d",style:{marginTop:12,paddingTop:12,borderTopWidth:1,borderTopColor:"#3f4147"}},l.rolesWithAccess.length>0?l.rolesWithAccess.map(function(p,$){return e.React.createElement(c,{key:`r${$}`,style:{color:be(p.color),marginLeft:12,marginTop:2,fontSize:14}},`\u2022 ${p.name}`)}):[e.React.createElement(c,{key:"no",style:{color:"#949ba4",marginLeft:12}},"No specific role overwrites found")])])}),g.length===0&&!o&&e.React.createElement(A,{key:"empty",style:{padding:30,alignItems:"center"}},[e.React.createElement(c,{key:"e1",style:{fontSize:40}},"\u2728"),e.React.createElement(c,{key:"e2",style:{color:"#fff",fontSize:16,marginTop:10}},r?"No hidden channels found":"Open a server first"),e.React.createElement(c,{key:"e3",style:{color:"#b5bac1",marginTop:4,textAlign:"center",fontSize:12}},`Note: Discord may not expose
channels you can't see at all`)])],t==="user"&&[e.React.createElement(M,{key:"us",title:"\u{1F464} USER HIDDEN ACCESS"},[e.React.createElement(J,{key:"in",title:"User ID",placeholder:"Enter User ID",value:m,onChangeText:w,keyboardType:"numeric"}),e.React.createElement(B,{key:"btn",label:"\u{1F50D} Check Hidden Access",subLabel:r?`In ${r.name}`:"Open server first",onPress:pe})]),F.length>0&&e.React.createElement(M,{key:"res",title:`\u2705 Can access ${F.length} hidden channels:`},F.map(function(l,R){return e.React.createElement(B,{key:`uc${R}`,label:`${X(l.type)} ${l.name}`,subLabel:l.parentName||void 0})})),F.length===0&&m.length>=17&&e.React.createElement(A,{key:"no",style:{padding:30,alignItems:"center"}},[e.React.createElement(c,{key:"n1",style:{fontSize:40}},"\u{1F6AB}"),e.React.createElement(c,{key:"n2",style:{color:"#fff",fontSize:16,marginTop:10}},"No hidden access found")])],t==="search"&&[e.React.createElement(M,{key:"auto",title:"\u{1F4AC} MESSAGE SEARCH"},[e.React.createElement(B,{key:"a1",label:"\u{1F4CB} Auto-Detection",subLabel:W?"\u2705 Copy User ID to auto-search!":"\u274C Inactive"}),e.React.createElement(B,{key:"a2",label:"\u23F1\uFE0F Returns Most Recent",subLabel:"Messages sorted by timestamp (newest first)"})]),e.React.createElement(M,{key:"man",title:"\u{1F50D} MANUAL SEARCH"},[e.React.createElement(J,{key:"in",title:"User ID",placeholder:"Enter Discord User ID",value:k,onChangeText:Se,keyboardType:"numeric"}),e.React.createElement(B,{key:"btn",label:_?"\u23F3 Searching...":"\u{1F50D} Find Recent Messages",onPress:_?void 0:me})])],e.React.createElement(A,{key:"ft",style:{padding:20,alignItems:"center"}},e.React.createElement(c,{style:{color:"#949ba4",fontSize:10,textAlign:"center"}},`\u{1F4A1} Copy User ID \u2192 auto-search
\u{1F512} Open server \u2192 Scan for hidden channels`))])}const fe=ge,ye=function(){f.logger.log("=== STALKER PRO v3.1 LOADING ==="),f.logger.log("GuildChannelStore:",!!O),f.logger.log("PermissionStore:",!!G),I!=null&&I.getString&&(W=!0,P=setInterval(de,2e3)),h.showToast("\u{1F50D} Stalker Pro v3.1 ready!",y.getAssetIDByName("Check"))},he=function(){P&&(clearInterval(P),P=null,W=!1)};return z.onLoad=ye,z.onUnload=he,z.settings=fe,z})({},vendetta,vendetta.metro,vendetta.metro.common,vendetta.ui.components,vendetta.ui.assets,vendetta.ui.toasts);
