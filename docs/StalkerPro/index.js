(function(R,a,f,t,F,r,i){"use strict";var P,L;const{FormSection:m,FormRow:b,FormInput:J}=F.Forms,{ScrollView:W,View:Q,Text:T,TouchableOpacity:X,ActivityIndicator:Y}=F.General,I=f.findByStoreName("UserStore"),A=f.findByStoreName("GuildStore"),U=f.findByStoreName("GuildMemberStore"),$=f.findByStoreName("ChannelStore"),d=((P=t.ReactNative)==null?void 0:P.Clipboard)||f.findByProps("setString","getString")||f.findByProps("getString"),w=f.findByProps("getAPIBaseURL","get")||f.findByProps("API_HOST","get"),M=f.findByProps("jumpToMessage"),N=f.findByProps("openURL")||((L=t.ReactNative)==null?void 0:L.Linking);let O="",k=!1,v="",D=null;function G(e){if(!A||!U)return[];try{return Object.values(A.getGuilds()||{}).filter(function(n){return U.getMember(n.id,e)})}catch{return[]}}async function V(e,n){var g;if(!(w!=null&&w.get))return[];try{const u=await w.get({url:`/guilds/${e}/messages/search`,query:{author_id:n,include_nsfw:!0}});return(((g=u?.body)==null?void 0:g.messages)||[]).map(function(l){return{id:l[0].id,content:l[0].content||"[No text]",channelId:l[0].channel_id,guildId:e,timestamp:l[0].timestamp}})}catch{return[]}}function z(e){var n;return((n=$?.getChannel(e))==null?void 0:n.name)||"unknown"}function Z(e){var n;return((n=A?.getGuild(e))==null?void 0:n.name)||"Unknown"}function j(e){const n=I?.getUser(e);return n?{username:n.username,globalName:n.globalName,id:n.id}:null}function K(e,n,g){var u,l;try{return(u=t.FluxDispatcher)==null||u.dispatch({type:"NAVIGATE_TO_JUMP_TO_MESSAGE",messageId:g,channelId:n,guildId:e}),!0}catch{}try{return M?.jumpToMessage({channelId:n,messageId:g,flash:!0}),!0}catch{}try{return(l=N?.openURL)==null||l.call(N,`discord://-/channels/${e}/${n}/${g}`),!0}catch{}return!1}function _(e){if(!e)return!1;const n=e.trim();return/^\d{17,19}$/.test(n)}async function ee(e){var n;a.logger.log("Auto-searching user:",e);const g=(n=I?.getCurrentUser)==null?void 0:n.call(I);if(g&&e===g.id){a.logger.log("Skipping - this is current user");return}const u=G(e),l=j(e);if(u.length===0){i.showToast("\u274C No mutual servers with this user",r.getAssetIDByName("Small"));return}const p=l?.globalName||l?.username||`User ${e.slice(-4)}`;i.showToast(`\u{1F50D} Searching ${p}...`,r.getAssetIDByName("ic_search"));let h=[];for(let o=0;o<Math.min(u.length,8);o++){try{const y=await V(u[o].id,e);h.push(...y)}catch{}o<u.length-1&&await new Promise(function(y){return setTimeout(y,250)})}if(h.sort(function(o,y){return new Date(y.timestamp).getTime()-new Date(o.timestamp).getTime()}),h.length===0){i.showToast("\u{1F4ED} No messages found",r.getAssetIDByName("Small"));return}i.showToast(`\u2705 Found ${h.length} messages!`,r.getAssetIDByName("Check")),setTimeout(function(){if(h.length>0){const o=h[0];i.showToast(`\u{1F4CD} Latest in #${z(o.channelId)}`,r.getAssetIDByName("ic_message"))}},1500),setTimeout(function(){if(h.length>0){const o=h[0];i.showToast("\u{1F446} Opening message...",r.getAssetIDByName("Arrow")),K(o.guildId,o.channelId,o.id)}},3e3)}async function x(){try{if(!(d!=null&&d.getString)){a.logger.log("Clipboard.getString not available");return}const e=await d.getString();if(e&&e!==v&&_(e)){v=e;const n=e.trim();a.logger.log("Detected User ID in clipboard:",n),i.showToast("\u{1F3AF} User ID detected!",r.getAssetIDByName("Check")),setTimeout(function(){return ee(n)},1e3)}}catch(e){a.logger.error("Clipboard check failed:",e)}}function te(){const[e,n]=t.React.useState(O),[g,u]=t.React.useState([]),[l,p]=t.React.useState(null),[h,o]=t.React.useState([]),[y,C]=t.React.useState(!1),[H,q]=t.React.useState(""),re=async function(){if(!e||e.length<17){i.showToast("Invalid User ID",r.getAssetIDByName("Small"));return}C(!0),u([]),O=e;const s=j(e);p(s);const c=G(e);if(o(c),c.length===0){i.showToast("No mutual servers",r.getAssetIDByName("Small")),C(!1);return}const E=[];for(let S=0;S<Math.min(c.length,12);S++){q(`${c[S].name} (${S+1}/${Math.min(c.length,12)})`);const B=await V(c[S].id,e);E.push(...B),await new Promise(function(oe){return setTimeout(oe,350)})}E.sort(function(S,B){return new Date(B.timestamp).getTime()-new Date(S.timestamp).getTime()}),u(E.slice(0,50)),i.showToast(`Found ${E.length} messages`,r.getAssetIDByName("Check")),C(!1),q("")},ie=function(s){try{const c=new Date(s);return`${c.toLocaleDateString()} ${c.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}`}catch{return s}},ue=async function(){i.showToast("Checking clipboard...",r.getAssetIDByName("ic_search")),await x()};return t.React.createElement(W,{style:{flex:1,backgroundColor:"#1e1f22"}},[t.React.createElement(m,{key:"ver",title:"\u{1F4F1} STALKER PRO v2.0"},[t.React.createElement(b,{key:"v1",label:"\u2728 Copy ID Detection",subLabel:"Copy any User ID to auto-search!"}),t.React.createElement(b,{key:"v2",label:"\u{1F4CB} Check Clipboard Now",subLabel:"Tap to manually check clipboard",trailing:b.Arrow?t.React.createElement(b.Arrow,null):null,onPress:ue})]),t.React.createElement(m,{key:"search",title:"\u{1F50D} MANUAL SEARCH"},[t.React.createElement(J,{key:"in",title:"User ID",placeholder:"Paste Discord User ID here",value:e,onChangeText:n,keyboardType:"numeric"}),t.React.createElement(b,{key:"btn",label:y?"\u23F3 Searching...":"\u{1F50D} Search",subLabel:y?H:"Find their messages",onPress:y?void 0:re})]),l&&t.React.createElement(m,{key:"user",title:"\u{1F464} USER"},[t.React.createElement(b,{key:"n",label:l.globalName||l.username,subLabel:`@${l.username}`})]),h.length>0&&t.React.createElement(m,{key:"srv",title:`\u{1F3E0} ${h.length} MUTUAL SERVERS`},h.slice(0,10).map(function(s,c){return t.React.createElement(b,{key:`s${c}`,label:s.name})})),y&&t.React.createElement(Q,{key:"load",style:{padding:20,alignItems:"center"}},[t.React.createElement(Y,{key:"sp",size:"large",color:"#5865f2"}),t.React.createElement(T,{key:"t",style:{color:"#b5bac1",marginTop:10}},H)]),!y&&g.length>0&&t.React.createElement(m,{key:"msgs",title:`\u{1F4AC} ${g.length} MESSAGES`},g.map(function(s,c){return t.React.createElement(X,{key:`m${c}`,style:{padding:12,borderBottomWidth:1,borderBottomColor:"#3f4147",backgroundColor:"#2b2d31"},onPress:function(){i.showToast("Opening...",r.getAssetIDByName("Check")),K(s.guildId,s.channelId,s.id)}},[t.React.createElement(T,{key:"c",style:{color:"#5865f2",fontSize:12}},`#${z(s.channelId)} \u2022 ${Z(s.guildId)}`),t.React.createElement(T,{key:"m",style:{color:"#f2f3f5",fontSize:14,marginVertical:3}},s.content.substring(0,100)),t.React.createElement(T,{key:"t",style:{color:"#949ba4",fontSize:11}},ie(s.timestamp))])})),t.React.createElement(m,{key:"status",title:"\u2699\uFE0F STATUS"},[t.React.createElement(b,{key:"s1",label:"Clipboard API",subLabel:d!=null&&d.getString?"\u2705 Available":"\u274C Not Available"}),t.React.createElement(b,{key:"s2",label:"Auto Monitor",subLabel:k?"\u2705 Running":"\u274C Stopped"}),t.React.createElement(b,{key:"s3",label:"Last Clipboard",subLabel:v||"Nothing checked yet"})])])}const ne=te,le=function(){a.logger.log("========================================"),a.logger.log("=== STALKER PRO v2.0 LOADING ==="),a.logger.log("========================================"),a.logger.log("Clipboard API:",!!d),a.logger.log("Clipboard.getString:",!!(d!=null&&d.getString)),a.logger.log("Clipboard.setString:",!!(d!=null&&d.setString)),d!=null&&d.getString?(k=!0,D=setInterval(x,2e3),a.logger.log("Clipboard monitoring STARTED (every 2s)"),i.showToast("\u{1F50D} Stalker Pro v2.0 ready!",r.getAssetIDByName("Check"))):(k=!1,a.logger.warn("Clipboard API not available - manual mode only"),i.showToast("Stalker Pro ready (manual mode)",r.getAssetIDByName("Small")))},ae=function(){a.logger.log("=== STALKER PRO UNLOADING ==="),D&&(clearInterval(D),D=null,k=!1,a.logger.log("Clipboard monitoring STOPPED"))};return R.onLoad=le,R.onUnload=ae,R.settings=ne,R})({},vendetta,vendetta.metro,vendetta.metro.common,vendetta.ui.components,vendetta.ui.assets,vendetta.ui.toasts);
