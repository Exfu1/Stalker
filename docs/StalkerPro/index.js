(function(I,a,c,e,N,u,g){"use strict";var F;const{FormSection:E,FormRow:y,FormInput:C}=N.Forms,{ScrollView:O,View:x,Text:k,TouchableOpacity:j,ActivityIndicator:V,Linking:z}=N.General,b=z||((F=e.ReactNative)==null?void 0:F.Linking),P=c.findByStoreName("UserStore"),D=c.findByStoreName("GuildStore"),U=c.findByStoreName("GuildMemberStore"),L=c.findByStoreName("ChannelStore"),B=c.findByProps("getAPIBaseURL","get")||c.findByProps("API_HOST","get"),p=c.findByProps("transitionToGuild","transitionTo")||c.findByProps("transitionTo")||c.findByProps("replaceWith","back")||c.findByProps("openURL"),w=c.findByProps("jumpToMessage")||c.findByProps("fetchMessages","jumpToMessage");let M="";function K(r){try{const n=D?Object.values(D.getGuilds()||{}):[],s=[];for(const i of n)U?.getMember(i.id,r)&&s.push(i);return s}catch(n){return a.logger.error("Error getting mutual guilds:",n),[]}}function H(r,n,s){const i=`https://discord.com/channels/${r}/${n}/${s}`,d=`discord://-/channels/${r}/${n}/${s}`;a.logger.log("Attempting to open:",d);try{e.FluxDispatcher&&(e.FluxDispatcher.dispatch({type:"NAVIGATE_TO_JUMP_TO_MESSAGE",messageId:s,channelId:n,guildId:r}),a.logger.log("FluxDispatcher NAVIGATE_TO_JUMP_TO_MESSAGE dispatched"))}catch(o){a.logger.error("FluxDispatcher method failed:",o)}try{if(w!=null&&w.jumpToMessage)return w.jumpToMessage({channelId:n,messageId:s,flash:!0}),a.logger.log("jumpToMessage called"),!0}catch(o){a.logger.error("jumpToMessage method failed:",o)}try{if(p!=null&&p.transitionToGuild)return p.transitionToGuild(r,n,s),a.logger.log("transitionToGuild called"),!0;if(p!=null&&p.transitionTo)return p.transitionTo(`/channels/${r}/${n}/${s}`),a.logger.log("transitionTo called"),!0}catch(o){a.logger.error("Router method failed:",o)}try{if(b!=null&&b.openURL)return b.openURL(d),a.logger.log("openURL called with discord:// scheme"),!0}catch(o){a.logger.error("URL opener method failed:",o)}try{if(e.FluxDispatcher)return e.FluxDispatcher.dispatch({type:"MESSAGE_LINK_PRESSED",href:i}),a.logger.log("MESSAGE_LINK_PRESSED dispatched"),!0}catch(o){a.logger.error("MESSAGE_LINK_PRESSED dispatch failed:",o)}return!1}async function G(r,n){var s;try{if(!(B!=null&&B.get))return a.logger.error("RestAPI not found"),[];const i=await B.get({url:`/guilds/${r}/messages/search`,query:{author_id:n,include_nsfw:!0}});return(s=i?.body)!=null&&s.messages?i.body.messages.map(function(d){var o;const h=d[0];return{id:h.id,content:h.content||"[No text content]",channelId:h.channel_id,guildId:r,timestamp:h.timestamp,attachments:((o=h.attachments)==null?void 0:o.length)||0}}):[]}catch(i){return i?.status!==403&&a.logger.error(`Error searching guild ${r}:`,i?.message||i),[]}}function J(r){try{const n=L?.getChannel(r);return n?.name||"unknown"}catch{return"unknown"}}function W(r){try{const n=D?.getGuild(r);return n?.name||"Unknown Server"}catch{return"Unknown Server"}}function q(r){try{const n=P?.getUser(r);if(n)return{username:n.username,globalName:n.globalName,id:n.id}}catch(n){a.logger.error("Error getting user info:",n)}return null}function Q(){const[r,n]=e.React.useState(M),[s,i]=e.React.useState([]),[d,o]=e.React.useState(null),[h,_]=e.React.useState([]),[S,R]=e.React.useState(!1),[v,T]=e.React.useState(""),ee=async function(){if(!r||r.length<17){g.showToast("Enter a valid User ID (17-19 digits)",u.getAssetIDByName("Small"));return}R(!0),i([]),T("Finding mutual servers..."),M=r;try{const t=q(r);o(t);const l=K(r);if(_(l),l.length===0){g.showToast("No mutual servers found",u.getAssetIDByName("Small")),R(!1);return}const m=[];for(let f=0;f<Math.min(l.length,15);f++){const $=l[f];T(`${$.name} (${f+1}/${Math.min(l.length,15)})`);try{const A=await G($.id,r);m.push(...A)}catch{}f<l.length-1&&await new Promise(function(A){return setTimeout(A,400)})}m.sort(function(f,$){return new Date($.timestamp).getTime()-new Date(f.timestamp).getTime()}),i(m.slice(0,50)),g.showToast(`Found ${m.length} messages`,u.getAssetIDByName("Check"))}catch(t){g.showToast("Error: "+(t?.message||"Unknown"),u.getAssetIDByName("Small"))}finally{R(!1),T("")}},te=async function(t){R(!0),T(`Searching ${t.name}...`);try{const l=await G(t.id,r);l.sort(function(m,f){return new Date(f.timestamp).getTime()-new Date(m.timestamp).getTime()}),i(l),g.showToast(`Found ${l.length} messages`,u.getAssetIDByName("Check"))}catch(l){g.showToast("Error: "+(l?.message||"Unknown"),u.getAssetIDByName("Small"))}finally{R(!1),T("")}},ne=function(t){try{const l=new Date(t);return`${l.toLocaleDateString()} ${l.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}`}catch{return t}},re=function(t){if(a.logger.log(`Tapping message: ${t.id} in channel ${t.channelId}`),g.showToast("Opening message...",u.getAssetIDByName("Check")),!H(t.guildId,t.channelId,t.id)){const l=`https://discord.com/channels/${t.guildId}/${t.channelId}/${t.id}`;g.showToast("Navigation failed, check logs",u.getAssetIDByName("Small")),a.logger.log("Navigation failed. Message link:",l)}};return e.React.createElement(O,{style:{flex:1,backgroundColor:"#1e1f22"}},[e.React.createElement(E,{key:"search",title:"\u{1F50D} USER SEARCH"},[e.React.createElement(C,{key:"input",title:"User ID",placeholder:"Enter Discord User ID",value:r,onChangeText:n,keyboardType:"numeric"}),e.React.createElement(y,{key:"searchBtn",label:S?"\u23F3 Searching...":"\u{1F50D} Search All Servers",subLabel:S?v:"Find messages across mutual servers",onPress:S?void 0:ee})]),d&&e.React.createElement(E,{key:"userInfo",title:"\u{1F464} USER"},[e.React.createElement(y,{key:"name",label:d.globalName||d.username||"Unknown",subLabel:`ID: ${d.id}`})]),h.length>0&&e.React.createElement(E,{key:"servers",title:`\u{1F3E0} SERVERS (${h.length})`},h.slice(0,20).map(function(t,l){return e.React.createElement(y,{key:`s-${l}`,label:t.name,trailing:y.Arrow?e.React.createElement(y.Arrow,null):null,onPress:function(){return te(t)}})})),S&&e.React.createElement(x,{key:"loading",style:{padding:20,alignItems:"center"}},[e.React.createElement(V,{key:"spin",size:"large",color:"#5865f2"}),e.React.createElement(k,{key:"txt",style:{color:"#b5bac1",marginTop:10}},v)]),!S&&s.length>0&&e.React.createElement(E,{key:"msgs",title:`\u{1F4AC} MESSAGES (${s.length})`},s.map(function(t,l){return e.React.createElement(j,{key:`m-${l}`,style:{padding:12,borderBottomWidth:1,borderBottomColor:"#3f4147",backgroundColor:"#2b2d31"},onPress:function(){return re(t)},activeOpacity:.7},[e.React.createElement(k,{key:"ch",style:{color:"#5865f2",fontSize:12,marginBottom:2}},`#${J(t.channelId)} \u2022 ${W(t.guildId)}`),e.React.createElement(k,{key:"ct",style:{color:"#f2f3f5",fontSize:14,marginBottom:4}},t.content.length>150?t.content.substring(0,150)+"...":t.content),e.React.createElement(k,{key:"tm",style:{color:"#949ba4",fontSize:11}},ne(t.timestamp)+(t.attachments>0?` \u2022 \u{1F4CE}${t.attachments}`:"")+" \u2022 Tap to open")])})),!S&&s.length===0&&e.React.createElement(E,{key:"help",title:"\u2139\uFE0F HELP"},[e.React.createElement(y,{key:"h1",label:"1. Enter User ID",subLabel:"Long-press user \u2192 Copy ID"}),e.React.createElement(y,{key:"h2",label:"2. Search",subLabel:"Tap a server or Search All"}),e.React.createElement(y,{key:"h3",label:"3. Tap Message",subLabel:"Opens message in Discord"})])])}const X=Q,Y=function(){a.logger.log("Stalker Pro loaded"),a.logger.log("Router found:",!!p),a.logger.log("FluxDispatcher found:",!!e.FluxDispatcher),a.logger.log("MessageActions found:",!!w),a.logger.log("URLOpener found:",!!b),g.showToast("Stalker Pro ready!",u.getAssetIDByName("Check"))},Z=function(){a.logger.log("Stalker Pro unloaded")};return I.onLoad=Y,I.onUnload=Z,I.settings=X,I})({},vendetta,vendetta.metro,vendetta.metro.common,vendetta.ui.components,vendetta.ui.assets,vendetta.ui.toasts);
