(function(N,r,g,b,u,F,a,f){"use strict";const{FormSection:$,FormRow:y,FormDivider:E}=F.Forms,U=g.findByStoreName("UserStore"),j=g.findByStoreName("GuildStore"),S=g.findByStoreName("ChannelStore"),w=g.findByStoreName("MessageStore"),C=g.findByStoreName("GuildMemberStore");let h=[];function M(n){const e=j?Object.values(j.getGuilds()||{}):[],t=[];for(const l of e)C?.getMember(l.id,n)&&t.push(l);return t}function T(n,e){var t,l;const o=[];for(const i of e)try{const p=(S?Object.values(((t=S.getChannels)==null?void 0:t.call(S))||((l=S.getMutableGuildChannels)==null?void 0:l.call(S))||{}):[]).filter(function(d){return d.guild_id===i.id&&d.type===0});for(const d of p){const k=w?.getMessages(d.id);if(k!=null&&k._array){const P=k._array.filter(function(s){var m;return((m=s.author)==null?void 0:m.id)===n});for(let s=0;s<Math.min(P.length,3);s++)o.push({id:P[s].id,content:(P[s].content||"").substring(0,50),channel:d.name,guild:i.name})}}}catch{}return o.slice(0,10)}function I({userId:n}){const e=M(n);return u.React.createElement($,{title:"\u{1F50D} Stalker Pro"},[u.React.createElement(y,{key:"recent",label:"Recent Messages",subLabel:"Find their messages across servers",trailing:y.Arrow?u.React.createElement(y.Arrow,null):null,onPress:function(){const t=T(n,e);f.showToast(`Found ${t.length} messages`,a.getAssetIDByName("Check"))}}),u.React.createElement(E,{key:"div"}),u.React.createElement(y,{key:"hidden",label:"Hidden Channels",subLabel:"Channels they can see but you can't",trailing:y.Arrow?u.React.createElement(y.Arrow,null):null,onPress:function(){f.showToast(`Checking ${e.length} servers`,a.getAssetIDByName("Check"))}})])}const O=function(){try{f.showToast("Stalker Pro: Starting...",a.getAssetIDByName("Check")),r.logger.log("Stalker Pro: Starting initialization");const n=["UserProfileSection","UserProfileBody","UserProfileHeader","UserProfile","ProfileBanner","UserSheet","UserProfileSheet","UserProfileBio","UserProfileCard","SimplifiedUserProfileBody","UserProfileBodyMobile"];let e=null,t=null;for(const l of n)try{const o=g.findByDisplayName(l,!1);if(o){e=o,t=l,r.logger.log(`Found component by display name: ${l}`);break}}catch{}if(!e)for(const l of n)try{const o=g.findByName(l,!1);if(o){e=o,t=l,r.logger.log(`Found component by name: ${l}`);break}}catch{}if(!e){const l=[["UserProfileSection"],["UserProfileBody"],["default","UserProfileSection"],["default","UserProfileBody"],["UserSheet"]];for(const o of l)try{const i=g.findByProps(...o);if(i){e=i.default||i[o[o.length-1]]||i,t=o.join("."),r.logger.log(`Found module by props: ${o.join(", ")}`);break}}catch{}}if(!e){f.showToast("Stalker Pro: No profile component found!",a.getAssetIDByName("Small")),r.logger.error("Could not find any profile component to patch");return}if(f.showToast(`Stalker Pro: Found ${t}`,a.getAssetIDByName("Check")),r.logger.log(`Profile component type: ${typeof e}`),r.logger.log(`Profile component keys: ${Object.keys(e||{}).slice(0,10).join(", ")}`),typeof e=="function"){r.logger.log("Patching function component directly");const l=e;h.push(b.after("type",{type:e},function(o,i){return r.logger.log("Stalker Pro: Patch callback triggered!"),B(o,i)}))}else if(e.default&&typeof e.default=="function")r.logger.log("Patching default export"),h.push(b.after("default",e,function(l,o){return r.logger.log("Stalker Pro: Default patch callback triggered!"),B(l,o)}));else if(e.render&&typeof e.render=="function")r.logger.log("Patching render method"),h.push(b.after("render",e.prototype||e,function(l,o){return r.logger.log("Stalker Pro: Render patch callback triggered!"),B(l,o)}));else{const l=Object.keys(e).filter(function(o){return typeof e[o]=="function"});if(r.logger.log(`Function properties found: ${l.join(", ")}`),l.length>0){const o=l[0];r.logger.log(`Patching first function property: ${o}`),h.push(b.after(o,e,function(i,p){return r.logger.log(`Stalker Pro: ${o} patch callback triggered!`),B(i,p)}))}else{f.showToast("Stalker Pro: No patchable function found!",a.getAssetIDByName("Small")),r.logger.error("Component has no function properties to patch");return}}f.showToast("Stalker Pro loaded!",a.getAssetIDByName("Check")),r.logger.log("Stalker Pro plugin loaded and patches applied")}catch(n){f.showToast("Stalker Pro: Error!",a.getAssetIDByName("Small")),r.logger.error("Stalker Pro load error:",n?.message||n)}};function B(n,e){var t,l,o,i,p,d,k,P,s,m,R,A;try{const c=((t=n[0])==null?void 0:t.userId)||((o=(l=n[0])==null?void 0:l.user)==null?void 0:o.id)||((p=(i=n[0])==null?void 0:i.props)==null?void 0:p.userId)||((P=(k=(d=n[0])==null?void 0:d.props)==null?void 0:k.user)==null?void 0:P.id)||(typeof n[0]=="string"?n[0]:null);if(r.logger.log("patchProfileResult called with userId:",c),!c)return r.logger.log("No userId found in args:",(s=JSON.stringify(n[0]))==null?void 0:s.substring(0,200)),e;const D=U?.getCurrentUser();if(D&&c===D.id)return r.logger.log("Skipping own profile"),e;if((m=e?.props)!=null&&m.children&&Array.isArray(e.props.children))r.logger.log("Injecting into res.props.children array"),e.props.children.push(u.React.createElement(I,{key:"stalker-pro",userId:c})),r.logger.log("Stalker section successfully injected!");else if((R=e?.props)!=null&&R.children){r.logger.log("Wrapping non-array children");const G=e.props.children;e.props.children=[G,u.React.createElement(I,{key:"stalker-pro",userId:c})],r.logger.log("Stalker section injected by wrapping!")}else(A=e?.type)!=null&&A.render||e!=null&&e.type?r.logger.log("Result structure:",Object.keys(e||{}).join(", ")):(r.logger.log("Cannot inject - unexpected result structure"),r.logger.log("Result type:",typeof e),r.logger.log("Result keys:",Object.keys(e||{}).slice(0,5).join(", ")))}catch(c){r.logger.error("Error in patchProfileResult:",c?.message||c)}return e}const v=function(){for(const n of h)n?.();h=[],r.logger.log("Stalker Pro plugin unloaded")};return N.onLoad=O,N.onUnload=v,N})({},vendetta,vendetta.metro,vendetta.patcher,vendetta.metro.common,vendetta.ui.components,vendetta.ui.assets,vendetta.ui.toasts);
