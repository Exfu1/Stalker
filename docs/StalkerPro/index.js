(function(S,v,f,e,E,R,k){"use strict";const{FormSection:y,FormRow:s,FormDivider:j,FormInput:w}=E.Forms,{ScrollView:L,View:T,Text:D}=E.General,U=f.findByStoreName("UserStore"),p=f.findByStoreName("GuildStore"),m=f.findByStoreName("ChannelStore"),I=f.findByStoreName("MessageStore"),F=f.findByStoreName("GuildMemberStore");let N="";function C(a){try{const t=p?Object.values(p.getGuilds()||{}):[],r=[];for(const o of t)F?.getMember(o.id,a)&&r.push(o);return r}catch(t){return v.logger.error("Error getting mutual guilds:",t),[]}}function M(a,t){var r,o;const i=[];for(const b of t)try{const u=(m?Object.values(((r=m.getChannels)==null?void 0:r.call(m))||((o=m.getMutableGuildChannels)==null?void 0:o.call(m))||{}):[]).filter(function(c){return c.guild_id===b.id&&c.type===0});for(const c of u){const d=I?.getMessages(c.id);if(d!=null&&d._array){const g=d._array.filter(function(l){var n;return((n=l.author)==null?void 0:n.id)===a});for(let l=0;l<Math.min(g.length,3);l++)i.push({id:g[l].id,content:(g[l].content||"").substring(0,100),channel:c.name,guild:b.name,timestamp:g[l].timestamp})}}}catch{}return i.sort(function(b,u){return new Date(u.timestamp).getTime()-new Date(b.timestamp).getTime()}),i.slice(0,15)}function P(a){try{const t=U?.getUser(a);if(t)return{username:t.username,discriminator:t.discriminator,globalName:t.globalName,avatar:t.avatar,id:t.id}}catch(t){v.logger.error("Error getting user info:",t)}return null}function $(){const[a,t]=e.React.useState(N),[r,o]=e.React.useState([]),[i,b]=e.React.useState(null),[u,c]=e.React.useState([]),[d,g]=e.React.useState(!1),l=function(){if(!a||a.length<17){k.showToast("Please enter a valid User ID",R.getAssetIDByName("Small"));return}g(!0),N=a;try{const n=P(a);b(n);const h=C(a);c(h);const B=M(a,h);o(B),k.showToast(`Found ${B.length} messages in ${h.length} servers`,R.getAssetIDByName("Check"))}catch(n){k.showToast("Error searching: "+(n?.message||"Unknown"),R.getAssetIDByName("Small"))}finally{g(!1)}};return e.React.createElement(L,{style:{flex:1}},[e.React.createElement(y,{key:"search",title:"\u{1F50D} User Search"},[e.React.createElement(w,{key:"input",title:"User ID",placeholder:"Enter Discord User ID (e.g. 123456789012345678)",value:a,onChangeText:t,keyboardType:"numeric"}),e.React.createElement(s,{key:"searchBtn",label:d?"Searching...":"\u{1F50D} Search User",subLabel:"Find their messages and activity",onPress:l,disabled:d})]),i&&e.React.createElement(y,{key:"userInfo",title:"\u{1F464} User Info"},[e.React.createElement(s,{key:"name",label:"Username",subLabel:i.globalName||i.username||"Unknown"}),e.React.createElement(s,{key:"id",label:"User ID",subLabel:i.id})]),u.length>0&&e.React.createElement(y,{key:"servers",title:`\u{1F3E0} Mutual Servers (${u.length})`},u.slice(0,10).map(function(n,h){return e.React.createElement(s,{key:`server-${h}`,label:n.name,subLabel:`ID: ${n.id}`})})),r.length>0&&e.React.createElement(y,{key:"messages",title:`\u{1F4AC} Recent Messages (${r.length})`},r.map(function(n,h){return e.React.createElement(T,{key:`msg-${h}`,style:{padding:12,borderBottomWidth:1,borderBottomColor:"#333"}},[e.React.createElement(D,{key:"header",style:{color:"#7289da",fontSize:12,marginBottom:4}},`#${n.channel} \u2022 ${n.guild}`),e.React.createElement(D,{key:"content",style:{color:"#dcddde",fontSize:14}},n.content||"[No text content]")])})),r.length===0&&a&&!d&&e.React.createElement(y,{key:"noResults",title:"\u2139\uFE0F Results"},[e.React.createElement(s,{key:"noMsg",label:"No messages found",subLabel:"The user may not be in your servers or has no cached messages"})]),e.React.createElement(y,{key:"help",title:"\u2753 How to Use"},[e.React.createElement(s,{key:"h1",label:"1. Get User ID",subLabel:"Long-press on a user > Copy ID (Developer Mode must be on)"}),e.React.createElement(s,{key:"h2",label:"2. Paste ID above",subLabel:"Enter the 18-digit User ID"}),e.React.createElement(s,{key:"h3",label:"3. Tap Search",subLabel:"Find their messages in mutual servers"})])])}const G=$,A=function(){v.logger.log("Stalker Pro: Plugin loaded!"),k.showToast("Stalker Pro loaded! Check plugin settings.",R.getAssetIDByName("Check"))},V=function(){v.logger.log("Stalker Pro: Plugin unloaded")};return S.onLoad=A,S.onUnload=V,S.settings=G,S})({},vendetta,vendetta.metro,vendetta.metro.common,vendetta.ui.components,vendetta.ui.assets,vendetta.ui.toasts);
