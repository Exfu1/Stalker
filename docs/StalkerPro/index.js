(function(I,f,y,t,j,S,C,ie){"use strict";var V,_,q,K;const{FormSection:N,FormRow:w,FormInput:Y}=j.Forms,{ScrollView:oe,View:m,Text:c,TouchableOpacity:z}=j.General,M=y.findByStoreName("UserStore"),k=y.findByStoreName("GuildStore"),D=y.findByStoreName("GuildMemberStore"),u=y.findByStoreName("ChannelStore"),A=y.findByStoreName("SelectedGuildStore"),b=y.findByProps("getChannelPermissions","can"),{getChannel:J}=y.findByProps("getChannel")||{},O=((V=y.findByProps("ChannelTypes"))==null?void 0:V.ChannelTypes)||{},E=((_=t.ReactNative)==null?void 0:_.Clipboard)||y.findByProps("setString","getString"),L=y.findByProps("getAPIBaseURL","get")||y.findByProps("API_HOST","get"),W=((K=(q=t.constants)==null?void 0:q.Permissions)==null?void 0:K.VIEW_CHANNEL)||1024;let Q=!1,X="",$=null,B=[];const Z=[O.DM,O.GROUP_DM,O.GUILD_CATEGORY];function ue(e){var r,i;if(!e||(typeof e=="string"&&(e=J?.(e)||((r=u?.getChannel)==null?void 0:r.call(u,e))),!e||Z.includes(e.type)))return!1;e.realCheck=!0;const a=!((i=b?.can)!=null&&i.call(b,W,e));return delete e.realCheck,a}function ee(e){switch(e){case 0:return"\u{1F4AC}";case 2:return"\u{1F50A}";case 4:return"\u{1F4C1}";case 5:return"\u{1F4E2}";case 13:return"\u{1F3AD}";case 15:return"\u{1F4CB}";default:return"\u{1F4DD}"}}function te(e){var r,i,a;const l=[];try{const n=((r=u?.getMutableGuildChannelsForGuild)==null?void 0:r.call(u,e))||((i=u?.getGuildChannels)==null?void 0:i.call(u,e))||Object.values(((a=u?.getMutableGuildChannels)==null?void 0:a.call(u))||{}).filter(function(s){return s?.guild_id===e});Array.isArray(n)?l.push(...n):l.push(...Object.values(n||{}))}catch(n){f.logger.error("getAllGuildChannels error:",n)}return l}function ne(e){var r,i;const a=[];try{f.logger.log("=== SCANNING HIDDEN CHANNELS ==="),f.logger.log("Permissions module:",!!b),f.logger.log("VIEW_CHANNEL constant:",String(W));const l=te(e);f.logger.log("All channels:",l.length);for(const n of l)n!=null&&n.id&&n.type!==4&&(Z.includes(n.type)||ue(n)&&a.push({id:n.id,name:n.name||"unknown",type:n.type||0,parentName:n.parent_id&&((i=(r=u?.getChannel)==null?void 0:r.call(u,n.parent_id))==null?void 0:i.name)||"",rolesWithAccess:ce(n,e)}));f.logger.log("Hidden found:",a.length)}catch(l){f.logger.error("getHiddenChannels error:",l)}return a.sort(function(l,n){return l.name.localeCompare(n.name)})}function ce(e,r){var i,a;const l=[];try{const n=e.permissionOverwrites||{},s=(i=k?.getGuild)==null?void 0:i.call(k,r),g=1024;for(const[h,R]of Object.entries(n))if(R&&Number(R.allow||0)&g&&(R.type===0||R.type==="role")){const p=(a=s?.roles)==null?void 0:a[h];p&&p.name!=="@everyone"&&l.push({id:p.id,name:p.name,color:p.color||0})}}catch{}return l}function se(e,r){var i;const a=ne(e),l=(i=D?.getMember)==null?void 0:i.call(D,e,r);return l!=null&&l.roles?a.filter(function(n){return n.rolesWithAccess.some(function(s){return l.roles.includes(s.id)})}):[]}function de(e){if(!k||!D)return[];try{return Object.values(k.getGuilds()||{}).filter(function(r){return D.getMember(r.id,e)})}catch{return[]}}async function ge(e,r){var i;if(!(L!=null&&L.get))return[];try{const a=await L.get({url:`/guilds/${e}/messages/search`,query:{author_id:r,include_nsfw:!0,sort_by:"timestamp",sort_order:"desc"}});return(((i=a?.body)==null?void 0:i.messages)||[]).map(function(l){return{id:l[0].id,content:l[0].content||"[No text]",channelId:l[0].channel_id,guildId:e,timestamp:l[0].timestamp}})}catch{return[]}}function fe(e){var r;return((r=u?.getChannel(e))==null?void 0:r.name)||"unknown"}async function le(e){var r;const i=(r=M?.getCurrentUser)==null?void 0:r.call(M);if(i&&e===i.id)return;const a=de(e);if(a.length===0){C.showToast("\u274C No mutual servers",S.getAssetIDByName("Small"));return}C.showToast("\u{1F50D} Searching...",S.getAssetIDByName("ic_search"));let l=[];for(let g=0;g<Math.min(a.length,8);g++){try{l.push(...await ge(a[g].id,e))}catch{}g<a.length-1&&await new Promise(function(h){return setTimeout(h,250)})}if(l.sort(function(g,h){return new Date(h.timestamp).getTime()-new Date(g.timestamp).getTime()}),l.length===0){C.showToast("\u{1F4ED} No messages",S.getAssetIDByName("Small"));return}C.showToast(`\u2705 Found ${l.length}!`,S.getAssetIDByName("Check"));const n=l[0],s=`https://discord.com/channels/${n.guildId}/${n.channelId}/${n.id}`;setTimeout(function(){const g=new Date(n.timestamp),h=Date.now()-g.getTime(),R=Math.floor(h/6e4),p=Math.floor(R/60),T=Math.floor(p/24),F=R<60?`${R}m`:p<24?`${p}h`:`${T}d`;C.showToast(`\u{1F4CD} #${fe(n.channelId)} (${F})`,S.getAssetIDByName("ic_message"))},1500),setTimeout(function(){E!=null&&E.setString&&(E.setString(s),C.showToast("\u{1F4CB} Copied!",S.getAssetIDByName("Check")))},3e3)}async function he(){try{if(!(E!=null&&E.getString))return;const e=await E.getString();e&&e!==X&&/^\d{17,19}$/.test(e.trim())&&(X=e,C.showToast("\u{1F3AF} ID detected!",S.getAssetIDByName("Check")),setTimeout(function(){return le(e.trim())},1e3))}catch{}}function ye(){const[e,r]=t.React.useState("hidden"),[i,a]=t.React.useState([]),[l,n]=t.React.useState(!1),[s,g]=t.React.useState(null),[h,R]=t.React.useState(null),[p,T]=t.React.useState(""),[F,Ce]=t.React.useState(""),[x,Re]=t.React.useState([]),[P,be]=t.React.useState(""),[ke,re]=t.React.useState(!1);t.React.useEffect(function(){ae()},[]);const ae=function(){var o,v;n(!0);try{const d=(o=A?.getGuildId)==null?void 0:o.call(A);if(d){const H=(v=k?.getGuild)==null?void 0:v.call(k,d);g(H);const G=ne(d);a(G);const Fe=te(d);T(`${Fe.length} ch \u2192 ${G.length} hidden`),C.showToast(G.length>0?`\u{1F512} ${G.length} hidden!`:"\u2728 No hidden",S.getAssetIDByName("Check"))}else g(null),a([]),T("Open server first")}catch(d){T(`Error: ${d}`)}finally{n(!1)}},Ee=async function(){!P||P.length<17||(re(!0),await le(P),re(!1))},me=function(){var o;if(!F||F.length<17)return;const v=(o=A?.getGuildId)==null?void 0:o.call(A);if(!v)return;const d=se(v,F);Re(d),C.showToast(`${d.length} hidden`,S.getAssetIDByName("Check"))},Ae=function(o){return o?`#${o.toString(16).padStart(6,"0")}`:"#99AAB5"},U=function({id:o,label:v,icon:d}){return t.React.createElement(z,{style:{flex:1,padding:10,backgroundColor:e===o?"#5865F2":"#2b2d31",borderRadius:8,marginHorizontal:2},onPress:function(){return r(o)}},t.React.createElement(c,{style:{color:"#fff",textAlign:"center",fontSize:12,fontWeight:e===o?"bold":"normal"}},`${d} ${v}`))};return t.React.createElement(oe,{style:{flex:1,backgroundColor:"#1e1f22"}},[t.React.createElement(m,{key:"h",style:{padding:16,backgroundColor:"#2b2d31",marginBottom:8}},[t.React.createElement(c,{key:"t",style:{color:"#fff",fontSize:20,fontWeight:"bold",textAlign:"center"}},"\u{1F50D} Stalker Pro v4.0"),t.React.createElement(c,{key:"s",style:{color:"#b5bac1",fontSize:12,textAlign:"center",marginTop:4}},s?`\u{1F4CD} ${s.name}`:"Open a server")]),t.React.createElement(m,{key:"tabs",style:{flexDirection:"row",padding:8,marginBottom:8}},[t.React.createElement(U,{key:"1",id:"hidden",label:"Hidden",icon:"\u{1F512}"}),t.React.createElement(U,{key:"2",id:"user",label:"User",icon:"\u{1F464}"}),t.React.createElement(U,{key:"3",id:"search",label:"Msgs",icon:"\u{1F4AC}"})]),e==="hidden"&&[t.React.createElement(z,{key:"scan",style:{margin:12,padding:14,backgroundColor:"#5865F2",borderRadius:12,alignItems:"center"},onPress:ae},t.React.createElement(c,{style:{color:"#fff",fontWeight:"bold",fontSize:16}},l?"\u23F3...":"\u{1F504} Scan Server")),t.React.createElement(c,{key:"dbg",style:{color:"#949ba4",textAlign:"center",fontSize:11,marginBottom:8}},p),t.React.createElement(c,{key:"info",style:{color:"#5865F2",textAlign:"center",fontSize:10,marginBottom:8}},`Permissions: ${b?"\u2705":"\u274C"} | Patched: ${B.length>0?"\u2705":"\u274C"}`),...i.map(function(o,v){return t.React.createElement(z,{key:`c${v}`,style:{margin:8,marginTop:4,padding:14,backgroundColor:"#2b2d31",borderRadius:12,borderLeftWidth:4,borderLeftColor:"#5865F2"},onPress:function(){return R(h===o.id?null:o.id)}},[t.React.createElement(m,{key:"h",style:{flexDirection:"row",alignItems:"center"}},[t.React.createElement(c,{key:"i",style:{fontSize:18,marginRight:10}},ee(o.type)),t.React.createElement(m,{key:"n",style:{flex:1}},[t.React.createElement(c,{key:"nm",style:{color:"#fff",fontSize:16,fontWeight:"bold"}},o.name),o.parentName&&t.React.createElement(c,{key:"p",style:{color:"#949ba4",fontSize:12}},`in ${o.parentName}`)]),t.React.createElement(c,{key:"a",style:{color:"#b5bac1"}},h===o.id?"\u25BC":"\u25B6")]),t.React.createElement(c,{key:"r",style:{color:"#00b894",fontSize:12,marginTop:6}},`\u{1F465} ${o.rolesWithAccess.length} roles`),h===o.id&&t.React.createElement(m,{key:"d",style:{marginTop:12,paddingTop:12,borderTopWidth:1,borderTopColor:"#3f4147"}},o.rolesWithAccess.map(function(d,H){return t.React.createElement(c,{key:`r${H}`,style:{color:Ae(d.color),marginLeft:12,marginTop:2}},`\u2022 ${d.name}`)}))])}),i.length===0&&!l&&t.React.createElement(m,{key:"empty",style:{padding:30,alignItems:"center"}},[t.React.createElement(c,{key:"e1",style:{fontSize:40}},s?"\u{1F513}":"\u{1F4CD}"),t.React.createElement(c,{key:"e2",style:{color:"#fff",fontSize:16,marginTop:10}},s?"No hidden channels":"Open a server")])],e==="user"&&[t.React.createElement(N,{key:"us",title:"\u{1F464} USER ACCESS"},[t.React.createElement(Y,{key:"in",title:"User ID",placeholder:"Enter ID",value:F,onChangeText:Ce,keyboardType:"numeric"}),t.React.createElement(w,{key:"btn",label:"\u{1F50D} Check",onPress:me})]),x.length>0&&t.React.createElement(N,{key:"res",title:`\u2705 ${x.length} hidden:`},x.map(function(o,v){return t.React.createElement(w,{key:`uc${v}`,label:`${ee(o.type)} ${o.name}`})}))],e==="search"&&[t.React.createElement(N,{key:"auto",title:"\u{1F4AC} MESSAGES"},[t.React.createElement(w,{key:"a1",label:"\u{1F4CB} Auto-detect",subLabel:Q?"\u2705 Active":"\u274C"})]),t.React.createElement(N,{key:"man",title:"\u{1F50D} SEARCH"},[t.React.createElement(Y,{key:"in",title:"User ID",value:P,onChangeText:be,keyboardType:"numeric"}),t.React.createElement(w,{key:"btn",label:ke?"\u23F3...":"\u{1F50D} Find",onPress:Ee})])]])}const pe=ye,ve=function(){if(f.logger.log("=== STALKER PRO v4.0 ==="),f.logger.log("Permissions module found:",!!b),b!=null&&b.can){const e=ie.after("can",b,function([r,i],a){return i!=null&&i.realCheck?a:r===W?!0:a});B.push(e),f.logger.log("\u2705 Patched Permissions.can!")}else f.logger.error("\u274C Could not find Permissions module to patch!");E!=null&&E.getString&&(Q=!0,$=setInterval(he,2e3)),C.showToast("\u{1F50D} Stalker Pro v4.0",S.getAssetIDByName("Check"))},Se=function(){f.logger.log("Unloading, removing patches..."),$&&(clearInterval($),$=null);for(const e of B)try{e()}catch{}B=[]};return I.onLoad=ve,I.onUnload=Se,I.settings=pe,I})({},vendetta,vendetta.metro,vendetta.metro.common,vendetta.ui.components,vendetta.ui.assets,vendetta.ui.toasts,vendetta.patcher);
