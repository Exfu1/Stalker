(function(G,h,v,e,K,b,m,ie){"use strict";var Q;const{FormSection:O,FormRow:P,FormInput:X}=K.Forms,{ScrollView:oe,View:D,Text:y,TouchableOpacity:H}=K.General,T=v.findByStoreName("UserStore"),k=v.findByStoreName("GuildStore"),E=v.findByStoreName("GuildMemberStore"),d=v.findByStoreName("ChannelStore"),$=v.findByStoreName("SelectedGuildStore"),U=v.findByStoreName("PermissionStore"),j=v.findByStoreName("GuildChannelStore"),F=((Q=e.ReactNative)==null?void 0:Q.Clipboard)||v.findByProps("setString","getString"),V=v.findByProps("getAPIBaseURL","get")||v.findByProps("API_HOST","get"),z=1024;let Y=!1,Z="",M=null,_=[];function ce(){if(!j){h.logger.warn("GuildChannelStore not found for patching");return}try{if(j.getChannels){const t=ie.after("getChannels",j,function(a,c){return h.logger.log("getChannels called for guild:",a[0]),c});_.push(t),h.logger.log("Patched GuildChannelStore.getChannels")}}catch(t){h.logger.error("Failed to patch GuildChannelStore:",t)}}function ee(t){switch(t){case 0:return"\u{1F4AC}";case 2:return"\u{1F50A}";case 4:return"\u{1F4C1}";case 5:return"\u{1F4E2}";case 13:return"\u{1F3AD}";case 15:return"\u{1F4CB}";default:return"\u{1F4DD}"}}function te(t){var a,c,u;const n=[];try{const s=((a=d?.getAllChannels)==null?void 0:a.call(d))||((c=d?.getChannels)==null?void 0:c.call(d))||{};if(Array.isArray(s))for(const l of s)l?.guild_id===t&&n.push(l);else for(const l of Object.values(s))l?.guild_id===t&&n.push(l);if(h.logger.log("Method 1 (getAllChannels) count:",n.length),n.length===0){const l=((u=d?.getMutableGuildChannelsForGuild)==null?void 0:u.call(d,t))||{};for(const g of Object.values(l))g!=null&&g.id&&n.push(g);h.logger.log("Method 2 (getMutableGuildChannelsForGuild) count:",n.length)}if(d!=null&&d.__getLocalVars)try{const l=d.__getLocalVars();h.logger.log("ChannelStore local vars keys:",Object.keys(l||{}))}catch{}}catch(s){h.logger.error("getAllChannelsIncludingHidden error:",s)}return n}function ne(t){var a,c,u,n,s,l,g;const f=[];try{h.logger.log("=== SCANNING FOR HIDDEN CHANNELS ==="),h.logger.log("Guild ID:",t);const i=te(t);h.logger.log("Total channels retrieved:",i.length),i.length>0&&h.logger.log("Sample channel:",JSON.stringify({id:i[0].id,name:i[0].name,type:i[0].type,hasOverwrites:!!i[0].permissionOverwrites}));let C=0,A=0,R=0;for(const o of i){if(!(o!=null&&o.id)||o.type===4||o.type===1||o.type===3||o.type===11||o.type===12)continue;if(C++,((a=U?.can)==null?void 0:a.call(U,z,o))===!1){A++,f.push({id:o.id,name:o.name||"unknown",type:o.type||0,parentName:o.parent_id&&((u=(c=d?.getChannel)==null?void 0:c.call(d,o.parent_id))==null?void 0:u.name)||"",rolesWithAccess:le(o,t)});continue}const N=o.permissionOverwrites||{},L=t;if(N[L]&&Number(N[L].deny||0)&z){const w=(n=T?.getCurrentUser)==null?void 0:n.call(T),B=(s=E?.getMember)==null?void 0:s.call(E,t,w?.id);let W=!1;if(B!=null&&B.roles){for(const I of B.roles)if(N[I]&&Number(N[I].allow||0)&z){W=!0;break}}W||(R++,f.push({id:o.id,name:o.name||"unknown",type:o.type||0,parentName:o.parent_id&&((g=(l=d?.getChannel)==null?void 0:l.call(d,o.parent_id))==null?void 0:g.name)||"",rolesWithAccess:le(o,t)}))}}h.logger.log(`Checked: ${C}, HiddenByPerms: ${A}, HiddenByOverwrites: ${R}`),h.logger.log("Final hidden count:",f.length)}catch(i){h.logger.error("getHiddenChannels error:",i)}return f.sort(function(i,C){return i.name.localeCompare(C.name)})}function le(t,a){var c,u;const n=[];try{const s=t.permissionOverwrites||{},l=(c=k?.getGuild)==null?void 0:c.call(k,a);for(const[g,f]of Object.entries(s))if(f&&Number(f.allow||0)&z&&(f.type===0||f.type==="role")){const i=(u=l?.roles)==null?void 0:u[g];i&&i.name!=="@everyone"&&n.push({id:i.id,name:i.name,color:i.color||0})}}catch{}return n}function ue(t,a){var c;const u=ne(t),n=(c=E?.getMember)==null?void 0:c.call(E,t,a);return n!=null&&n.roles?u.filter(function(s){return s.rolesWithAccess.some(function(l){return n.roles.includes(l.id)})}):[]}function se(t){if(!k||!E)return[];try{return Object.values(k.getGuilds()||{}).filter(function(a){return E.getMember(a.id,t)})}catch{return[]}}async function de(t,a){var c;if(!(V!=null&&V.get))return[];try{const u=await V.get({url:`/guilds/${t}/messages/search`,query:{author_id:a,include_nsfw:!0,sort_by:"timestamp",sort_order:"desc"}});return(((c=u?.body)==null?void 0:c.messages)||[]).map(function(n){return{id:n[0].id,content:n[0].content||"[No text]",channelId:n[0].channel_id,guildId:t,timestamp:n[0].timestamp}})}catch{return[]}}function ge(t){var a;return((a=d?.getChannel(t))==null?void 0:a.name)||"unknown"}async function re(t){var a;const c=(a=T?.getCurrentUser)==null?void 0:a.call(T);if(c&&t===c.id)return;const u=se(t);if(u.length===0){m.showToast("\u274C No mutual servers",b.getAssetIDByName("Small"));return}m.showToast("\u{1F50D} Searching...",b.getAssetIDByName("ic_search"));let n=[];for(let g=0;g<Math.min(u.length,8);g++){try{n.push(...await de(u[g].id,t))}catch{}g<u.length-1&&await new Promise(function(f){return setTimeout(f,250)})}if(n.sort(function(g,f){return new Date(f.timestamp).getTime()-new Date(g.timestamp).getTime()}),n.length===0){m.showToast("\u{1F4ED} No messages",b.getAssetIDByName("Small"));return}m.showToast(`\u2705 Found ${n.length}!`,b.getAssetIDByName("Check"));const s=n[0],l=`https://discord.com/channels/${s.guildId}/${s.channelId}/${s.id}`;setTimeout(function(){const g=new Date(s.timestamp),f=Date.now()-g.getTime(),i=Math.floor(f/6e4),C=Math.floor(i/60),A=Math.floor(C/24),R=i<60?`${i}m`:C<24?`${C}h`:`${A}d`;m.showToast(`\u{1F4CD} #${ge(s.channelId)} (${R})`,b.getAssetIDByName("ic_message"))},1500),setTimeout(function(){F!=null&&F.setString&&(F.setString(l),m.showToast("\u{1F4CB} Copied!",b.getAssetIDByName("Check")))},3e3)}async function fe(){try{if(!(F!=null&&F.getString))return;const t=await F.getString();t&&t!==Z&&/^\d{17,19}$/.test(t.trim())&&(Z=t,m.showToast("\u{1F3AF} ID detected!",b.getAssetIDByName("Check")),setTimeout(function(){return re(t.trim())},1e3))}catch{}}function he(){const[t,a]=e.React.useState("hidden"),[c,u]=e.React.useState([]),[n,s]=e.React.useState(!1),[l,g]=e.React.useState(null),[f,i]=e.React.useState(null),[C,A]=e.React.useState(""),[R,o]=e.React.useState(""),[N,L]=e.React.useState([]),[w,B]=e.React.useState(""),[W,I]=e.React.useState(!1);e.React.useEffect(function(){ae()},[]);const ae=function(){var r,S;s(!0);try{const p=(r=$?.getGuildId)==null?void 0:r.call($);if(p){const J=(S=k?.getGuild)==null?void 0:S.call(k,p);g(J);const x=ne(p);u(x);const Ce=te(p);A(`Scanned ${Ce.length} ch | Found ${x.length} hidden`),m.showToast(x.length>0?`\u{1F512} ${x.length} hidden!`:"\u2728 No hidden",b.getAssetIDByName("Check"))}else g(null),u([]),A("Open a server first")}catch(p){A(`Error: ${p}`)}finally{s(!1)}},ve=async function(){!w||w.length<17||(I(!0),await re(w),I(!1))},be=function(){var r;if(!R||R.length<17)return;const S=(r=$?.getGuildId)==null?void 0:r.call($);if(!S)return;const p=ue(S,R);L(p),m.showToast(`${p.length} hidden access`,b.getAssetIDByName("Check"))},me=function(r){return r?`#${r.toString(16).padStart(6,"0")}`:"#99AAB5"},q=function({id:r,label:S,icon:p}){return e.React.createElement(H,{style:{flex:1,padding:10,backgroundColor:t===r?"#5865F2":"#2b2d31",borderRadius:8,marginHorizontal:2},onPress:function(){return a(r)}},e.React.createElement(y,{style:{color:"#fff",textAlign:"center",fontSize:12,fontWeight:t===r?"bold":"normal"}},`${p} ${S}`))};return e.React.createElement(oe,{style:{flex:1,backgroundColor:"#1e1f22"}},[e.React.createElement(D,{key:"h",style:{padding:16,backgroundColor:"#2b2d31",marginBottom:8}},[e.React.createElement(y,{key:"t",style:{color:"#fff",fontSize:20,fontWeight:"bold",textAlign:"center"}},"\u{1F50D} Stalker Pro v3.3"),e.React.createElement(y,{key:"s",style:{color:"#b5bac1",fontSize:12,textAlign:"center",marginTop:4}},l?`\u{1F4CD} ${l.name}`:"Open a server")]),e.React.createElement(D,{key:"tabs",style:{flexDirection:"row",padding:8,marginBottom:8}},[e.React.createElement(q,{key:"1",id:"hidden",label:"Hidden",icon:"\u{1F512}"}),e.React.createElement(q,{key:"2",id:"user",label:"User",icon:"\u{1F464}"}),e.React.createElement(q,{key:"3",id:"search",label:"Msgs",icon:"\u{1F4AC}"})]),t==="hidden"&&[e.React.createElement(H,{key:"scan",style:{margin:12,padding:14,backgroundColor:"#5865F2",borderRadius:12,alignItems:"center"},onPress:ae},e.React.createElement(y,{style:{color:"#fff",fontWeight:"bold",fontSize:16}},n?"\u23F3 Scanning...":"\u{1F504} Scan Server")),e.React.createElement(y,{key:"dbg",style:{color:"#949ba4",textAlign:"center",fontSize:11,marginBottom:8}},C),...c.map(function(r,S){return e.React.createElement(H,{key:`c${S}`,style:{margin:8,marginTop:4,padding:14,backgroundColor:"#2b2d31",borderRadius:12,borderLeftWidth:4,borderLeftColor:"#5865F2"},onPress:function(){return i(f===r.id?null:r.id)}},[e.React.createElement(D,{key:"h",style:{flexDirection:"row",alignItems:"center"}},[e.React.createElement(y,{key:"i",style:{fontSize:18,marginRight:10}},ee(r.type)),e.React.createElement(D,{key:"n",style:{flex:1}},[e.React.createElement(y,{key:"nm",style:{color:"#fff",fontSize:16,fontWeight:"bold"}},r.name),r.parentName&&e.React.createElement(y,{key:"p",style:{color:"#949ba4",fontSize:12}},`in ${r.parentName}`)]),e.React.createElement(y,{key:"a",style:{color:"#b5bac1"}},f===r.id?"\u25BC":"\u25B6")]),e.React.createElement(y,{key:"r",style:{color:"#00b894",fontSize:12,marginTop:6}},`\u{1F465} ${r.rolesWithAccess.length} roles`),f===r.id&&e.React.createElement(D,{key:"d",style:{marginTop:12,paddingTop:12,borderTopWidth:1,borderTopColor:"#3f4147"}},r.rolesWithAccess.map(function(p,J){return e.React.createElement(y,{key:`r${J}`,style:{color:me(p.color),marginLeft:12,marginTop:2}},`\u2022 ${p.name}`)}))])}),c.length===0&&!n&&e.React.createElement(D,{key:"empty",style:{padding:30,alignItems:"center"}},[e.React.createElement(y,{key:"e1",style:{fontSize:40}},l?"\u{1F513}":"\u{1F4CD}"),e.React.createElement(y,{key:"e2",style:{color:"#fff",fontSize:16,marginTop:10}},l?"No hidden channels":"Open a server"),e.React.createElement(y,{key:"e3",style:{color:"#b5bac1",marginTop:4,textAlign:"center",fontSize:11}},"Check Debug Logs for details")])],t==="user"&&[e.React.createElement(O,{key:"us",title:"\u{1F464} USER ACCESS"},[e.React.createElement(X,{key:"in",title:"User ID",placeholder:"Enter ID",value:R,onChangeText:o,keyboardType:"numeric"}),e.React.createElement(P,{key:"btn",label:"\u{1F50D} Check",onPress:be})]),N.length>0&&e.React.createElement(O,{key:"res",title:`\u2705 ${N.length} hidden:`},N.map(function(r,S){return e.React.createElement(P,{key:`uc${S}`,label:`${ee(r.type)} ${r.name}`})}))],t==="search"&&[e.React.createElement(O,{key:"auto",title:"\u{1F4AC} MESSAGES"},[e.React.createElement(P,{key:"a1",label:"\u{1F4CB} Auto-detect",subLabel:Y?"\u2705 Active":"\u274C"})]),e.React.createElement(O,{key:"man",title:"\u{1F50D} SEARCH"},[e.React.createElement(X,{key:"in",title:"User ID",value:w,onChangeText:B,keyboardType:"numeric"}),e.React.createElement(P,{key:"btn",label:W?"\u23F3...":"\u{1F50D} Find",onPress:ve})])]])}const ye=he,pe=function(){h.logger.log("=== STALKER PRO v3.3 ==="),ce(),F!=null&&F.getString&&(Y=!0,M=setInterval(fe,2e3)),m.showToast("\u{1F50D} Stalker Pro v3.3",b.getAssetIDByName("Check"))},Se=function(){M&&(clearInterval(M),M=null);for(const t of _)try{t()}catch{}_=[]};return G.onLoad=pe,G.onUnload=Se,G.settings=ye,G})({},vendetta,vendetta.metro,vendetta.metro.common,vendetta.ui.components,vendetta.ui.assets,vendetta.ui.toasts,vendetta.patcher);
