(function(T,h,d,n,F,i,o){"use strict";var U,P;const{FormSection:p,FormRow:y,FormInput:W}=F.Forms,{ScrollView:J,View:K,Text:D,TouchableOpacity:Q,ActivityIndicator:Z,Clipboard:X}=F.General,f=X||((U=n.ReactNative)==null?void 0:U.Clipboard)||d.findByProps("getString","setString"),S=d.findByStoreName("UserStore"),v=d.findByStoreName("GuildStore"),L=d.findByStoreName("GuildMemberStore"),M=d.findByStoreName("ChannelStore"),A=d.findByProps("getAPIBaseURL","get")||d.findByProps("API_HOST","get");d.findByProps("transitionToGuild","transitionTo")||d.findByProps("transitionTo");const G=d.findByProps("jumpToMessage"),R=d.findByProps("openURL")||((P=n.ReactNative)==null?void 0:P.Linking);let O="",I=null,w=null,_="";function E(t){if(!v||!L)return[];try{return Object.values(v.getGuilds()||{}).filter(function(e){return L.getMember(e.id,t)})}catch{return[]}}async function V(t,e){var l;if(!(A!=null&&A.get))return[];try{const u=await A.get({url:`/guilds/${t}/messages/search`,query:{author_id:e,include_nsfw:!0}});return(((l=u?.body)==null?void 0:l.messages)||[]).map(function(a){return{id:a[0].id,content:a[0].content||"[No text]",channelId:a[0].channel_id,guildId:t,timestamp:a[0].timestamp}})}catch{return[]}}function z(t){var e;return((e=M?.getChannel(t))==null?void 0:e.name)||"unknown"}function j(t){var e;return((e=v?.getGuild(t))==null?void 0:e.name)||"Unknown"}function N(t){const e=S?.getUser(t);return e?{username:e.username,globalName:e.globalName,id:e.id}:null}function H(t,e,l){var u,a;try{return(u=n.FluxDispatcher)==null||u.dispatch({type:"NAVIGATE_TO_JUMP_TO_MESSAGE",messageId:l,channelId:e,guildId:t}),!0}catch{}try{return G?.jumpToMessage({channelId:e,messageId:l,flash:!0}),!0}catch{}try{return(a=R?.openURL)==null||a.call(R,`discord://-/channels/${t}/${e}/${l}`),!0}catch{}return!1}function Y(t){const e=t.trim();return/^\d{17,19}$/.test(e)}async function ee(t){const e=E(t),l=N(t);if(e.length===0){o.showToast("No mutual servers found",i.getAssetIDByName("Small"));return}const u=l?.globalName||l?.username||t;o.showToast(`\u{1F50D} Searching for ${u}...`,i.getAssetIDByName("ic_search"));let a=[];for(let r=0;r<Math.min(e.length,10);r++){try{const s=await V(e[r].id,t);a.push(...s)}catch{}r<e.length-1&&await new Promise(function(s){return setTimeout(s,300)})}if(a.sort(function(r,s){return new Date(s.timestamp).getTime()-new Date(r.timestamp).getTime()}),a.length===0){o.showToast(`No messages found in ${e.length} servers`,i.getAssetIDByName("Small"));return}o.showToast(`\u2705 Found ${a.length} messages!`,i.getAssetIDByName("Check")),setTimeout(function(){const r=a[0];r.content.length>30?r.content.substring(0,30)+"":r.content;const s=z(r.channelId),B=j(r.guildId);o.showToast(`\u{1F4CD} #${s} in ${B}`,i.getAssetIDByName("ic_message")),w=t},1500),setTimeout(function(){if(a.length>0){const r=a[0];o.showToast("\u{1F446} Tap here to open latest message",i.getAssetIDByName("Arrow")),setTimeout(function(){H(r.guildId,r.channelId,r.id)},2e3)}},3500)}async function te(){var t;try{if(!(f!=null&&f.getString))return;const e=await f.getString();if(e&&e!==O&&(O=e,Y(e))){const l=e.trim();h.logger.log("User ID detected in clipboard:",l);const u=(t=S?.getCurrentUser)==null?void 0:t.call(S);if(u&&l===u.id)return;const a=N(l),r=E(l);if(a){const s=a.globalName||a.username;o.showToast(`\u{1F3AF} ${s} copied! Tap to search...`,i.getAssetIDByName("ic_search"))}else if(r.length>0)o.showToast("\u{1F3AF} User ID copied! Tap to search...",i.getAssetIDByName("ic_search"));else{o.showToast("\u{1F3AF} User ID copied (no mutual servers)",i.getAssetIDByName("Small"));return}w=l,setTimeout(function(){w===l&&(o.showToast(`\u{1F50E} Searching ${r.length} servers...`,i.getAssetIDByName("ic_search")),ee(l))},2e3)}}catch(e){h.logger.error("Clipboard check error:",e)}}function ne(){const[t,e]=n.React.useState(_),[l,u]=n.React.useState([]),[a,r]=n.React.useState(null),[s,B]=n.React.useState([]),[b,C]=n.React.useState(!1),[q,x]=n.React.useState(""),ie=async function(){if(!t||t.length<17){o.showToast("Invalid User ID",i.getAssetIDByName("Small"));return}C(!0),u([]),_=t;const c=N(t);r(c);const g=E(t);if(B(g),g.length===0){o.showToast("No mutual servers",i.getAssetIDByName("Small")),C(!1);return}const k=[];for(let m=0;m<Math.min(g.length,12);m++){x(`${g[m].name} (${m+1}/${Math.min(g.length,12)})`);const $=await V(g[m].id,t);k.push(...$),await new Promise(function(ue){return setTimeout(ue,350)})}k.sort(function(m,$){return new Date($.timestamp).getTime()-new Date(m.timestamp).getTime()}),u(k.slice(0,50)),o.showToast(`Found ${k.length} messages`,i.getAssetIDByName("Check")),C(!1),x("")},oe=function(c){try{const g=new Date(c);return`${g.toLocaleDateString()} ${g.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}`}catch{return c}};return n.React.createElement(J,{style:{flex:1,backgroundColor:"#1e1f22"}},[n.React.createElement(p,{key:"quick",title:"\u26A1 QUICK ACCESS"},[n.React.createElement(y,{key:"info",label:"Copy any User ID",subLabel:"Plugin auto-detects and searches!"}),n.React.createElement(y,{key:"how",label:"How to use",subLabel:"Long-press user \u2192 Copy ID \u2192 Wait for search"})]),n.React.createElement(p,{key:"search",title:"\u{1F50D} MANUAL SEARCH"},[n.React.createElement(W,{key:"in",title:"User ID",placeholder:"Enter Discord User ID",value:t,onChangeText:e,keyboardType:"numeric"}),n.React.createElement(y,{key:"btn",label:b?"\u23F3 Searching...":"\u{1F50D} Search All Servers",subLabel:b?q:"Find messages",onPress:b?void 0:ie})]),a&&n.React.createElement(p,{key:"user",title:"\u{1F464} USER"},[n.React.createElement(y,{key:"n",label:a.globalName||a.username,subLabel:`@${a.username} \u2022 ${a.id}`})]),s.length>0&&n.React.createElement(p,{key:"srv",title:`\u{1F3E0} SERVERS (${s.length})`},s.slice(0,15).map(function(c,g){return n.React.createElement(y,{key:`s${g}`,label:c.name})})),b&&n.React.createElement(K,{key:"load",style:{padding:20,alignItems:"center"}},[n.React.createElement(Z,{key:"sp",size:"large",color:"#5865f2"}),n.React.createElement(D,{key:"t",style:{color:"#b5bac1",marginTop:10}},q)]),!b&&l.length>0&&n.React.createElement(p,{key:"msgs",title:`\u{1F4AC} MESSAGES (${l.length})`},l.map(function(c,g){return n.React.createElement(Q,{key:`m${g}`,style:{padding:12,borderBottomWidth:1,borderBottomColor:"#3f4147",backgroundColor:"#2b2d31"},onPress:function(){o.showToast("Opening...",i.getAssetIDByName("Check")),H(c.guildId,c.channelId,c.id)}},[n.React.createElement(D,{key:"c",style:{color:"#5865f2",fontSize:12}},`#${z(c.channelId)} \u2022 ${j(c.guildId)}`),n.React.createElement(D,{key:"m",style:{color:"#f2f3f5",fontSize:14,marginVertical:3}},c.content.substring(0,120)),n.React.createElement(D,{key:"t",style:{color:"#949ba4",fontSize:11}},oe(c.timestamp)+" \u2022 Tap to open")])})),n.React.createElement(p,{key:"dbg",title:"\u{1F527} STATUS"},[n.React.createElement(y,{key:"d1",label:"Clipboard Monitor",subLabel:I?"\u2705 Active":"\u274C Inactive"}),n.React.createElement(y,{key:"d2",label:"Last Detected ID",subLabel:w||"None"})])])}const ae=ne,re=function(){h.logger.log("=== Stalker Pro Loading ==="),h.logger.log("ClipboardAPI available:",!!(f!=null&&f.getString)),f!=null&&f.getString?(I=setInterval(te,1500),h.logger.log("Clipboard monitoring started"),o.showToast("\u{1F50D} Stalker Pro ready! Copy a User ID to search",i.getAssetIDByName("Check"))):(h.logger.warn("Clipboard API not available"),o.showToast("Stalker Pro ready (manual mode)",i.getAssetIDByName("Check")))},le=function(){h.logger.log("Stalker Pro unloading..."),I&&(clearInterval(I),I=null,h.logger.log("Clipboard monitoring stopped"))};return T.onLoad=re,T.onUnload=le,T.settings=ae,T})({},vendetta,vendetta.metro,vendetta.metro.common,vendetta.ui.components,vendetta.ui.assets,vendetta.ui.toasts);
