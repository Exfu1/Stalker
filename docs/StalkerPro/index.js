(function(N,e,t,v,g,L,s,a){"use strict";const{FormSection:F,FormRow:d,FormDivider:I}=L.Forms,m=t.findByStoreName("UserStore"),B=t.findByStoreName("GuildStore"),P=t.findByStoreName("ChannelStore"),b=t.findByStoreName("MessageStore"),A=t.findByStoreName("GuildMemberStore");let k=[];function j(r){const f=B?Object.values(B.getGuilds()||{}):[],c=[];for(const u of f)A?.getMember(u.id,r)&&c.push(u);return c}function E(r,f){var c,u;const o=[];for(const S of f)try{const h=(P?Object.values(((c=P.getChannels)==null?void 0:c.call(P))||((u=P.getMutableGuildChannels)==null?void 0:u.call(P))||{}):[]).filter(function(n){return n.guild_id===S.id&&n.type===0});for(const n of h){const l=b?.getMessages(n.id);if(l!=null&&l._array){const y=l._array.filter(function(i){var U;return((U=i.author)==null?void 0:U.id)===r});for(let i=0;i<Math.min(y.length,3);i++)o.push({id:y[i].id,content:(y[i].content||"").substring(0,50),channel:n.name,guild:S.name})}}}catch{}return o.slice(0,10)}const M=function(){try{a.showToast("Stalker Pro: Initializing...",s.getAssetIDByName("Check"));const r=t.findByProps("UserProfileSection"),f=t.findByProps("default","UserProfileSection"),c=t.findByProps("UserProfileBody"),u=t.findByProps("UserProfileHeader");e.logger.log("UserProfile1 (UserProfileSection):",r?"FOUND":"NULL"),e.logger.log("UserProfile2 (default, UserProfileSection):",f?"FOUND":"NULL"),e.logger.log("UserProfile3 (UserProfileBody):",c?"FOUND":"NULL"),e.logger.log("UserProfile4 (UserProfileHeader):",u?"FOUND":"NULL");const o=r||f||c||u;if(!o){a.showToast("Stalker Pro: No profile module found!",s.getAssetIDByName("Small")),e.logger.error("Could not find any UserProfile module");return}const S=Object.keys(o);if(e.logger.log("UserProfile keys:",S.slice(0,10).join(", ")),!(o.default||o.UserProfileSection||o.UserProfileBody)){a.showToast("Stalker Pro: No patch target found!",s.getAssetIDByName("Small")),e.logger.error("UserProfile found but no patchable target. Keys:",S.join(", "));return}const h=o.default?"default":o.UserProfileSection?"UserProfileSection":"UserProfileBody";e.logger.log("Attempting to patch:",h),a.showToast(`Stalker Pro: Patching ${h}...`,s.getAssetIDByName("Check")),k.push(v.after(h,o,function(n,l){var y,i,U,C;e.logger.log("Profile patch triggered! Args:",n?.length);const p=((y=n[0])==null?void 0:y.userId)||((U=(i=n[0])==null?void 0:i.user)==null?void 0:U.id);if(!p)return e.logger.log("No userId found in args"),l;const D=m?.getCurrentUser();if(D&&p===D.id)return l;if((C=l?.props)!=null&&C.children&&Array.isArray(l.props.children)){const w=j(p),T=g.React.createElement(F,{key:"stalker-pro",title:"\u{1F50D} Stalker Pro"},[g.React.createElement(d,{key:"recent",label:"Recent Messages",subLabel:"Find their messages across servers",trailing:d.Arrow?g.React.createElement(d.Arrow,null):null,onPress:function(){const O=E(p,w);a.showToast(`Found ${O.length} messages`,s.getAssetIDByName("Check"))}}),g.React.createElement(I,{key:"div"}),g.React.createElement(d,{key:"hidden",label:"Hidden Channels",subLabel:"Channels they can see but you can't",trailing:d.Arrow?g.React.createElement(d.Arrow,null):null,onPress:function(){a.showToast(`Checking ${w.length} servers`,s.getAssetIDByName("Check"))}})]);l.props.children.push(T),e.logger.log("Stalker section injected!")}else e.logger.log("Cannot inject - res.props.children not an array");return l})),a.showToast("Stalker Pro loaded!",s.getAssetIDByName("Check")),e.logger.log("Stalker Pro plugin loaded successfully")}catch(r){a.showToast("Stalker Pro: Error loading!",s.getAssetIDByName("Small")),e.logger.error("Stalker Pro load error:",r)}},R=function(){for(const r of k)r?.();k=[],e.logger.log("Stalker Pro plugin unloaded")};return N.onLoad=M,N.onUnload=R,N})({},vendetta,vendetta.metro,vendetta.patcher,vendetta.metro.common,vendetta.ui.components,vendetta.ui.assets,vendetta.ui.toasts);
