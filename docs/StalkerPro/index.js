(function($,k,E,e,_,y,h){"use strict";var H;const{FormSection:U,FormRow:T,FormInput:V,FormDivider:ve,FormSwitchRow:Re}=_.Forms,{ScrollView:Y,View:F,Text:u,TouchableOpacity:G,ActivityIndicator:Ae}=_.General,p=E.findByStoreName("UserStore"),b=E.findByStoreName("GuildStore"),B=E.findByStoreName("GuildMemberStore"),R=E.findByStoreName("ChannelStore"),w=E.findByStoreName("SelectedGuildStore"),P=E.findByStoreName("PermissionStore"),N=((H=e.ReactNative)==null?void 0:H.Clipboard)||E.findByProps("setString","getString"),O=E.findByProps("getAPIBaseURL","get")||E.findByProps("API_HOST","get"),j=E.findByProps("VIEW_CHANNEL","SEND_MESSAGES")||{VIEW_CHANNEL:1024,SEND_MESSAGES:2048};let z=!1,K="",L=null;function q(t){switch(t){case 0:return"\u{1F4AC}";case 2:return"\u{1F50A}";case 4:return"\u{1F4C1}";case 5:return"\u{1F4E2}";case 13:return"\u{1F3AD}";case 15:return"\u{1F4CB}";default:return"\u{1F4DD}"}}function Z(t){var n;try{return P?((n=P.can)==null?void 0:n.call(P,j.VIEW_CHANNEL,{id:t}))!==!1:!0}catch{return!0}}function J(t){var n,c,s,a;try{if(!R||!b)return[];const g=Object.values(((n=R.getMutableGuildChannelsForGuild)==null?void 0:n.call(R,t))||((c=R.getMutableGuildChannels)==null?void 0:c.call(R))||{}).filter(function(l){return l.guild_id===t}),o=[];for(const l of g)if(!(!l||l.type===1||l.type===3||l.type===11||l.type===12)&&!Z(l.id)){const m=ee(l,t);o.push({id:l.id,name:l.name||"Unknown",type:l.type,parentId:l.parent_id,parentName:l.parent_id&&((a=(s=R.getChannel)==null?void 0:s.call(R,l.parent_id))==null?void 0:a.name)||"",usersWithAccess:m.users,rolesWithAccess:m.roles})}return o.sort(function(l,m){return l.name.localeCompare(m.name)})}catch(g){return k.logger.error("Error getting hidden channels:",g),[]}}function ee(t,n){var c,s,a;const g=[],o=[];try{const l=t.permissionOverwrites||t.permission_overwrites||{},m=(c=b?.getGuild)==null?void 0:c.call(b,n);for(const[I,f]of Object.entries(l))if(f&&Number(f.allow||0)&Number(j.VIEW_CHANNEL)){if(f.type===1||f.type==="member"){const i=(s=p?.getUser)==null?void 0:s.call(p,I);i&&g.push({id:i.id,username:i.username,globalName:i.globalName})}else if(f.type===0||f.type==="role"){const i=(a=m?.roles)==null?void 0:a[I];i&&i.name!=="@everyone"&&o.push({id:i.id,name:i.name,color:i.color||0})}}}catch(l){k.logger.error("Error getting access info:",l)}return{users:g,roles:o}}function te(t,n){var c;try{const s=J(t),a=(c=B?.getMember)==null?void 0:c.call(B,t,n);return s.filter(function(g){return g.usersWithAccess.some(function(o){return o.id===n})?!0:a!=null&&a.roles?g.rolesWithAccess.some(function(o){return a.roles.includes(o.id)}):!1})}catch{return[]}}function ne(t){if(!b||!B)return[];try{return Object.values(b.getGuilds()||{}).filter(function(n){return B.getMember(n.id,t)})}catch{return[]}}async function re(t,n){var c;if(!(O!=null&&O.get))return[];try{const s=await O.get({url:`/guilds/${t}/messages/search`,query:{author_id:n,include_nsfw:!0}});return(((c=s?.body)==null?void 0:c.messages)||[]).map(function(a){return{id:a[0].id,content:a[0].content||"[No text]",channelId:a[0].channel_id,guildId:t,timestamp:a[0].timestamp}})}catch{return[]}}function le(t){var n;return((n=R?.getChannel(t))==null?void 0:n.name)||"unknown"}function ae(t){var n;return((n=b?.getGuild(t))==null?void 0:n.name)||"Unknown"}function ie(t){const n=p?.getUser(t);return n?{username:n.username,globalName:n.globalName,id:n.id}:null}function ce(t){return t?/^\d{17,19}$/.test(t.trim()):!1}async function Q(t){var n;const c=(n=p?.getCurrentUser)==null?void 0:n.call(p);if(c&&t===c.id)return;const s=ne(t),a=ie(t);if(s.length===0){h.showToast("\u274C No mutual servers",y.getAssetIDByName("Small"));return}const g=a?.globalName||a?.username||"User";h.showToast(`\u{1F50D} Searching ${g}...`,y.getAssetIDByName("ic_search"));let o=[];for(let i=0;i<Math.min(s.length,8);i++){try{const v=await re(s[i].id,t);o.push(...v)}catch{}i<s.length-1&&await new Promise(function(v){return setTimeout(v,250)})}if(o.sort(function(i,v){return new Date(v.timestamp).getTime()-new Date(i.timestamp).getTime()}),o.length===0){h.showToast("\u{1F4ED} No messages found",y.getAssetIDByName("Small"));return}h.showToast(`\u2705 Found ${o.length} messages!`,y.getAssetIDByName("Check"));const l=o[0],m=le(l.channelId),I=ae(l.guildId),f=`https://discord.com/channels/${l.guildId}/${l.channelId}/${l.id}`;setTimeout(function(){h.showToast(`\u{1F4CD} #${m} in ${I}`,y.getAssetIDByName("ic_message"))},1500),setTimeout(async function(){try{N!=null&&N.setString&&(N.setString(f),h.showToast("\u{1F4CB} Link copied!",y.getAssetIDByName("Check")))}catch(i){k.logger.error("Copy failed:",i)}},3e3)}async function se(){try{if(!(N!=null&&N.getString))return;const t=await N.getString();if(t&&t!==K&&ce(t)){K=t;const n=t.trim();h.showToast("\u{1F3AF} User ID detected!",y.getAssetIDByName("Check")),setTimeout(function(){return Q(n)},1e3)}}catch(t){k.logger.error("Clipboard error:",t)}}function oe(){const[t,n]=e.React.useState("hidden"),[c,s]=e.React.useState(""),[a,g]=e.React.useState(!1),[o,l]=e.React.useState([]),[m,I]=e.React.useState(!1),[f,i]=e.React.useState(null),[v,fe]=e.React.useState(null),[D,ye]=e.React.useState(""),[x,he]=e.React.useState([]),[W,pe]=e.React.useState(null);e.React.useEffect(function(){X()},[]);const X=function(){var r,S;I(!0);try{const d=(r=w?.getGuildId)==null?void 0:r.call(w);if(d){const C=(S=b?.getGuild)==null?void 0:S.call(b,d);i(C);const A=J(d);l(A),A.length>0&&h.showToast(`\u{1F512} Found ${A.length} hidden channels`,y.getAssetIDByName("Check"))}else i(null),l([])}catch(d){k.logger.error("Scan error:",d)}finally{I(!1)}},be=async function(){if(!c||c.length<17){h.showToast("Enter valid User ID",y.getAssetIDByName("Small"));return}g(!0),await Q(c),g(!1)},me=function(){var r,S;if(!D||D.length<17){h.showToast("Enter valid User ID",y.getAssetIDByName("Small"));return}const d=(r=w?.getGuildId)==null?void 0:r.call(w);if(!d){h.showToast("Open a server first!",y.getAssetIDByName("Small"));return}const C=te(d,D);he(C);const A=(S=p?.getUser)==null?void 0:S.call(p,D);pe(A);const Ee=A?.globalName||A?.username||D;h.showToast(`${Ee}: ${C.length} hidden channels`,y.getAssetIDByName("Check"))},Se=function(r){return r?`#${r.toString(16).padStart(6,"0")}`:"#99AAB5"},M=function({id:r,label:S,icon:d}){return e.React.createElement(G,{style:{flex:1,padding:10,backgroundColor:t===r?"#5865F2":"#2b2d31",borderRadius:8,marginHorizontal:2},onPress:function(){return n(r)}},e.React.createElement(u,{style:{color:"#fff",textAlign:"center",fontSize:12,fontWeight:t===r?"bold":"normal"}},`${d} ${S}`))};return e.React.createElement(Y,{style:{flex:1,backgroundColor:"#1e1f22"}},[e.React.createElement(F,{key:"header",style:{padding:16,backgroundColor:"#2b2d31",marginBottom:8}},[e.React.createElement(u,{key:"title",style:{color:"#fff",fontSize:20,fontWeight:"bold",textAlign:"center"}},"\u{1F50D} Stalker Pro v3.0"),e.React.createElement(u,{key:"subtitle",style:{color:"#b5bac1",fontSize:12,textAlign:"center",marginTop:4}},f?`\u{1F4CD} ${f.name}`:"Open a server for hidden channels")]),e.React.createElement(F,{key:"tabs",style:{flexDirection:"row",padding:8,marginBottom:8}},[e.React.createElement(M,{key:"t1",id:"hidden",label:"Hidden",icon:"\u{1F512}"}),e.React.createElement(M,{key:"t2",id:"user",label:"User Access",icon:"\u{1F464}"}),e.React.createElement(M,{key:"t3",id:"search",label:"Messages",icon:"\u{1F4AC}"})]),t==="hidden"&&[e.React.createElement(G,{key:"scan-btn",style:{margin:12,padding:14,backgroundColor:"#5865F2",borderRadius:12,flexDirection:"row",justifyContent:"center",alignItems:"center"},onPress:X},e.React.createElement(u,{style:{color:"#fff",fontWeight:"bold",fontSize:16}},m?"\u23F3 Scanning...":"\u{1F504} Scan Current Server")),e.React.createElement(u,{key:"count",style:{color:"#b5bac1",textAlign:"center",marginBottom:12,fontSize:14}},o.length>0?`Found ${o.length} hidden channels`:f?"No hidden channels found \u2728":"Open a server to scan"),...o.map(function(r,S){return e.React.createElement(G,{key:`ch-${S}`,style:{margin:8,marginTop:4,padding:14,backgroundColor:"#2b2d31",borderRadius:12,borderLeftWidth:4,borderLeftColor:"#5865F2"},onPress:function(){return fe(v===r.id?null:r.id)}},[e.React.createElement(F,{key:"hdr",style:{flexDirection:"row",alignItems:"center"}},[e.React.createElement(u,{key:"icon",style:{fontSize:18,marginRight:10}},q(r.type)),e.React.createElement(F,{key:"info",style:{flex:1}},[e.React.createElement(u,{key:"name",style:{color:"#fff",fontSize:16,fontWeight:"bold"}},r.name),r.parentName&&e.React.createElement(u,{key:"parent",style:{color:"#949ba4",fontSize:12}},`in ${r.parentName}`)]),e.React.createElement(u,{key:"arrow",style:{color:"#b5bac1"}},v===r.id?"\u25BC":"\u25B6")]),e.React.createElement(u,{key:"access",style:{color:"#00b894",fontSize:12,marginTop:6}},`\u{1F465} ${r.rolesWithAccess.length} roles, ${r.usersWithAccess.length} users`),v===r.id&&e.React.createElement(F,{key:"details",style:{marginTop:12,paddingTop:12,borderTopWidth:1,borderTopColor:"#3f4147"}},[r.rolesWithAccess.length>0&&e.React.createElement(u,{key:"roles-title",style:{color:"#fff",fontWeight:"bold",marginBottom:6}},"\u{1F3F7}\uFE0F Roles:"),...r.rolesWithAccess.map(function(d,C){return e.React.createElement(u,{key:`role-${C}`,style:{color:Se(d.color),marginLeft:12,marginTop:2,fontSize:14}},`\u2022 ${d.name}`)}),r.usersWithAccess.length>0&&e.React.createElement(u,{key:"users-title",style:{color:"#fff",fontWeight:"bold",marginTop:10,marginBottom:6}},"\u{1F464} Direct Access:"),...r.usersWithAccess.map(function(d,C){return e.React.createElement(u,{key:`user-${C}`,style:{color:"#b5bac1",marginLeft:12,marginTop:2,fontSize:14}},`\u2022 ${d.globalName||d.username}`)})])])})],t==="user"&&[e.React.createElement(U,{key:"user-section",title:"\u{1F464} USER LOOKUP"},[e.React.createElement(V,{key:"input",title:"User ID",placeholder:"Enter User ID to check their access",value:D,onChangeText:ye,keyboardType:"numeric"}),e.React.createElement(T,{key:"btn",label:"\u{1F50D} Check Access",subLabel:f?`In ${f.name}`:"Open a server first",trailing:T.Arrow?e.React.createElement(T.Arrow,null):null,onPress:me})]),x.length>0&&e.React.createElement(U,{key:"results",title:`\u2705 ${W?.globalName||W?.username||"User"} has access to:`},x.map(function(r,S){return e.React.createElement(T,{key:`uc-${S}`,label:`${q(r.type)} ${r.name}`,subLabel:r.parentName?`in ${r.parentName}`:void 0})})),x.length===0&&D.length>=17&&e.React.createElement(F,{key:"no-access",style:{padding:30,alignItems:"center"}},[e.React.createElement(u,{key:"t1",style:{fontSize:40}},"\u{1F6AB}"),e.React.createElement(u,{key:"t2",style:{color:"#fff",fontSize:16,marginTop:10}},"No hidden channel access"),e.React.createElement(u,{key:"t3",style:{color:"#b5bac1",marginTop:4,textAlign:"center"}},"This user can't see any channels you can't see")])],t==="search"&&[e.React.createElement(U,{key:"search-info",title:"\u{1F4AC} MESSAGE SEARCH"},[e.React.createElement(T,{key:"auto",label:"\u{1F4CB} Auto-Detection",subLabel:z?"\u2705 Copy any User ID to auto-search!":"\u274C Clipboard monitoring inactive"})]),e.React.createElement(U,{key:"manual",title:"\u{1F50D} MANUAL SEARCH"},[e.React.createElement(V,{key:"input",title:"User ID",placeholder:"Enter Discord User ID",value:c,onChangeText:s,keyboardType:"numeric"}),e.React.createElement(T,{key:"btn",label:a?"\u23F3 Searching...":"\u{1F50D} Search Messages",subLabel:"Find their recent messages across servers",onPress:a?void 0:be})])],e.React.createElement(F,{key:"footer",style:{padding:20,alignItems:"center"}},[e.React.createElement(u,{key:"tip",style:{color:"#949ba4",fontSize:11,textAlign:"center"}},`\u{1F4A1} Tip: Copy any User ID and it auto-searches!
\u{1F512} Open a server and tap Scan to find hidden channels`)])])}const ue=oe,de=function(){k.logger.log("=== STALKER PRO v3.0 LOADING ==="),N!=null&&N.getString&&(z=!0,L=setInterval(se,2e3),k.logger.log("Clipboard monitoring started")),h.showToast("\u{1F50D} Stalker Pro v3.0 ready!",y.getAssetIDByName("Check"))},ge=function(){k.logger.log("=== STALKER PRO UNLOADING ==="),L&&(clearInterval(L),L=null,z=!1)};return $.onLoad=de,$.onUnload=ge,$.settings=ue,$})({},vendetta,vendetta.metro,vendetta.metro.common,vendetta.ui.components,vendetta.ui.assets,vendetta.ui.toasts);
