(function(p,h,i,e,A,c,g){"use strict";const{FormSection:y,FormRow:o,FormDivider:ne,FormInput:C}=A.Forms,{ScrollView:M,View:G,Text:R,TouchableOpacity:O,ActivityIndicator:j}=A.General,P=i.findByStoreName("UserStore"),k=i.findByStoreName("GuildStore"),U=i.findByStoreName("GuildMemberStore"),$=i.findByStoreName("ChannelStore"),w=i.findByProps("transitionToGuild")||i.findByProps("transitionTo"),D=i.findByProps("jumpToMessage")||i.findByProps("transitionToGuildSync");i.findByProps("searchGuildMessages")||i.findByProps("search");const B=i.findByProps("getAPIBaseURL","get")||i.findByProps("API_HOST","get");let F="";function z(a){try{const n=k?Object.values(k.getGuilds()||{}):[],s=[];for(const l of n)U?.getMember(l.id,a)&&s.push(l);return s}catch(n){return h.logger.error("Error getting mutual guilds:",n),[]}}function H(a,n,s){try{if(D!=null&&D.jumpToMessage)return D.jumpToMessage({guildId:a,channelId:n,messageId:s}),!0;if(w!=null&&w.transitionTo)return w.transitionTo(`/channels/${a}/${n}/${s}`),!0}catch(l){h.logger.error("Error navigating to message:",l)}return!1}async function N(a,n){var s;try{if(!(B!=null&&B.get))return h.logger.error("RestAPI not found"),[];const l=await B.get({url:`/guilds/${a}/messages/search`,query:{author_id:n,include_nsfw:!0}});return(s=l?.body)!=null&&s.messages?l.body.messages.map(function(m){var T;const u=m[0];return{id:u.id,content:u.content||"[No text content]",channelId:u.channel_id,guildId:a,timestamp:u.timestamp,attachments:((T=u.attachments)==null?void 0:T.length)||0}}):[]}catch(l){return l?.status!==403&&h.logger.error(`Error searching messages in guild ${a}:`,l?.message||l),[]}}function V(a){try{const n=$?.getChannel(a);return n?.name||"unknown-channel"}catch{return"unknown-channel"}}function q(a){try{const n=k?.getGuild(a);return n?.name||"Unknown Server"}catch{return"Unknown Server"}}function x(a){try{const n=P?.getUser(a);if(n)return{username:n.username,discriminator:n.discriminator,globalName:n.globalName,avatar:n.avatar,id:n.id}}catch(n){h.logger.error("Error getting user info:",n)}return null}function J(){const[a,n]=e.React.useState(F),[s,l]=e.React.useState([]),[m,T]=e.React.useState(null),[u,X]=e.React.useState([]),[f,b]=e.React.useState(!1),[L,S]=e.React.useState(""),[Y,Z]=e.React.useState(null),_=async function(){if(!a||a.length<17){g.showToast("Please enter a valid User ID (17-19 digits)",c.getAssetIDByName("Small"));return}b(!0),l([]),S("Finding mutual servers..."),F=a;try{const t=x(a);T(t);const r=z(a);if(X(r),r.length===0){g.showToast("No mutual servers found with this user",c.getAssetIDByName("Small")),b(!1);return}const E=[];for(let d=0;d<r.length;d++){const v=r[d];S(`Searching ${v.name} (${d+1}/${r.length})...`);try{const I=await N(v.id,a);E.push(...I)}catch{}d<r.length-1&&await new Promise(function(I){return setTimeout(I,300)})}E.sort(function(d,v){return new Date(v.timestamp).getTime()-new Date(d.timestamp).getTime()}),l(E.slice(0,50)),S(""),g.showToast(`Found ${E.length} messages in ${r.length} servers`,c.getAssetIDByName("Check"))}catch(t){g.showToast("Error: "+(t?.message||"Unknown error"),c.getAssetIDByName("Small")),h.logger.error("Search error:",t)}finally{b(!1),S("")}},ee=async function(t){Z(t.id),b(!0),S(`Searching in ${t.name}...`);try{const r=await N(t.id,a);r.sort(function(E,d){return new Date(d.timestamp).getTime()-new Date(E.timestamp).getTime()}),l(r),g.showToast(`Found ${r.length} messages in ${t.name}`,c.getAssetIDByName("Check"))}catch(r){g.showToast("Error searching: "+(r?.message||"Unknown"),c.getAssetIDByName("Small"))}finally{b(!1),S("")}},te=function(t){try{const r=new Date(t);return r.toLocaleDateString()+" "+r.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}catch{return t}};return e.React.createElement(M,{style:{flex:1}},[e.React.createElement(y,{key:"search",title:"\u{1F50D} USER SEARCH"},[e.React.createElement(C,{key:"input",title:"User ID",placeholder:"Enter Discord User ID",value:a,onChangeText:n,keyboardType:"numeric"}),e.React.createElement(o,{key:"searchBtn",label:f?"\u23F3 Searching...":"\u{1F50D} Search All Servers",subLabel:f?L:"Search for messages across all mutual servers",onPress:f?void 0:_})]),m&&e.React.createElement(y,{key:"userInfo",title:"\u{1F464} USER INFO"},[e.React.createElement(o,{key:"name",label:"Username",subLabel:m.globalName||m.username||"Unknown"}),e.React.createElement(o,{key:"id",label:"User ID",subLabel:m.id})]),u.length>0&&e.React.createElement(y,{key:"servers",title:`\u{1F3E0} MUTUAL SERVERS (${u.length}) - Tap to search`},u.map(function(t,r){return e.React.createElement(o,{key:`server-${r}`,label:t.name,subLabel:Y===t.id?"\u2713 Selected":"Tap to search messages here",trailing:o.Arrow?e.React.createElement(o.Arrow,null):null,onPress:function(){return ee(t)}})})),f&&e.React.createElement(G,{key:"loading",style:{padding:20,alignItems:"center"}},[e.React.createElement(j,{key:"spinner",size:"large",color:"#7289da"}),e.React.createElement(R,{key:"progress",style:{color:"#b9bbbe",marginTop:10,textAlign:"center"}},L)]),!f&&s.length>0&&e.React.createElement(y,{key:"messages",title:`\u{1F4AC} MESSAGES (${s.length}) - Tap to jump`},s.map(function(t,r){return e.React.createElement(O,{key:`msg-${r}`,style:{padding:12,borderBottomWidth:1,borderBottomColor:"#2f3136",backgroundColor:"#36393f"},onPress:function(){H(t.guildId,t.channelId,t.id)?g.showToast("Jumping to message...",c.getAssetIDByName("Check")):g.showToast("Could not navigate to message",c.getAssetIDByName("Small"))}},[e.React.createElement(R,{key:"header",style:{color:"#7289da",fontSize:12,marginBottom:4}},`#${V(t.channelId)} \u2022 ${q(t.guildId)}`),e.React.createElement(R,{key:"content",style:{color:"#dcddde",fontSize:14,marginBottom:4}},t.content.substring(0,200)+(t.content.length>200?"...":"")),e.React.createElement(R,{key:"time",style:{color:"#72767d",fontSize:11}},te(t.timestamp)+(t.attachments>0?` \u2022 \u{1F4CE} ${t.attachments}`:""))])})),!f&&s.length===0&&u.length>0&&e.React.createElement(y,{key:"noResults",title:"\u2139\uFE0F RESULTS"},[e.React.createElement(o,{key:"noMsg",label:"Tap a server above to search",subLabel:"Or use 'Search All Servers' for a complete search"})]),e.React.createElement(y,{key:"help",title:"\u2753 HOW TO USE"},[e.React.createElement(o,{key:"h1",label:"1. Get User ID",subLabel:"Long-press user > Copy ID (Dev Mode required)"}),e.React.createElement(o,{key:"h2",label:"2. Enter ID & Search",subLabel:"Searches Discord's API for real messages"}),e.React.createElement(o,{key:"h3",label:"3. Tap Messages",subLabel:"Jump directly to any message"})])])}const W=J,K=function(){h.logger.log("Stalker Pro: Plugin loaded!"),g.showToast("Stalker Pro loaded!",c.getAssetIDByName("Check"))},Q=function(){h.logger.log("Stalker Pro: Plugin unloaded")};return p.onLoad=K,p.onUnload=Q,p.settings=W,p})({},vendetta,vendetta.metro,vendetta.metro.common,vendetta.ui.components,vendetta.ui.assets,vendetta.ui.toasts);
