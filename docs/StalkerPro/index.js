(function(R,n,g,t,B,s,u){"use strict";var U,P;const{FormSection:m,FormRow:S,FormInput:q}=B.Forms,{ScrollView:W,View:J,Text:A,TouchableOpacity:Z,ActivityIndicator:Q}=B.General,I=g.findByStoreName("UserStore"),E=g.findByStoreName("GuildStore"),F=g.findByStoreName("GuildMemberStore"),$=g.findByStoreName("ChannelStore"),f=((U=t.ReactNative)==null?void 0:U.Clipboard)||g.findByProps("setString","getString")||g.findByProps("getString"),C=g.findByProps("getAPIBaseURL","get")||g.findByProps("API_HOST","get"),b=g.findByProps("jumpToMessage");g.findByProps("openURL")||((P=t.ReactNative)==null||P.Linking);let G="",D=!1,L="",N=null;function v(e){if(!E||!F)return[];try{return Object.values(E.getGuilds()||{}).filter(function(l){return F.getMember(l.id,e)})}catch{return[]}}async function O(e,l){var i;if(!(C!=null&&C.get))return[];try{const c=await C.get({url:`/guilds/${e}/messages/search`,query:{author_id:l,include_nsfw:!0}});return(((i=c?.body)==null?void 0:i.messages)||[]).map(function(o){return{id:o[0].id,content:o[0].content||"[No text]",channelId:o[0].channel_id,guildId:e,timestamp:o[0].timestamp}})}catch{return[]}}function H(e){var l;return((l=$?.getChannel(e))==null?void 0:l.name)||"unknown"}function X(e){var l;return((l=E?.getGuild(e))==null?void 0:l.name)||"Unknown"}function j(e){const l=I?.getUser(e);return l?{username:l.username,globalName:l.globalName,id:l.id}:null}function V(e,l,i){var c,o;n.logger.log("=== NAVIGATING TO MESSAGE ==="),n.logger.log(`Guild: ${e}, Channel: ${l}, Message: ${i}`);try{const r=g.findByProps("selectChannel","selectVoiceChannel");if(r!=null&&r.selectChannel)return r.selectChannel({channelId:l,guildId:e}),n.logger.log("Method 1: selectChannel dispatched"),setTimeout(function(){try{b!=null&&b.jumpToMessage&&(b.jumpToMessage({channelId:l,messageId:i,flash:!0}),n.logger.log("Method 1b: jumpToMessage after selectChannel"))}catch(a){n.logger.log("jumpToMessage failed:",a)}},500),!0}catch(r){n.logger.log("Method 1 failed:",r)}try{if(t.FluxDispatcher)return t.FluxDispatcher.dispatch({type:"CHANNEL_SELECT",channelId:l,guildId:e}),n.logger.log("Method 2a: CHANNEL_SELECT dispatched"),setTimeout(function(){t.FluxDispatcher.dispatch({type:"LOAD_MESSAGES_AROUND",channelId:l,messageId:i,limit:25}),t.FluxDispatcher.dispatch({type:"MESSAGE_HIGHLIGHT",messageId:i,channelId:l}),n.logger.log("Method 2b: LOAD_MESSAGES_AROUND + MESSAGE_HIGHLIGHT dispatched")},300),!0}catch(r){n.logger.log("Method 2 failed:",r)}try{if(b!=null&&b.jumpToMessage)return b.jumpToMessage({channelId:l,messageId:i,flash:!0,jumpType:"INSTANT"}),n.logger.log("Method 3: jumpToMessage direct"),!0}catch(r){n.logger.log("Method 3 failed:",r)}try{const r=g.findByProps("transitionToGuild");if(r!=null&&r.transitionToGuild)return r.transitionToGuild(e,l,i),n.logger.log("Method 4: transitionToGuild"),!0}catch(r){n.logger.log("Method 4 failed:",r)}try{const r=`discord://discord.com/channels/${e}/${l}/${i}`;n.logger.log("Method 5: Trying deep link:",r);const a=((c=t.ReactNative)==null?void 0:c.Linking)||g.findByProps("openURL","canOpenURL");if(a!=null&&a.openURL)return a.openURL(r),n.logger.log("Method 5: openURL called"),!0}catch(r){n.logger.log("Method 5 failed:",r)}try{const r=`https://discord.com/channels/${e}/${l}/${i}`;n.logger.log("Method 6: Trying HTTPS link:",r);const a=((o=t.ReactNative)==null?void 0:o.Linking)||g.findByProps("openURL");if(a!=null&&a.openURL)return a.openURL(r),n.logger.log("Method 6: HTTPS openURL called"),!0}catch(r){n.logger.log("Method 6 failed:",r)}return n.logger.log("All navigation methods failed!"),!1}function Y(e){if(!e)return!1;const l=e.trim();return/^\d{17,19}$/.test(l)}async function _(e){var l;n.logger.log("Auto-searching user:",e);const i=(l=I?.getCurrentUser)==null?void 0:l.call(I);if(i&&e===i.id){n.logger.log("Skipping - this is current user");return}const c=v(e),o=j(e);if(c.length===0){u.showToast("\u274C No mutual servers with this user",s.getAssetIDByName("Small"));return}const r=o?.globalName||o?.username||`User ${e.slice(-4)}`;u.showToast(`\u{1F50D} Searching ${r}...`,s.getAssetIDByName("ic_search"));let a=[];for(let d=0;d<Math.min(c.length,8);d++){try{const p=await O(c[d].id,e);a.push(...p)}catch{}d<c.length-1&&await new Promise(function(p){return setTimeout(p,250)})}if(a.sort(function(d,p){return new Date(p.timestamp).getTime()-new Date(d.timestamp).getTime()}),a.length===0){u.showToast("\u{1F4ED} No messages found",s.getAssetIDByName("Small"));return}u.showToast(`\u2705 Found ${a.length} messages!`,s.getAssetIDByName("Check")),setTimeout(function(){if(a.length>0){const d=a[0];u.showToast(`\u{1F4CD} Latest in #${H(d.channelId)}`,s.getAssetIDByName("ic_message"))}},1500),setTimeout(function(){if(a.length>0){const d=a[0];u.showToast("\u{1F446} Opening message...",s.getAssetIDByName("Arrow")),V(d.guildId,d.channelId,d.id)}},3e3)}async function x(){try{if(!(f!=null&&f.getString)){n.logger.log("Clipboard.getString not available");return}const e=await f.getString();if(e&&e!==L&&Y(e)){L=e;const l=e.trim();n.logger.log("Detected User ID in clipboard:",l),u.showToast("\u{1F3AF} User ID detected!",s.getAssetIDByName("Check")),setTimeout(function(){return _(l)},1e3)}}catch(e){n.logger.error("Clipboard check failed:",e)}}function ee(){const[e,l]=t.React.useState(G),[i,c]=t.React.useState([]),[o,r]=t.React.useState(null),[a,d]=t.React.useState([]),[p,w]=t.React.useState(!1),[z,K]=t.React.useState(""),re=async function(){if(!e||e.length<17){u.showToast("Invalid User ID",s.getAssetIDByName("Small"));return}w(!0),c([]),G=e;const h=j(e);r(h);const y=v(e);if(d(y),y.length===0){u.showToast("No mutual servers",s.getAssetIDByName("Small")),w(!1);return}const k=[];for(let T=0;T<Math.min(y.length,12);T++){K(`${y[T].name} (${T+1}/${Math.min(y.length,12)})`);const M=await O(y[T].id,e);k.push(...M),await new Promise(function(oe){return setTimeout(oe,350)})}k.sort(function(T,M){return new Date(M.timestamp).getTime()-new Date(T.timestamp).getTime()}),c(k.slice(0,50)),u.showToast(`Found ${k.length} messages`,s.getAssetIDByName("Check")),w(!1),K("")},ae=function(h){try{const y=new Date(h);return`${y.toLocaleDateString()} ${y.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}`}catch{return h}},ie=async function(){u.showToast("Checking clipboard...",s.getAssetIDByName("ic_search")),await x()};return t.React.createElement(W,{style:{flex:1,backgroundColor:"#1e1f22"}},[t.React.createElement(m,{key:"ver",title:"\u{1F4F1} STALKER PRO v2.0"},[t.React.createElement(S,{key:"v1",label:"\u2728 Copy ID Detection",subLabel:"Copy any User ID to auto-search!"}),t.React.createElement(S,{key:"v2",label:"\u{1F4CB} Check Clipboard Now",subLabel:"Tap to manually check clipboard",trailing:S.Arrow?t.React.createElement(S.Arrow,null):null,onPress:ie})]),t.React.createElement(m,{key:"search",title:"\u{1F50D} MANUAL SEARCH"},[t.React.createElement(q,{key:"in",title:"User ID",placeholder:"Paste Discord User ID here",value:e,onChangeText:l,keyboardType:"numeric"}),t.React.createElement(S,{key:"btn",label:p?"\u23F3 Searching...":"\u{1F50D} Search",subLabel:p?z:"Find their messages",onPress:p?void 0:re})]),o&&t.React.createElement(m,{key:"user",title:"\u{1F464} USER"},[t.React.createElement(S,{key:"n",label:o.globalName||o.username,subLabel:`@${o.username}`})]),a.length>0&&t.React.createElement(m,{key:"srv",title:`\u{1F3E0} ${a.length} MUTUAL SERVERS`},a.slice(0,10).map(function(h,y){return t.React.createElement(S,{key:`s${y}`,label:h.name})})),p&&t.React.createElement(J,{key:"load",style:{padding:20,alignItems:"center"}},[t.React.createElement(Q,{key:"sp",size:"large",color:"#5865f2"}),t.React.createElement(A,{key:"t",style:{color:"#b5bac1",marginTop:10}},z)]),!p&&i.length>0&&t.React.createElement(m,{key:"msgs",title:`\u{1F4AC} ${i.length} MESSAGES`},i.map(function(h,y){return t.React.createElement(Z,{key:`m${y}`,style:{padding:12,borderBottomWidth:1,borderBottomColor:"#3f4147",backgroundColor:"#2b2d31"},onPress:function(){u.showToast("Opening...",s.getAssetIDByName("Check")),V(h.guildId,h.channelId,h.id)}},[t.React.createElement(A,{key:"c",style:{color:"#5865f2",fontSize:12}},`#${H(h.channelId)} \u2022 ${X(h.guildId)}`),t.React.createElement(A,{key:"m",style:{color:"#f2f3f5",fontSize:14,marginVertical:3}},h.content.substring(0,100)),t.React.createElement(A,{key:"t",style:{color:"#949ba4",fontSize:11}},ae(h.timestamp))])})),t.React.createElement(m,{key:"status",title:"\u2699\uFE0F STATUS"},[t.React.createElement(S,{key:"s1",label:"Clipboard API",subLabel:f!=null&&f.getString?"\u2705 Available":"\u274C Not Available"}),t.React.createElement(S,{key:"s2",label:"Auto Monitor",subLabel:D?"\u2705 Running":"\u274C Stopped"}),t.React.createElement(S,{key:"s3",label:"Last Clipboard",subLabel:L||"Nothing checked yet"})])])}const te=ee,le=function(){n.logger.log("========================================"),n.logger.log("=== STALKER PRO v2.0 LOADING ==="),n.logger.log("========================================"),n.logger.log("Clipboard API:",!!f),n.logger.log("Clipboard.getString:",!!(f!=null&&f.getString)),n.logger.log("Clipboard.setString:",!!(f!=null&&f.setString)),f!=null&&f.getString?(D=!0,N=setInterval(x,2e3),n.logger.log("Clipboard monitoring STARTED (every 2s)"),u.showToast("\u{1F50D} Stalker Pro v2.0 ready!",s.getAssetIDByName("Check"))):(D=!1,n.logger.warn("Clipboard API not available - manual mode only"),u.showToast("Stalker Pro ready (manual mode)",s.getAssetIDByName("Small")))},ne=function(){n.logger.log("=== STALKER PRO UNLOADING ==="),N&&(clearInterval(N),N=null,D=!1,n.logger.log("Clipboard monitoring STOPPED"))};return R.onLoad=le,R.onUnload=ne,R.settings=te,R})({},vendetta,vendetta.metro,vendetta.metro.common,vendetta.ui.components,vendetta.ui.assets,vendetta.ui.toasts);
