(function(M,F,R,e,q,m,k,ge){"use strict";var fe=Object.defineProperty,ye=Object.defineProperties,he=Object.getOwnPropertyDescriptors,K=Object.getOwnPropertySymbols,pe=Object.prototype.hasOwnProperty,be=Object.prototype.propertyIsEnumerable,Q=(t,n,l)=>n in t?fe(t,n,{enumerable:!0,configurable:!0,writable:!0,value:l}):t[n]=l,Re=(t,n)=>{for(var l in n||(n={}))pe.call(n,l)&&Q(t,l,n[l]);if(K)for(var l of K(n))be.call(n,l)&&Q(t,l,n[l]);return t},me=(t,n)=>ye(t,he(n)),Y,J,Z,X;const{FormSection:ee,FormRow:te,FormInput:ke}=q.Forms,{ScrollView:Ee,View:d,Text:a,TouchableOpacity:A}=q.General,D=R.findByStoreName("UserStore"),v=R.findByStoreName("GuildStore"),B=R.findByStoreName("GuildMemberStore"),f=R.findByStoreName("ChannelStore"),G=R.findByStoreName("SelectedGuildStore"),T=R.findByProps("getChannelPermissions","can"),{getChannel:ne}=R.findByProps("getChannel")||{},W=((Y=R.findByProps("ChannelTypes"))==null?void 0:Y.ChannelTypes)||{},E=((J=e.ReactNative)==null?void 0:J.Clipboard)||R.findByProps("setString","getString"),j=R.findByProps("getAPIBaseURL","get")||R.findByProps("API_HOST","get"),re=((X=(Z=e.constants)==null?void 0:Z.Permissions)==null?void 0:X.VIEW_CHANNEL)||1024,Se={1:"Create Invite",2:"Kick Members",4:"Ban Members",8:"Administrator",16:"Manage Channels",32:"Manage Server",64:"Add Reactions",128:"View Audit Log",256:"Priority Speaker",512:"Stream",1024:"View Channel",2048:"Send Messages",4096:"Send TTS",8192:"Manage Messages",16384:"Embed Links",32768:"Attach Files",65536:"Read History",131072:"Mention Everyone",262144:"Use External Emoji",524288:"View Insights",1048576:"Connect",2097152:"Speak",4194304:"Mute Members",8388608:"Deafen Members",16777216:"Move Members",33554432:"Use VAD",67108864:"Change Nickname",134217728:"Manage Nicknames",268435456:"Manage Roles",536870912:"Manage Webhooks",1073741824:"Manage Emojis"};let le=!1,ae="",P=null,H=[];const ie=[W.DM,W.GROUP_DM,W.GUILD_CATEGORY];function ve(t,n){if(!(!e.FluxDispatcher||n.length===0))try{e.FluxDispatcher.dispatch({type:"GUILD_MEMBERS_REQUEST",guildIds:[t],userIds:n}),F.logger.log(`Requested ${n.length} guild members`)}catch(l){F.logger.error("Failed to request guild members:",l)}}function Ce(t){var n,l;if(!t||(typeof t=="string"&&(t=ne?.(t)||((n=f?.getChannel)==null?void 0:n.call(f,t))),!t||ie.includes(t.type)))return!1;t.realCheck=!0;const c=!((l=T?.can)!=null&&l.call(T,re,t));return delete t.realCheck,c}function oe(t){const n=Number(t),l=[];for(const[c,o]of Object.entries(Se))n&Number(c)&&l.push(o);return l}function se(t,n){var l,c,o,s;const h=[],I=[];try{const i=t.permissionOverwrites||{},p=(l=v?.getGuild)==null?void 0:l.call(v,n);F.logger.log(`Parsing ${Object.keys(i).length} overwrites for channel ${t.name}`);for(const[u,y]of Object.entries(i)){if(!y)continue;const C=Number(y.allow||0),V=Number(y.deny||0),x=y.type===0||y.type==="role",O=x?"role":"user";let w="",N=0,z=!1;if(x)if(u===n)w="@everyone";else{const S=(c=p?.roles)==null?void 0:c[u];S?(w=S.name,N=S.color||0):(w=`Role (${u.slice(-6)})`,z=!0)}else{I.push(u);const S=(o=D?.getUser)==null?void 0:o.call(D,u),U=(s=B?.getMember)==null?void 0:s.call(B,n,u);S?w=U?.nick||S.globalName||S.username:(w=`User (${u.slice(-6)})`,z=!0)}h.push({id:u,name:w,type:O,color:N,allowed:oe(C),denied:oe(V),isUnknown:z})}h.sort(function(u,y){return u.name==="@everyone"?-1:y.name==="@everyone"?1:u.type!==y.type?u.type==="role"?-1:1:u.name.localeCompare(y.name)})}catch(i){F.logger.error("getChannelPermissions error:",i)}return{overwrites:h,userIds:I}}function ce(t){switch(t){case 0:return"\u{1F4AC}";case 2:return"\u{1F50A}";case 4:return"\u{1F4C1}";case 5:return"\u{1F4E2}";case 13:return"\u{1F3AD}";case 15:return"\u{1F4CB}";default:return"\u{1F4DD}"}}function ue(t){var n,l;try{const c=((n=f?.getMutableGuildChannelsForGuild)==null?void 0:n.call(f,t))||Object.values(((l=f?.getMutableGuildChannels)==null?void 0:l.call(f))||{}).filter(function(o){return o?.guild_id===t});return Array.isArray(c)?c:Object.values(c||{})}catch{return[]}}function we(t){var n,l;const c=[];try{const o=ue(t);for(const s of o)!(s!=null&&s.id)||s.type===4||ie.includes(s.type)||Ce(s)&&c.push({id:s.id,name:s.name||"unknown",type:s.type||0,parentName:s.parent_id&&((l=(n=f?.getChannel)==null?void 0:n.call(f,s.parent_id))==null?void 0:l.name)||"",permissions:se(s,t),guildId:t})}catch(o){F.logger.error("getHiddenChannels error:",o)}return c.sort(function(o,s){return o.name.localeCompare(s.name)})}function Fe(t){if(!v||!B)return[];try{return Object.values(v.getGuilds()||{}).filter(function(n){return B.getMember(n.id,t)})}catch{return[]}}async function Ie(t,n){var l;if(!(j!=null&&j.get))return[];try{const c=await j.get({url:`/guilds/${t}/messages/search`,query:{author_id:n,include_nsfw:!0,sort_by:"timestamp",sort_order:"desc"}});return(((l=c?.body)==null?void 0:l.messages)||[]).map(function(o){return{id:o[0].id,channelId:o[0].channel_id,guildId:t,timestamp:o[0].timestamp}})}catch{return[]}}async function de(t){var n,l;const c=(n=D?.getCurrentUser)==null?void 0:n.call(D);if(c&&t===c.id)return;const o=Fe(t);if(o.length===0){k.showToast("\u274C No mutual servers",m.getAssetIDByName("Small"));return}k.showToast("\u{1F50D} Searching...",m.getAssetIDByName("ic_search"));let s=[];for(let p=0;p<Math.min(o.length,8);p++){try{s.push(...await Ie(o[p].id,t))}catch{}p<o.length-1&&await new Promise(function(u){return setTimeout(u,250)})}if(s.sort(function(p,u){return new Date(u.timestamp).getTime()-new Date(p.timestamp).getTime()}),s.length===0){k.showToast("\u{1F4ED} No messages",m.getAssetIDByName("Small"));return}k.showToast(`\u2705 Found ${s.length}!`,m.getAssetIDByName("Check"));const h=s[0],I=`https://discord.com/channels/${h.guildId}/${h.channelId}/${h.id}`,i=((l=f?.getChannel(h.channelId))==null?void 0:l.name)||"unknown";setTimeout(function(){const p=Date.now()-new Date(h.timestamp).getTime(),u=Math.floor(p/6e4),y=Math.floor(u/60),C=Math.floor(y/24);k.showToast(`\u{1F4CD} #${i} (${u<60?u+"m":y<24?y+"h":C+"d"})`,m.getAssetIDByName("ic_message"))},1500),setTimeout(function(){E!=null&&E.setString&&(E.setString(I),k.showToast("\u{1F4CB} Copied!",m.getAssetIDByName("Check")))},3e3)}async function De(){try{if(!(E!=null&&E.getString))return;const t=await E.getString();t&&t!==ae&&/^\d{17,19}$/.test(t.trim())&&(ae=t,k.showToast("\u{1F3AF} ID detected!",m.getAssetIDByName("Check")),setTimeout(function(){return de(t.trim())},1e3))}catch{}}function Te(){const[t,n]=e.React.useState("hidden"),[l,c]=e.React.useState([]),[o,s]=e.React.useState(!1),[h,I]=e.React.useState(null),[i,p]=e.React.useState(null),[u,y]=e.React.useState(""),[C,V]=e.React.useState(""),[x,O]=e.React.useState(!1),[,w]=e.React.useState(0);e.React.useEffect(function(){N()},[]),e.React.useEffect(function(){if(i&&i.permissions.userIds.length>0){ve(i.guildId,i.permissions.userIds);const r=setTimeout(function(){return w(function(b){return b+1})},1e3);return function(){return clearTimeout(r)}}},[i?.id]);const N=function(){var r,b;s(!0);try{const g=(r=G?.getGuildId)==null?void 0:r.call(G);if(g){const $=(b=v?.getGuild)==null?void 0:b.call(v,g);I($);const L=we(g);c(L);const ze=ue(g);y(`${ze.length} ch \u2192 ${L.length} hidden`),k.showToast(L.length>0?`\u{1F512} ${L.length} hidden!`:"\u2728 No hidden",m.getAssetIDByName("Check"))}else I(null),c([]),y("Open server first")}catch(g){y(`Error: ${g}`)}finally{s(!1)}},z=function(){var r;if(i&&h){const b=(r=f?.getChannel)==null?void 0:r.call(f,i.id);if(b){const g=me(Re({},i),{permissions:se(b,h.id)});p(g),k.showToast("\u{1F504} Refreshed!",m.getAssetIDByName("Check"))}}},S=async function(){!C||C.length<17||(O(!0),await de(C),O(!1))},U=function(r){return r?`#${r.toString(16).padStart(6,"0")}`:"#99AAB5"},_=function({id:r,label:b,icon:g}){return e.React.createElement(A,{style:{flex:1,padding:10,backgroundColor:t===r?"#5865F2":"#2b2d31",borderRadius:8,marginHorizontal:2},onPress:function(){n(r),r!=="perms"&&p(null)}},e.React.createElement(a,{style:{color:"#fff",textAlign:"center",fontSize:12,fontWeight:t===r?"bold":"normal"}},`${g} ${b}`))};return e.React.createElement(Ee,{style:{flex:1,backgroundColor:"#1e1f22"}},[e.React.createElement(d,{key:"h",style:{padding:16,backgroundColor:"#2b2d31",marginBottom:8}},[e.React.createElement(a,{key:"t",style:{color:"#fff",fontSize:20,fontWeight:"bold",textAlign:"center"}},"\u{1F50D} Stalker Pro v4.2"),e.React.createElement(a,{key:"s",style:{color:"#b5bac1",fontSize:12,textAlign:"center",marginTop:4}},h?`\u{1F4CD} ${h.name}`:"Open a server")]),e.React.createElement(d,{key:"tabs",style:{flexDirection:"row",padding:8,marginBottom:8}},[e.React.createElement(_,{key:"1",id:"hidden",label:"Hidden",icon:"\u{1F512}"}),e.React.createElement(_,{key:"2",id:"perms",label:"Perms",icon:"\u{1F510}"}),e.React.createElement(_,{key:"3",id:"search",label:"Msgs",icon:"\u{1F4AC}"})]),t==="hidden"&&[e.React.createElement(A,{key:"scan",style:{margin:12,padding:14,backgroundColor:"#5865F2",borderRadius:12,alignItems:"center"},onPress:N},e.React.createElement(a,{style:{color:"#fff",fontWeight:"bold",fontSize:16}},o?"\u23F3...":"\u{1F504} Scan Server")),e.React.createElement(a,{key:"dbg",style:{color:"#949ba4",textAlign:"center",fontSize:11,marginBottom:8}},u),...l.map(function(r,b){return e.React.createElement(A,{key:`c${b}`,style:{margin:8,marginTop:4,padding:14,backgroundColor:"#2b2d31",borderRadius:12,borderLeftWidth:4,borderLeftColor:"#5865F2"},onPress:function(){p(r),n("perms")}},[e.React.createElement(d,{key:"h",style:{flexDirection:"row",alignItems:"center"}},[e.React.createElement(a,{key:"i",style:{fontSize:18,marginRight:10}},ce(r.type)),e.React.createElement(d,{key:"n",style:{flex:1}},[e.React.createElement(a,{key:"nm",style:{color:"#fff",fontSize:16,fontWeight:"bold"}},r.name),r.parentName&&e.React.createElement(a,{key:"p",style:{color:"#949ba4",fontSize:12}},`in ${r.parentName}`)]),e.React.createElement(a,{key:"a",style:{color:"#5865F2",fontSize:12}},"View \u2192")]),e.React.createElement(a,{key:"r",style:{color:"#00b894",fontSize:12,marginTop:6}},`\u{1F3F7}\uFE0F ${r.permissions.overwrites.filter(function(g){return g.type==="role"}).length} roles \u2022 \u{1F464} ${r.permissions.overwrites.filter(function(g){return g.type==="user"}).length} users`)])}),l.length===0&&!o&&e.React.createElement(d,{key:"empty",style:{padding:30,alignItems:"center"}},[e.React.createElement(a,{key:"e1",style:{fontSize:40}},"\u{1F513}"),e.React.createElement(a,{key:"e2",style:{color:"#fff",fontSize:16,marginTop:10}},h?"No hidden channels":"Open a server")])],t==="perms"&&[!i&&e.React.createElement(d,{key:"no-sel",style:{padding:30,alignItems:"center"}},[e.React.createElement(a,{key:"t1",style:{fontSize:40}},"\u{1F510}"),e.React.createElement(a,{key:"t2",style:{color:"#fff",fontSize:16,marginTop:10}},"Select a channel"),e.React.createElement(a,{key:"t3",style:{color:"#b5bac1",fontSize:12,marginTop:4,textAlign:"center"}},"Go to Hidden tab and tap a channel")]),i&&[e.React.createElement(d,{key:"ch-header",style:{padding:16,backgroundColor:"#2b2d31",margin:8,borderRadius:12}},[e.React.createElement(d,{key:"row",style:{flexDirection:"row",alignItems:"center"}},[e.React.createElement(a,{key:"icon",style:{fontSize:24,marginRight:12}},ce(i.type)),e.React.createElement(d,{key:"info",style:{flex:1}},[e.React.createElement(a,{key:"name",style:{color:"#fff",fontSize:18,fontWeight:"bold"}},i.name),i.parentName&&e.React.createElement(a,{key:"cat",style:{color:"#b5bac1",fontSize:12}},`in ${i.parentName}`)])])]),e.React.createElement(d,{key:"btns",style:{flexDirection:"row",margin:8,marginTop:0}},[e.React.createElement(A,{key:"refresh",style:{flex:1,padding:10,backgroundColor:"#3f4147",borderRadius:8,marginRight:4,alignItems:"center"},onPress:z},e.React.createElement(a,{style:{color:"#fff",fontSize:12}},"\u{1F504} Refresh")),e.React.createElement(A,{key:"copy",style:{flex:1,padding:10,backgroundColor:"#3f4147",borderRadius:8,marginLeft:4,alignItems:"center"},onPress:function(){E!=null&&E.setString&&(E.setString(i.id),k.showToast("\u{1F4CB} ID copied",m.getAssetIDByName("Check")))}},e.React.createElement(a,{style:{color:"#b5bac1",fontSize:10}},`\u{1F4CB} ${i.id}`))]),e.React.createElement(a,{key:"stats",style:{color:"#5865F2",fontSize:12,textAlign:"center",marginVertical:8}},`\u{1F3F7}\uFE0F ${i.permissions.overwrites.filter(function(r){return r.type==="role"}).length} Roles \u2022 \u{1F464} ${i.permissions.overwrites.filter(function(r){return r.type==="user"}).length} Individual Users`),e.React.createElement(a,{key:"perms-title",style:{color:"#fff",fontSize:14,fontWeight:"bold",marginLeft:12,marginTop:8}},"\u{1F510} Permission Overwrites"),...i.permissions.overwrites.map(function(r,b){return e.React.createElement(d,{key:`ow-${b}`,style:{margin:8,marginTop:6,padding:12,backgroundColor:"#2b2d31",borderRadius:12,borderLeftWidth:3,borderLeftColor:r.type==="role"?r.color||"#5865F2":"#43b581"}},[e.React.createElement(d,{key:"hdr",style:{flexDirection:"row",alignItems:"center",marginBottom:6}},[e.React.createElement(a,{key:"type",style:{fontSize:14,marginRight:8}},r.type==="role"?"\u{1F3F7}\uFE0F":"\u{1F464}"),e.React.createElement(d,{key:"name-wrap",style:{flex:1}},[e.React.createElement(a,{key:"name",style:{color:r.type==="role"?U(r.color):"#43b581",fontSize:14,fontWeight:"bold"}},r.name),r.isUnknown&&e.React.createElement(a,{key:"id",style:{color:"#949ba4",fontSize:10}},`ID: ${r.id}`)]),e.React.createElement(d,{key:"badge",style:{backgroundColor:r.type==="role"?"#5865F2":"#43b581",paddingHorizontal:8,paddingVertical:3,borderRadius:4}},e.React.createElement(a,{style:{color:"#fff",fontSize:9,fontWeight:"bold"}},r.type==="role"?"ROLE":"USER"))]),r.allowed.length>0&&e.React.createElement(d,{key:"allowed",style:{marginTop:4}},[e.React.createElement(a,{key:"title",style:{color:"#43b581",fontSize:11,fontWeight:"bold",marginBottom:4}},`\u2705 ALLOWED (${r.allowed.length}):`),e.React.createElement(d,{key:"perms",style:{flexDirection:"row",flexWrap:"wrap"}},r.allowed.map(function(g,$){return e.React.createElement(a,{key:`a${$}`,style:{color:"#43b581",fontSize:10,backgroundColor:"rgba(67,181,129,0.15)",paddingHorizontal:6,paddingVertical:3,borderRadius:4,marginRight:4,marginBottom:4}},g)}))]),r.denied.length>0&&e.React.createElement(d,{key:"denied",style:{marginTop:6}},[e.React.createElement(a,{key:"title",style:{color:"#ed4245",fontSize:11,fontWeight:"bold",marginBottom:4}},`\u274C DENIED (${r.denied.length}):`),e.React.createElement(d,{key:"perms",style:{flexDirection:"row",flexWrap:"wrap"}},r.denied.map(function(g,$){return e.React.createElement(a,{key:`d${$}`,style:{color:"#ed4245",fontSize:10,backgroundColor:"rgba(237,66,69,0.15)",paddingHorizontal:6,paddingVertical:3,borderRadius:4,marginRight:4,marginBottom:4}},g)}))]),r.allowed.length===0&&r.denied.length===0&&e.React.createElement(a,{key:"none",style:{color:"#949ba4",fontSize:11,fontStyle:"italic"}},"No specific permissions")])}),i.permissions.overwrites.length===0&&e.React.createElement(d,{key:"no-perms",style:{padding:20,alignItems:"center"}},e.React.createElement(a,{style:{color:"#949ba4",fontSize:12}},"No permission overwrites"))]],t==="search"&&[e.React.createElement(ee,{key:"auto",title:"\u{1F4AC} MESSAGES"},[e.React.createElement(te,{key:"a1",label:"\u{1F4CB} Auto-detect",subLabel:le?"\u2705 Copy User ID to search":"\u274C"})]),e.React.createElement(ee,{key:"man",title:"\u{1F50D} SEARCH"},[e.React.createElement(ke,{key:"in",title:"User ID",value:C,onChangeText:V,keyboardType:"numeric"}),e.React.createElement(te,{key:"btn",label:x?"\u23F3...":"\u{1F50D} Find",onPress:S})])]])}const Ae=Te,Be=function(){F.logger.log("=== STALKER PRO v4.2 ==="),T!=null&&T.can&&(H.push(ge.after("can",T,function([t,n],l){return n!=null&&n.realCheck?l:t===re?!0:l})),F.logger.log("\u2705 Patched Permissions.can")),E!=null&&E.getString&&(le=!0,P=setInterval(De,2e3)),k.showToast("\u{1F50D} Stalker Pro v4.2",m.getAssetIDByName("Check"))},Ne=function(){P&&(clearInterval(P),P=null);for(const t of H)try{t()}catch{}H=[]};return M.onLoad=Be,M.onUnload=Ne,M.settings=Ae,M})({},vendetta,vendetta.metro,vendetta.metro.common,vendetta.ui.components,vendetta.ui.assets,vendetta.ui.toasts,vendetta.patcher);
