(function(p,o,d,A,h,C,s,a){"use strict";const{FormSection:I,FormRow:y,FormDivider:D}=C.Forms,k=d.findByStoreName("UserStore"),B=d.findByStoreName("GuildStore"),m=d.findByStoreName("ChannelStore"),b=d.findByStoreName("MessageStore"),w=d.findByStoreName("GuildMemberStore");let U=[];function M(){const l=[["UserProfileSection"],["default","UserProfileSection"],["UserProfileBody"],["UserProfileHeader"],["ProfileBanner"],["UserProfile"],["default","UserProfile"],["UserProfileBanner"],["ProfileSection"],["UserSheet"],["UserProfileSheet"],["default","UserProfileSheet"],["UserProfileOverview"],["UserProfileConnections"],["default","ProfileBanner"]];for(const e of l)try{const r=d.findByProps(...e);if(r)return o.logger.log(`Found module with props: ${e.join(", ")}`),{module:r,props:e}}catch{}const n=["UserProfileSection","UserProfileBody","UserProfileHeader","UserProfile","ProfileBanner","UserSheet"];for(const e of n)try{const r=d.findByName(e,!1);if(r)return o.logger.log(`Found module by name: ${e}`),{module:r,name:e}}catch{}return null}function F(l){const n=B?Object.values(B.getGuilds()||{}):[],e=[];for(const r of n)w?.getMember(r.id,l)&&e.push(r);return e}function R(l,n){var e,r;const u=[];for(const t of n)try{const i=(m?Object.values(((e=m.getChannels)==null?void 0:e.call(m))||((r=m.getMutableGuildChannels)==null?void 0:r.call(m))||{}):[]).filter(function(f){return f.guild_id===t.id&&f.type===0});for(const f of i){const P=b?.getMessages(f.id);if(P!=null&&P._array){const S=P._array.filter(function(c){var g;return((g=c.author)==null?void 0:g.id)===l});for(let c=0;c<Math.min(S.length,3);c++)u.push({id:S[c].id,content:(S[c].content||"").substring(0,50),channel:f.name,guild:t.name})}}}catch{}return u.slice(0,10)}const T=function(){try{a.showToast("Stalker Pro: Initializing...",s.getAssetIDByName("Check"));const l=M();if(!l){a.showToast("Stalker Pro: No profile module found!",s.getAssetIDByName("Small")),o.logger.error("Could not find any UserProfile module after trying all known patterns");return}const{module:n}=l,e=Object.keys(n);o.logger.log("UserProfile keys:",e.slice(0,15).join(", "));const r=["default","UserProfileSection","UserProfileBody","UserProfileHeader","ProfileBanner","UserProfile","UserSheet","render"];let u=null;for(const t of r)if(n[t]&&typeof n[t]=="function"){u=t;break}if(!u)if(typeof n=="function")a.showToast("Stalker Pro: Module is a function, trying direct patch",s.getAssetIDByName("Check")),o.logger.log("Module is a function, will try alternative approach");else{a.showToast("Stalker Pro: No patch target found!",s.getAssetIDByName("Small")),o.logger.error("UserProfile found but no patchable target. Keys:",e.join(", "));return}o.logger.log("Attempting to patch:",u||"direct"),a.showToast(`Stalker Pro: Patching ${u||"module"}...`,s.getAssetIDByName("Check")),U.push(A.after(u,n,function(t,i){var f,P,S,c;o.logger.log("Profile patch triggered! Args:",t?.length);const g=((f=t[0])==null?void 0:f.userId)||((S=(P=t[0])==null?void 0:P.user)==null?void 0:S.id);if(!g)return o.logger.log("No userId found in args"),i;const N=k?.getCurrentUser();if(N&&g===N.id)return i;if((c=i?.props)!=null&&c.children&&Array.isArray(i.props.children)){const v=F(g),E=h.React.createElement(I,{key:"stalker-pro",title:"\u{1F50D} Stalker Pro"},[h.React.createElement(y,{key:"recent",label:"Recent Messages",subLabel:"Find their messages across servers",trailing:y.Arrow?h.React.createElement(y.Arrow,null):null,onPress:function(){const $=R(g,v);a.showToast(`Found ${$.length} messages`,s.getAssetIDByName("Check"))}}),h.React.createElement(D,{key:"div"}),h.React.createElement(y,{key:"hidden",label:"Hidden Channels",subLabel:"Channels they can see but you can't",trailing:y.Arrow?h.React.createElement(y.Arrow,null):null,onPress:function(){a.showToast(`Checking ${v.length} servers`,s.getAssetIDByName("Check"))}})]);i.props.children.push(E),o.logger.log("Stalker section injected!")}else o.logger.log("Cannot inject - res.props.children not an array");return i})),a.showToast("Stalker Pro loaded!",s.getAssetIDByName("Check")),o.logger.log("Stalker Pro plugin loaded successfully")}catch(l){a.showToast("Stalker Pro: Error loading!",s.getAssetIDByName("Small")),o.logger.error("Stalker Pro load error:",l)}},j=function(){for(const l of U)l?.();U=[],o.logger.log("Stalker Pro plugin unloaded")};return p.onLoad=T,p.onUnload=j,p})({},vendetta,vendetta.metro,vendetta.patcher,vendetta.metro.common,vendetta.ui.components,vendetta.ui.assets,vendetta.ui.toasts);
