(function(D,g,u,t,_,d,h,X){"use strict";var x,z;const{FormSection:N,FormRow:o,FormInput:Z,FormDivider:K}=_.Forms,{ScrollView:ee,View:te,Text:v,TouchableOpacity:ne,ActivityIndicator:re,Linking:ae}=_.General,$=ae||((x=t.ReactNative)==null?void 0:x.Linking),k=u.findByStoreName("UserStore"),w=u.findByStoreName("GuildStore"),Y=u.findByStoreName("GuildMemberStore"),q=u.findByStoreName("ChannelStore"),m=u.findByStoreName("RelationshipStore"),H=((z=u.findByProps("UserProfileSection"))==null?void 0:z.UserProfileSection)||u.findByProps("default","UserProfileSection")||u.findByProps("UserProfileSection"),G=u.findByProps("getAPIBaseURL","get")||u.findByProps("API_HOST","get"),P=u.findByProps("transitionToGuild","transitionTo")||u.findByProps("transitionTo")||u.findByProps("replaceWith","back")||u.findByProps("openURL"),L=u.findByProps("jumpToMessage")||u.findByProps("fetchMessages","jumpToMessage");let O=[],W="";const f={NONE:0,FRIEND:1,BLOCKED:2,PENDING_INCOMING:3,PENDING_OUTGOING:4,IMPLICIT:5};function J(e){var n,l,r,a,E;try{if(!m)return null;const s=(E=(a=(n=m.getRelationshipType)==null?void 0:n.call(m,e))!=null?a:(r=(l=m.getRelationship)==null?void 0:l.call(m,e))==null?void 0:r.type)!=null?E:f.NONE;return{type:s,isFriend:s===f.FRIEND,isBlocked:s===f.BLOCKED,hasPendingIncoming:s===f.PENDING_INCOMING,hasPendingOutgoing:s===f.PENDING_OUTGOING,label:le(s),emoji:ie(s)}}catch(s){return g.logger.error("Error getting relationship:",s),null}}function le(e){switch(e){case f.FRIEND:return"Friend";case f.BLOCKED:return"Blocked";case f.PENDING_INCOMING:return"Pending (Incoming)";case f.PENDING_OUTGOING:return"Pending (Outgoing)";default:return"Not Friends"}}function ie(e){switch(e){case f.FRIEND:return"\u2705";case f.BLOCKED:return"\u{1F6AB}";case f.PENDING_INCOMING:return"\u{1F4E8}";case f.PENDING_OUTGOING:return"\u{1F4E4}";default:return"\u274C"}}function C(e){try{const n=w?Object.values(w.getGuilds()||{}):[],l=[];for(const r of n)Y?.getMember(r.id,e)&&l.push(r);return l}catch(n){return g.logger.error("Error getting mutual guilds:",n),[]}}function se(e,n,l){const r=`discord://-/channels/${e}/${n}/${l}`;try{if(t.FluxDispatcher)return t.FluxDispatcher.dispatch({type:"NAVIGATE_TO_JUMP_TO_MESSAGE",messageId:l,channelId:n,guildId:e}),!0}catch{}try{if(L!=null&&L.jumpToMessage)return L.jumpToMessage({channelId:n,messageId:l,flash:!0}),!0}catch{}try{if(P!=null&&P.transitionToGuild)return P.transitionToGuild(e,n,l),!0;if(P!=null&&P.transitionTo)return P.transitionTo(`/channels/${e}/${n}/${l}`),!0}catch{}try{if($!=null&&$.openURL)return $.openURL(r),!0}catch{}return!1}async function M(e,n){var l;try{if(!(G!=null&&G.get))return[];const r=await G.get({url:`/guilds/${e}/messages/search`,query:{author_id:n,include_nsfw:!0}});return(l=r?.body)!=null&&l.messages?r.body.messages.map(function(a){var E;const s=a[0];return{id:s.id,content:s.content||"[No text content]",channelId:s.channel_id,guildId:e,timestamp:s.timestamp,attachments:((E=s.attachments)==null?void 0:E.length)||0}}):[]}catch(r){return r?.status!==403&&g.logger.error(`Error searching guild ${e}:`,r?.message||r),[]}}function ue(e){try{const n=q?.getChannel(e);return n?.name||"unknown"}catch{return"unknown"}}function oe(e){try{const n=w?.getGuild(e);return n?.name||"Unknown Server"}catch{return"Unknown Server"}}function Q(e){try{const n=k?.getUser(e);if(n)return{username:n.username,globalName:n.globalName,id:n.id,avatar:n.avatar,discriminator:n.discriminator}}catch(n){g.logger.error("Error getting user info:",n)}return null}async function ce(e){const n=C(e);if(n.length===0){h.showToast("No mutual servers found",d.getAssetIDByName("Small"));return}h.showToast(`Searching ${n.length} servers...`,d.getAssetIDByName("ic_search"));const l=[];for(let r=0;r<Math.min(n.length,10);r++){try{const a=await M(n[r].id,e);l.push(...a)}catch{}r<n.length-1&&await new Promise(function(a){return setTimeout(a,300)})}if(l.sort(function(r,a){return new Date(a.timestamp).getTime()-new Date(r.timestamp).getTime()}),h.showToast(`Found ${l.length} messages!`,d.getAssetIDByName("Check")),l.length>0){const r=l[0],a=r.content.length>40?r.content.substring(0,40)+"...":r.content;setTimeout(function(){h.showToast(`Latest: "${a}"`,d.getAssetIDByName("ic_message"))},1500)}}function ge(){const[e,n]=t.React.useState(W),[l,r]=t.React.useState([]),[a,E]=t.React.useState(null),[s,F]=t.React.useState(null),[y,B]=t.React.useState([]),[p,S]=t.React.useState(!1),[j,I]=t.React.useState(""),V=async function(){if(!e||e.length<17){h.showToast("Enter a valid User ID (17-19 digits)",d.getAssetIDByName("Small"));return}S(!0),r([]),I("Finding user info..."),W=e;try{const i=Q(e);E(i);const c=J(e);F(c),I("Finding mutual servers...");const b=C(e);if(B(b),b.length===0){h.showToast("No mutual servers found",d.getAssetIDByName("Small")),S(!1);return}const T=[];for(let R=0;R<Math.min(b.length,15);R++){const U=b[R];I(`${U.name} (${R+1}/${Math.min(b.length,15)})`);try{const A=await M(U.id,e);T.push(...A)}catch{}R<b.length-1&&await new Promise(function(A){return setTimeout(A,400)})}T.sort(function(R,U){return new Date(U.timestamp).getTime()-new Date(R.timestamp).getTime()}),r(T.slice(0,50)),h.showToast(`Found ${T.length} messages`,d.getAssetIDByName("Check"))}catch(i){h.showToast("Error: "+(i?.message||"Unknown"),d.getAssetIDByName("Small"))}finally{S(!1),I("")}},ye=async function(i){S(!0),I(`Searching ${i.name}...`);try{const c=await M(i.id,e);c.sort(function(b,T){return new Date(T.timestamp).getTime()-new Date(b.timestamp).getTime()}),r(c),h.showToast(`Found ${c.length} messages`,d.getAssetIDByName("Check"))}catch(c){h.showToast("Error: "+(c?.message||"Unknown"),d.getAssetIDByName("Small"))}finally{S(!1),I("")}},pe=function(i){try{const c=new Date(i);return`${c.toLocaleDateString()} ${c.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}`}catch{return i}},Ee=function(i){h.showToast("Opening message...",d.getAssetIDByName("Check")),se(i.guildId,i.channelId,i.id)||h.showToast("Navigation failed",d.getAssetIDByName("Small"))};return t.React.createElement(ee,{style:{flex:1,backgroundColor:"#1e1f22"}},[t.React.createElement(N,{key:"search",title:"\u{1F50D} USER SEARCH"},[t.React.createElement(Z,{key:"input",title:"User ID",placeholder:"Enter Discord User ID",value:e,onChangeText:n,keyboardType:"numeric"}),t.React.createElement(o,{key:"searchBtn",label:p?"\u23F3 Searching...":"\u{1F50D} Search All Servers",subLabel:p?j:"Find messages across mutual servers",onPress:p?void 0:V})]),a&&t.React.createElement(N,{key:"userInfo",title:"\u{1F464} USER INFO"},[t.React.createElement(o,{key:"name",label:a.globalName||a.username||"Unknown",subLabel:`@${a.username} \u2022 ID: ${a.id}`}),s&&t.React.createElement(o,{key:"relationship",label:`${s.emoji} ${s.label}`,subLabel:s.isFriend?"You are friends with this user":s.isBlocked?"You have blocked this user":s.hasPendingIncoming?"This user sent you a friend request":s.hasPendingOutgoing?"You sent this user a friend request":"You are not friends with this user"})]),y.length>0&&t.React.createElement(N,{key:"servers",title:`\u{1F3E0} MUTUAL SERVERS (${y.length})`},y.slice(0,20).map(function(i,c){return t.React.createElement(o,{key:`s-${c}`,label:i.name,trailing:o.Arrow?t.React.createElement(o.Arrow,null):null,onPress:function(){return ye(i)}})})),p&&t.React.createElement(te,{key:"loading",style:{padding:20,alignItems:"center"}},[t.React.createElement(re,{key:"spin",size:"large",color:"#5865f2"}),t.React.createElement(v,{key:"txt",style:{color:"#b5bac1",marginTop:10}},j)]),!p&&l.length>0&&t.React.createElement(N,{key:"msgs",title:`\u{1F4AC} MESSAGES (${l.length})`},l.map(function(i,c){return t.React.createElement(ne,{key:`m-${c}`,style:{padding:12,borderBottomWidth:1,borderBottomColor:"#3f4147",backgroundColor:"#2b2d31"},onPress:function(){return Ee(i)},activeOpacity:.7},[t.React.createElement(v,{key:"ch",style:{color:"#5865f2",fontSize:12,marginBottom:2}},`#${ue(i.channelId)} \u2022 ${oe(i.guildId)}`),t.React.createElement(v,{key:"ct",style:{color:"#f2f3f5",fontSize:14,marginBottom:4}},i.content.length>150?i.content.substring(0,150)+"...":i.content),t.React.createElement(v,{key:"tm",style:{color:"#949ba4",fontSize:11}},pe(i.timestamp)+(i.attachments>0?` \u2022 \u{1F4CE}${i.attachments}`:"")+" \u2022 Tap to open")])})),t.React.createElement(N,{key:"debug",title:"\u{1F527} DEBUG INFO"},[t.React.createElement(o,{key:"relStore",label:"RelationshipStore",subLabel:m?"\u2705 Found":"\u274C Not Found"}),t.React.createElement(o,{key:"userStore",label:"UserStore",subLabel:k?"\u2705 Found":"\u274C Not Found"}),t.React.createElement(o,{key:"profileSection",label:"Profile Injection",subLabel:H?"\u2705 Available":"\u274C Not Available"})]),!p&&l.length===0&&t.React.createElement(N,{key:"help",title:"\u2139\uFE0F HOW TO USE"},[t.React.createElement(o,{key:"h0",label:"\u{1F4F1} Quick Access",subLabel:"Tap any user \u2192 scroll down \u2192 Stalker Pro section"}),t.React.createElement(o,{key:"h1",label:"1. Get User ID",subLabel:"Long-press user \u2192 Copy ID (enable Developer Mode)"}),t.React.createElement(o,{key:"h2",label:"2. Search",subLabel:"Paste ID and tap Search All Servers"}),t.React.createElement(o,{key:"h3",label:"3. View Results",subLabel:"See friend status, mutual servers & messages"})])])}const de=ge,he=function(){g.logger.log("Stalker Pro loading..."),g.logger.log("RelationshipStore found:",!!m),g.logger.log("UserProfileSection found:",!!H);try{const e=u.findByProps("UserProfileSection")||u.findByProps("default","UserProfileSection");if(e!=null&&e.default||e!=null&&e.UserProfileSection){const n=e.default?"default":"UserProfileSection",l=X.after(n,e,function(r,a){var E,s,F;try{const y=(E=r[0])==null?void 0:E.userId;if(!y)return a;const B=(s=k?.getCurrentUser)==null?void 0:s.call(k);if(B&&y===B.id||!((F=a?.props)!=null&&F.children)||!Array.isArray(a.props.children))return a;const p=J(y),S=C(y),j=Q(y),I=t.React.createElement(N,{key:"stalker-pro",title:"\u{1F50D} Stalker Pro"},[p&&t.React.createElement(o,{key:"relationship",label:`${p.emoji} ${p.label}`,subLabel:p.isFriend?"You are friends":"Not friends"}),t.React.createElement(K,{key:"div1"}),t.React.createElement(o,{key:"recent",label:"\u{1F50E} Find Recent Messages",subLabel:`Search across ${S.length} mutual servers`,trailing:o.Arrow?t.React.createElement(o.Arrow,null):null,onPress:function(){return ce(y)}}),t.React.createElement(K,{key:"div2"}),t.React.createElement(o,{key:"servers",label:`\u{1F3E0} ${S.length} Mutual Servers`,subLabel:S.slice(0,3).map(function(V){return V.name}).join(", ")+(S.length>3?"...":"")})]);a.props.children.push(I)}catch(y){g.logger.error("Error injecting profile section:",y)}return a});O.push(l),g.logger.log("Profile section injection enabled!")}else g.logger.warn("UserProfileSection not found - profile injection disabled")}catch(e){g.logger.error("Failed to setup profile injection:",e)}h.showToast("Stalker Pro ready!",d.getAssetIDByName("Check"))},fe=function(){g.logger.log("Stalker Pro unloading...");for(const e of O)try{e()}catch(n){g.logger.error("Error unpatching:",n)}O=[],g.logger.log("Stalker Pro unloaded")};return D.onLoad=he,D.onUnload=fe,D.settings=de,D})({},vendetta,vendetta.metro,vendetta.metro.common,vendetta.ui.components,vendetta.ui.assets,vendetta.ui.toasts,vendetta.patcher);
