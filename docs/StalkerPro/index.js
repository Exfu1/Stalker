(function(D,l,c,t,P,g,s){"use strict";var U,G;const{FormSection:R,FormRow:f,FormInput:W}=P.Forms,{ScrollView:J,View:Z,Text:k,TouchableOpacity:Q,ActivityIndicator:X}=P.General,E=c.findByStoreName("UserStore"),C=c.findByStoreName("GuildStore"),v=c.findByStoreName("GuildMemberStore"),O=c.findByStoreName("ChannelStore"),u=((U=t.ReactNative)==null?void 0:U.Clipboard)||c.findByProps("setString","getString")||c.findByProps("getString"),$=c.findByProps("getAPIBaseURL","get")||c.findByProps("API_HOST","get"),m=c.findByProps("jumpToMessage");c.findByProps("openURL")||((G=t.ReactNative)==null||G.Linking);let H="",N=!1,B="",w=null;function j(e){if(!C||!v)return[];try{return Object.values(C.getGuilds()||{}).filter(function(n){return v.getMember(n.id,e)})}catch{return[]}}async function V(e,n){var i;if(!($!=null&&$.get))return[];try{const d=await $.get({url:`/guilds/${e}/messages/search`,query:{author_id:n,include_nsfw:!0}});return(((i=d?.body)==null?void 0:i.messages)||[]).map(function(o){return{id:o[0].id,content:o[0].content||"[No text]",channelId:o[0].channel_id,guildId:e,timestamp:o[0].timestamp}})}catch{return[]}}function x(e){var n;return((n=O?.getChannel(e))==null?void 0:n.name)||"unknown"}function z(e){var n;return((n=C?.getGuild(e))==null?void 0:n.name)||"Unknown"}function K(e){const n=E?.getUser(e);return n?{username:n.username,globalName:n.globalName,id:n.id}:null}function Y(e,n,i){var d,o;l.logger.log("=== NAVIGATING TO MESSAGE ==="),l.logger.log(`Guild: ${e}, Channel: ${n}, Message: ${i}`);try{const r=c.findByProps("selectChannel","selectVoiceChannel");if(r!=null&&r.selectChannel)return r.selectChannel({channelId:n,guildId:e}),l.logger.log("Method 1: selectChannel dispatched"),setTimeout(function(){try{m!=null&&m.jumpToMessage&&(m.jumpToMessage({channelId:n,messageId:i,flash:!0}),l.logger.log("Method 1b: jumpToMessage after selectChannel"))}catch(a){l.logger.log("jumpToMessage failed:",a)}},500),!0}catch(r){l.logger.log("Method 1 failed:",r)}try{if(t.FluxDispatcher)return t.FluxDispatcher.dispatch({type:"CHANNEL_SELECT",channelId:n,guildId:e}),l.logger.log("Method 2a: CHANNEL_SELECT dispatched"),setTimeout(function(){t.FluxDispatcher.dispatch({type:"LOAD_MESSAGES_AROUND",channelId:n,messageId:i,limit:25}),t.FluxDispatcher.dispatch({type:"MESSAGE_HIGHLIGHT",messageId:i,channelId:n}),l.logger.log("Method 2b: LOAD_MESSAGES_AROUND + MESSAGE_HIGHLIGHT dispatched")},300),!0}catch(r){l.logger.log("Method 2 failed:",r)}try{if(m!=null&&m.jumpToMessage)return m.jumpToMessage({channelId:n,messageId:i,flash:!0,jumpType:"INSTANT"}),l.logger.log("Method 3: jumpToMessage direct"),!0}catch(r){l.logger.log("Method 3 failed:",r)}try{const r=c.findByProps("transitionToGuild");if(r!=null&&r.transitionToGuild)return r.transitionToGuild(e,n,i),l.logger.log("Method 4: transitionToGuild"),!0}catch(r){l.logger.log("Method 4 failed:",r)}try{const r=`discord://discord.com/channels/${e}/${n}/${i}`;l.logger.log("Method 5: Trying deep link:",r);const a=((d=t.ReactNative)==null?void 0:d.Linking)||c.findByProps("openURL","canOpenURL");if(a!=null&&a.openURL)return a.openURL(r),l.logger.log("Method 5: openURL called"),!0}catch(r){l.logger.log("Method 5 failed:",r)}try{const r=`https://discord.com/channels/${e}/${n}/${i}`;l.logger.log("Method 6: Trying HTTPS link:",r);const a=((o=t.ReactNative)==null?void 0:o.Linking)||c.findByProps("openURL");if(a!=null&&a.openURL)return a.openURL(r),l.logger.log("Method 6: HTTPS openURL called"),!0}catch(r){l.logger.log("Method 6 failed:",r)}return l.logger.log("All navigation methods failed!"),!1}function _(e){if(!e)return!1;const n=e.trim();return/^\d{17,19}$/.test(n)}async function ee(e){var n;l.logger.log("Auto-searching user:",e);const i=(n=E?.getCurrentUser)==null?void 0:n.call(E);if(i&&e===i.id){l.logger.log("Skipping - this is current user");return}const d=j(e),o=K(e);if(d.length===0){s.showToast("\u274C No mutual servers with this user",g.getAssetIDByName("Small"));return}const r=o?.globalName||o?.username||`User ${e.slice(-4)}`;s.showToast(`\u{1F50D} Searching ${r}...`,g.getAssetIDByName("ic_search"));let a=[];for(let p=0;p<Math.min(d.length,8);p++){try{const T=await V(d[p].id,e);a.push(...T)}catch{}p<d.length-1&&await new Promise(function(T){return setTimeout(T,250)})}if(a.sort(function(p,T){return new Date(T.timestamp).getTime()-new Date(p.timestamp).getTime()}),a.length===0){s.showToast("\u{1F4ED} No messages found",g.getAssetIDByName("Small"));return}s.showToast(`\u2705 Found ${a.length} messages!`,g.getAssetIDByName("Check"));const I=a[0],S=x(I.channelId),b=z(I.guildId),L=`https://discord.com/channels/${I.guildId}/${I.channelId}/${I.id}`;setTimeout(function(){s.showToast(`\u{1F4CD} #${S} in ${b}`,g.getAssetIDByName("ic_message"))},1500),setTimeout(async function(){try{u!=null&&u.setString?(u.setString(L),s.showToast("\u{1F4CB} Link copied! Paste anywhere to open",g.getAssetIDByName("Check"))):s.showToast(`\u{1F517} Go to #${S} in ${b}`,g.getAssetIDByName("Arrow"))}catch(p){l.logger.error("Failed to copy link:",p),s.showToast(`\u{1F517} #${S} in ${b}`,g.getAssetIDByName("Arrow"))}},3e3)}async function q(){try{if(!(u!=null&&u.getString)){l.logger.log("Clipboard.getString not available");return}const e=await u.getString();if(e&&e!==B&&_(e)){B=e;const n=e.trim();l.logger.log("Detected User ID in clipboard:",n),s.showToast("\u{1F3AF} User ID detected!",g.getAssetIDByName("Check")),setTimeout(function(){return ee(n)},1e3)}}catch(e){l.logger.error("Clipboard check failed:",e)}}function te(){const[e,n]=t.React.useState(H),[i,d]=t.React.useState([]),[o,r]=t.React.useState(null),[a,I]=t.React.useState([]),[S,b]=t.React.useState(!1),[L,p]=t.React.useState(""),T=async function(){if(!e||e.length<17){s.showToast("Invalid User ID",g.getAssetIDByName("Small"));return}b(!0),d([]),H=e;const h=K(e);r(h);const y=j(e);if(I(y),y.length===0){s.showToast("No mutual servers",g.getAssetIDByName("Small")),b(!1);return}const M=[];for(let A=0;A<Math.min(y.length,12);A++){p(`${y[A].name} (${A+1}/${Math.min(y.length,12)})`);const F=await V(y[A].id,e);M.push(...F),await new Promise(function(oe){return setTimeout(oe,350)})}M.sort(function(A,F){return new Date(F.timestamp).getTime()-new Date(A.timestamp).getTime()}),d(M.slice(0,50)),s.showToast(`Found ${M.length} messages`,g.getAssetIDByName("Check")),b(!1),p("")},ae=function(h){try{const y=new Date(h);return`${y.toLocaleDateString()} ${y.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}`}catch{return h}},ie=async function(){s.showToast("Checking clipboard...",g.getAssetIDByName("ic_search")),await q()};return t.React.createElement(J,{style:{flex:1,backgroundColor:"#1e1f22"}},[t.React.createElement(R,{key:"ver",title:"\u{1F4F1} STALKER PRO v2.0"},[t.React.createElement(f,{key:"v1",label:"\u2728 Copy ID Detection",subLabel:"Copy any User ID to auto-search!"}),t.React.createElement(f,{key:"v2",label:"\u{1F4CB} Check Clipboard Now",subLabel:"Tap to manually check clipboard",trailing:f.Arrow?t.React.createElement(f.Arrow,null):null,onPress:ie})]),t.React.createElement(R,{key:"search",title:"\u{1F50D} MANUAL SEARCH"},[t.React.createElement(W,{key:"in",title:"User ID",placeholder:"Paste Discord User ID here",value:e,onChangeText:n,keyboardType:"numeric"}),t.React.createElement(f,{key:"btn",label:S?"\u23F3 Searching...":"\u{1F50D} Search",subLabel:S?L:"Find their messages",onPress:S?void 0:T})]),o&&t.React.createElement(R,{key:"user",title:"\u{1F464} USER"},[t.React.createElement(f,{key:"n",label:o.globalName||o.username,subLabel:`@${o.username}`})]),a.length>0&&t.React.createElement(R,{key:"srv",title:`\u{1F3E0} ${a.length} MUTUAL SERVERS`},a.slice(0,10).map(function(h,y){return t.React.createElement(f,{key:`s${y}`,label:h.name})})),S&&t.React.createElement(Z,{key:"load",style:{padding:20,alignItems:"center"}},[t.React.createElement(X,{key:"sp",size:"large",color:"#5865f2"}),t.React.createElement(k,{key:"t",style:{color:"#b5bac1",marginTop:10}},L)]),!S&&i.length>0&&t.React.createElement(R,{key:"msgs",title:`\u{1F4AC} ${i.length} MESSAGES`},i.map(function(h,y){return t.React.createElement(Q,{key:`m${y}`,style:{padding:12,borderBottomWidth:1,borderBottomColor:"#3f4147",backgroundColor:"#2b2d31"},onPress:function(){s.showToast("Opening...",g.getAssetIDByName("Check")),Y(h.guildId,h.channelId,h.id)}},[t.React.createElement(k,{key:"c",style:{color:"#5865f2",fontSize:12}},`#${x(h.channelId)} \u2022 ${z(h.guildId)}`),t.React.createElement(k,{key:"m",style:{color:"#f2f3f5",fontSize:14,marginVertical:3}},h.content.substring(0,100)),t.React.createElement(k,{key:"t",style:{color:"#949ba4",fontSize:11}},ae(h.timestamp))])})),t.React.createElement(R,{key:"status",title:"\u2699\uFE0F STATUS"},[t.React.createElement(f,{key:"s1",label:"Clipboard API",subLabel:u!=null&&u.getString?"\u2705 Available":"\u274C Not Available"}),t.React.createElement(f,{key:"s2",label:"Auto Monitor",subLabel:N?"\u2705 Running":"\u274C Stopped"}),t.React.createElement(f,{key:"s3",label:"Last Clipboard",subLabel:B||"Nothing checked yet"})])])}const le=te,ne=function(){l.logger.log("========================================"),l.logger.log("=== STALKER PRO v2.0 LOADING ==="),l.logger.log("========================================"),l.logger.log("Clipboard API:",!!u),l.logger.log("Clipboard.getString:",!!(u!=null&&u.getString)),l.logger.log("Clipboard.setString:",!!(u!=null&&u.setString)),u!=null&&u.getString?(N=!0,w=setInterval(q,2e3),l.logger.log("Clipboard monitoring STARTED (every 2s)"),s.showToast("\u{1F50D} Stalker Pro v2.0 ready!",g.getAssetIDByName("Check"))):(N=!1,l.logger.warn("Clipboard API not available - manual mode only"),s.showToast("Stalker Pro ready (manual mode)",g.getAssetIDByName("Small")))},re=function(){l.logger.log("=== STALKER PRO UNLOADING ==="),w&&(clearInterval(w),w=null,N=!1,l.logger.log("Clipboard monitoring STOPPED"))};return D.onLoad=ne,D.onUnload=re,D.settings=le,D})({},vendetta,vendetta.metro,vendetta.metro.common,vendetta.ui.components,vendetta.ui.assets,vendetta.ui.toasts);
