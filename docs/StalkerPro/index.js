(function(I,T,p,e,G,R,S,le){"use strict";var U,H,V,_;const{FormSection:j,FormRow:K,FormInput:ie}=G.Forms,{ScrollView:oe,View:d,Text:r,TouchableOpacity:B}=G.General,F=p.findByStoreName("UserStore"),v=p.findByStoreName("GuildStore"),q=p.findByStoreName("GuildMemberStore"),g=p.findByStoreName("ChannelStore"),$=p.findByStoreName("SelectedGuildStore"),D=p.findByProps("getChannelPermissions","can"),{getChannel:Y}=p.findByProps("getChannel")||{},x=((U=p.findByProps("ChannelTypes"))==null?void 0:U.ChannelTypes)||{},b=((H=e.ReactNative)==null?void 0:H.Clipboard)||p.findByProps("setString","getString"),L=p.findByProps("getAPIBaseURL","get")||p.findByProps("API_HOST","get"),J=((_=(V=e.constants)==null?void 0:V.Permissions)==null?void 0:_.VIEW_CHANNEL)||1024,se={1:"Create Invite",2:"Kick Members",4:"Ban Members",8:"Administrator",16:"Manage Channels",32:"Manage Server",64:"Add Reactions",128:"View Audit Log",256:"Priority Speaker",512:"Stream",1024:"View Channel",2048:"Send Messages",4096:"Send TTS",8192:"Manage Messages",16384:"Embed Links",32768:"Attach Files",65536:"Read History",131072:"Mention Everyone",262144:"Use External Emoji",524288:"View Insights",1048576:"Connect",2097152:"Speak",4194304:"Mute Members",8388608:"Deafen Members",16777216:"Move Members",33554432:"Use VAD",67108864:"Change Nickname",134217728:"Manage Nicknames",268435456:"Manage Roles",536870912:"Manage Webhooks",1073741824:"Manage Emojis"};let Q=!1,X="",N=null,O=[];const Z=[x.DM,x.GROUP_DM,x.GUILD_CATEGORY];function ce(t){var a,l;if(!t||(typeof t=="string"&&(t=Y?.(t)||((a=g?.getChannel)==null?void 0:a.call(g,t))),!t||Z.includes(t.type)))return!1;t.realCheck=!0;const s=!((l=D?.can)!=null&&l.call(D,J,t));return delete t.realCheck,s}function ee(t){const a=Number(t),l=[];for(const[s,o]of Object.entries(se))a&Number(s)&&l.push(o);return l}function ue(t,a){var l,s,o;const i=[];try{const y=t.permissionOverwrites||{},w=(l=v?.getGuild)==null?void 0:l.call(v,a);for(const[c,u]of Object.entries(y)){if(!u)continue;const f=Number(u.allow||0),E=Number(u.deny||0);let m="Unknown",z=0;const M=u.type===0||u.type==="role"?"role":"user";if(M==="role"){const k=(s=w?.roles)==null?void 0:s[c];k?(m=k.name,z=k.color||0):c===a&&(m="@everyone")}else{const k=(o=F?.getUser)==null?void 0:o.call(F,c);m=k?k.globalName||k.username:`User ${c.slice(-4)}`}i.push({id:c,name:m,type:M,color:z,allowed:ee(f),denied:ee(E)})}i.sort(function(c,u){return c.name==="@everyone"?-1:u.name==="@everyone"?1:c.type!==u.type?c.type==="role"?-1:1:c.name.localeCompare(u.name)})}catch(y){T.logger.error("getChannelPermissions error:",y)}return{overwrites:i}}function te(t){switch(t){case 0:return"\u{1F4AC}";case 2:return"\u{1F50A}";case 4:return"\u{1F4C1}";case 5:return"\u{1F4E2}";case 13:return"\u{1F3AD}";case 15:return"\u{1F4CB}";default:return"\u{1F4DD}"}}function ne(t){var a,l;try{const s=((a=g?.getMutableGuildChannelsForGuild)==null?void 0:a.call(g,t))||Object.values(((l=g?.getMutableGuildChannels)==null?void 0:l.call(g))||{}).filter(function(o){return o?.guild_id===t});return Array.isArray(s)?s:Object.values(s||{})}catch{return[]}}function de(t){var a,l;const s=[];try{const o=ne(t);for(const i of o)!(i!=null&&i.id)||i.type===4||Z.includes(i.type)||ce(i)&&s.push({id:i.id,name:i.name||"unknown",type:i.type||0,parentName:i.parent_id&&((l=(a=g?.getChannel)==null?void 0:a.call(g,i.parent_id))==null?void 0:l.name)||"",permissions:ue(i,t)})}catch(o){T.logger.error("getHiddenChannels error:",o)}return s.sort(function(o,i){return o.name.localeCompare(i.name)})}function ge(t){if(!v||!q)return[];try{return Object.values(v.getGuilds()||{}).filter(function(a){return q.getMember(a.id,t)})}catch{return[]}}async function ye(t,a){var l;if(!(L!=null&&L.get))return[];try{const s=await L.get({url:`/guilds/${t}/messages/search`,query:{author_id:a,include_nsfw:!0,sort_by:"timestamp",sort_order:"desc"}});return(((l=s?.body)==null?void 0:l.messages)||[]).map(function(o){return{id:o[0].id,channelId:o[0].channel_id,guildId:t,timestamp:o[0].timestamp}})}catch{return[]}}async function re(t){var a,l;const s=(a=F?.getCurrentUser)==null?void 0:a.call(F);if(s&&t===s.id)return;const o=ge(t);if(o.length===0){S.showToast("\u274C No mutual servers",R.getAssetIDByName("Small"));return}S.showToast("\u{1F50D} Searching...",R.getAssetIDByName("ic_search"));let i=[];for(let u=0;u<Math.min(o.length,8);u++){try{i.push(...await ye(o[u].id,t))}catch{}u<o.length-1&&await new Promise(function(f){return setTimeout(f,250)})}if(i.sort(function(u,f){return new Date(f.timestamp).getTime()-new Date(u.timestamp).getTime()}),i.length===0){S.showToast("\u{1F4ED} No messages",R.getAssetIDByName("Small"));return}S.showToast(`\u2705 Found ${i.length}!`,R.getAssetIDByName("Check"));const y=i[0],w=`https://discord.com/channels/${y.guildId}/${y.channelId}/${y.id}`,c=((l=g?.getChannel(y.channelId))==null?void 0:l.name)||"unknown";setTimeout(function(){const u=Date.now()-new Date(y.timestamp).getTime(),f=Math.floor(u/6e4),E=Math.floor(f/60),m=Math.floor(E/24);S.showToast(`\u{1F4CD} #${c} (${f<60?f+"m":E<24?E+"h":m+"d"})`,R.getAssetIDByName("ic_message"))},1500),setTimeout(function(){b!=null&&b.setString&&(b.setString(w),S.showToast("\u{1F4CB} Copied!",R.getAssetIDByName("Check")))},3e3)}async function fe(){try{if(!(b!=null&&b.getString))return;const t=await b.getString();t&&t!==X&&/^\d{17,19}$/.test(t.trim())&&(X=t,S.showToast("\u{1F3AF} ID detected!",R.getAssetIDByName("Check")),setTimeout(function(){return re(t.trim())},1e3))}catch{}}function he(){const[t,a]=e.React.useState("hidden"),[l,s]=e.React.useState([]),[o,i]=e.React.useState(!1),[y,w]=e.React.useState(null);e.React.useState(null);const[c,u]=e.React.useState(null),[f,E]=e.React.useState(""),[m,z]=e.React.useState(""),[M,k]=e.React.useState(!1);e.React.useEffect(function(){ae()},[]);const ae=function(){var n,C;i(!0);try{const h=(n=$?.getGuildId)==null?void 0:n.call($);if(h){const A=(C=v?.getGuild)==null?void 0:C.call(v,h);w(A);const P=de(h);s(P);const ke=ne(h);E(`${ke.length} ch \u2192 ${P.length} hidden`),S.showToast(P.length>0?`\u{1F512} ${P.length} hidden!`:"\u2728 No hidden",R.getAssetIDByName("Check"))}else w(null),s([]),E("Open server first")}catch(h){E(`Error: ${h}`)}finally{i(!1)}},Re=async function(){!m||m.length<17||(k(!0),await re(m),k(!1))},Se=function(n){return n?`#${n.toString(16).padStart(6,"0")}`:"#99AAB5"},W=function({id:n,label:C,icon:h}){return e.React.createElement(B,{style:{flex:1,padding:10,backgroundColor:t===n?"#5865F2":"#2b2d31",borderRadius:8,marginHorizontal:2},onPress:function(){a(n),n!=="perms"&&u(null)}},e.React.createElement(r,{style:{color:"#fff",textAlign:"center",fontSize:12,fontWeight:t===n?"bold":"normal"}},`${h} ${C}`))};return e.React.createElement(oe,{style:{flex:1,backgroundColor:"#1e1f22"}},[e.React.createElement(d,{key:"h",style:{padding:16,backgroundColor:"#2b2d31",marginBottom:8}},[e.React.createElement(r,{key:"t",style:{color:"#fff",fontSize:20,fontWeight:"bold",textAlign:"center"}},"\u{1F50D} Stalker Pro v4.1"),e.React.createElement(r,{key:"s",style:{color:"#b5bac1",fontSize:12,textAlign:"center",marginTop:4}},y?`\u{1F4CD} ${y.name}`:"Open a server")]),e.React.createElement(d,{key:"tabs",style:{flexDirection:"row",padding:8,marginBottom:8}},[e.React.createElement(W,{key:"1",id:"hidden",label:"Hidden",icon:"\u{1F512}"}),e.React.createElement(W,{key:"2",id:"perms",label:"Perms",icon:"\u{1F510}"}),e.React.createElement(W,{key:"3",id:"search",label:"Msgs",icon:"\u{1F4AC}"})]),t==="hidden"&&[e.React.createElement(B,{key:"scan",style:{margin:12,padding:14,backgroundColor:"#5865F2",borderRadius:12,alignItems:"center"},onPress:ae},e.React.createElement(r,{style:{color:"#fff",fontWeight:"bold",fontSize:16}},o?"\u23F3...":"\u{1F504} Scan Server")),e.React.createElement(r,{key:"dbg",style:{color:"#949ba4",textAlign:"center",fontSize:11,marginBottom:8}},f),...l.map(function(n,C){return e.React.createElement(B,{key:`c${C}`,style:{margin:8,marginTop:4,padding:14,backgroundColor:"#2b2d31",borderRadius:12,borderLeftWidth:4,borderLeftColor:"#5865F2"},onPress:function(){u(n),a("perms")}},[e.React.createElement(d,{key:"h",style:{flexDirection:"row",alignItems:"center"}},[e.React.createElement(r,{key:"i",style:{fontSize:18,marginRight:10}},te(n.type)),e.React.createElement(d,{key:"n",style:{flex:1}},[e.React.createElement(r,{key:"nm",style:{color:"#fff",fontSize:16,fontWeight:"bold"}},n.name),n.parentName&&e.React.createElement(r,{key:"p",style:{color:"#949ba4",fontSize:12}},`in ${n.parentName}`)]),e.React.createElement(r,{key:"a",style:{color:"#5865F2",fontSize:12}},"View Perms \u2192")]),e.React.createElement(r,{key:"r",style:{color:"#00b894",fontSize:12,marginTop:6}},`\u{1F465} ${n.permissions.overwrites.length} permission overwrites`)])}),l.length===0&&!o&&e.React.createElement(d,{key:"empty",style:{padding:30,alignItems:"center"}},[e.React.createElement(r,{key:"e1",style:{fontSize:40}},"\u{1F513}"),e.React.createElement(r,{key:"e2",style:{color:"#fff",fontSize:16,marginTop:10}},y?"No hidden channels":"Open a server")])],t==="perms"&&[!c&&e.React.createElement(d,{key:"no-sel",style:{padding:30,alignItems:"center"}},[e.React.createElement(r,{key:"t1",style:{fontSize:40}},"\u{1F510}"),e.React.createElement(r,{key:"t2",style:{color:"#fff",fontSize:16,marginTop:10}},"Select a channel from Hidden tab"),e.React.createElement(r,{key:"t3",style:{color:"#b5bac1",fontSize:12,marginTop:4}},"Tap any hidden channel to view its permissions")]),c&&[e.React.createElement(d,{key:"ch-header",style:{padding:16,backgroundColor:"#2b2d31",margin:8,borderRadius:12}},[e.React.createElement(d,{key:"row",style:{flexDirection:"row",alignItems:"center"}},[e.React.createElement(r,{key:"icon",style:{fontSize:24,marginRight:12}},te(c.type)),e.React.createElement(d,{key:"info",style:{flex:1}},[e.React.createElement(r,{key:"name",style:{color:"#fff",fontSize:18,fontWeight:"bold"}},c.name),c.parentName&&e.React.createElement(r,{key:"cat",style:{color:"#b5bac1",fontSize:12}},`in ${c.parentName}`)])])]),e.React.createElement(B,{key:"copy-id",style:{margin:8,padding:12,backgroundColor:"#3f4147",borderRadius:8},onPress:function(){b!=null&&b.setString&&(b.setString(c.id),S.showToast("\u{1F4CB} Channel ID copied",R.getAssetIDByName("Check")))}},e.React.createElement(r,{style:{color:"#b5bac1",fontSize:12,textAlign:"center"}},`\u{1F4CB} ID: ${c.id} (tap to copy)`)),e.React.createElement(r,{key:"perms-title",style:{color:"#fff",fontSize:16,fontWeight:"bold",marginLeft:12,marginTop:8}},`\u{1F510} Permission Overwrites (${c.permissions.overwrites.length})`),...c.permissions.overwrites.map(function(n,C){return e.React.createElement(d,{key:`ow-${C}`,style:{margin:8,marginTop:4,padding:12,backgroundColor:"#2b2d31",borderRadius:12,borderLeftWidth:3,borderLeftColor:n.type==="role"?n.color||"#5865F2":"#43b581"}},[e.React.createElement(d,{key:"hdr",style:{flexDirection:"row",alignItems:"center",marginBottom:8}},[e.React.createElement(r,{key:"type",style:{fontSize:14,marginRight:8}},n.type==="role"?"\u{1F3F7}\uFE0F":"\u{1F464}"),e.React.createElement(r,{key:"name",style:{color:n.type==="role"?Se(n.color):"#43b581",fontSize:14,fontWeight:"bold",flex:1}},n.name),e.React.createElement(r,{key:"badge",style:{color:"#949ba4",fontSize:10,backgroundColor:"#3f4147",paddingHorizontal:6,paddingVertical:2,borderRadius:4}},n.type.toUpperCase())]),n.allowed.length>0&&e.React.createElement(d,{key:"allowed",style:{marginTop:4}},[e.React.createElement(r,{key:"title",style:{color:"#43b581",fontSize:11,fontWeight:"bold",marginBottom:4}},`\u2705 ALLOWED (${n.allowed.length}):`),e.React.createElement(d,{key:"perms",style:{flexDirection:"row",flexWrap:"wrap"}},n.allowed.map(function(h,A){return e.React.createElement(r,{key:`a${A}`,style:{color:"#43b581",fontSize:10,backgroundColor:"rgba(67,181,129,0.2)",paddingHorizontal:6,paddingVertical:2,borderRadius:4,marginRight:4,marginBottom:4}},h)}))]),n.denied.length>0&&e.React.createElement(d,{key:"denied",style:{marginTop:8}},[e.React.createElement(r,{key:"title",style:{color:"#ed4245",fontSize:11,fontWeight:"bold",marginBottom:4}},`\u274C DENIED (${n.denied.length}):`),e.React.createElement(d,{key:"perms",style:{flexDirection:"row",flexWrap:"wrap"}},n.denied.map(function(h,A){return e.React.createElement(r,{key:`d${A}`,style:{color:"#ed4245",fontSize:10,backgroundColor:"rgba(237,66,69,0.2)",paddingHorizontal:6,paddingVertical:2,borderRadius:4,marginRight:4,marginBottom:4}},h)}))]),n.allowed.length===0&&n.denied.length===0&&e.React.createElement(r,{key:"none",style:{color:"#949ba4",fontSize:11,fontStyle:"italic"}},"No specific permissions set")])}),c.permissions.overwrites.length===0&&e.React.createElement(d,{key:"no-perms",style:{padding:20,alignItems:"center"}},e.React.createElement(r,{style:{color:"#949ba4",fontSize:12}},"No permission overwrites found"))]],t==="search"&&[e.React.createElement(j,{key:"auto",title:"\u{1F4AC} MESSAGES"},[e.React.createElement(K,{key:"a1",label:"\u{1F4CB} Auto-detect",subLabel:Q?"\u2705 Copy User ID to search":"\u274C"})]),e.React.createElement(j,{key:"man",title:"\u{1F50D} SEARCH"},[e.React.createElement(ie,{key:"in",title:"User ID",value:m,onChangeText:z,keyboardType:"numeric"}),e.React.createElement(K,{key:"btn",label:M?"\u23F3...":"\u{1F50D} Find",onPress:Re})])]])}const pe=he,be=function(){T.logger.log("=== STALKER PRO v4.1 ==="),D!=null&&D.can&&(O.push(le.after("can",D,function([t,a],l){return a!=null&&a.realCheck?l:t===J?!0:l})),T.logger.log("\u2705 Patched Permissions.can")),b!=null&&b.getString&&(Q=!0,N=setInterval(fe,2e3)),S.showToast("\u{1F50D} Stalker Pro v4.1",R.getAssetIDByName("Check"))},me=function(){N&&(clearInterval(N),N=null);for(const t of O)try{t()}catch{}O=[]};return I.onLoad=be,I.onUnload=me,I.settings=pe,I})({},vendetta,vendetta.metro,vendetta.metro.common,vendetta.ui.components,vendetta.ui.assets,vendetta.ui.toasts,vendetta.patcher);
