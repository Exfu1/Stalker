(function(y,v,o,B,a,R,S,m){"use strict";const{FormSection:w,FormRow:s,FormDivider:F}=R.Forms,b=o.findByStoreName("UserStore"),k=o.findByStoreName("GuildStore"),u=o.findByStoreName("ChannelStore"),C=o.findByStoreName("MessageStore"),A=o.findByStoreName("GuildMemberStore");let p=[];function M(n){const c=k?Object.values(k.getGuilds()||{}):[],e=[];for(const t of c)A?.getMember(t.id,n)&&e.push(t);return e}function N(n,c){var e,t;const d=[];for(const l of c)try{const f=(u?Object.values(((e=u.getChannels)==null?void 0:e.call(u))||((t=u.getMutableGuildChannels)==null?void 0:t.call(u))||{}):[]).filter(function(r){return r.guild_id===l.id&&r.type===0});for(const r of f){const g=C?.getMessages(r.id);if(g!=null&&g._array){const h=g._array.filter(function(i){var P;return((P=i.author)==null?void 0:P.id)===n});for(let i=0;i<Math.min(h.length,3);i++)d.push({id:h[i].id,content:(h[i].content||"").substring(0,50),channel:r.name,guild:l.name})}}}catch{}return d.slice(0,10)}const E=function(){try{const n=o.findByProps("UserProfileSection");n!=null&&n.default&&p.push(B.after("default",n,function(c,e){var t,d;const l=(t=c[0])==null?void 0:t.userId;if(!l)return e;const f=b?.getCurrentUser();if(f&&l===f.id)return e;if((d=e?.props)!=null&&d.children&&Array.isArray(e.props.children)){const r=M(l),g=a.React.createElement(w,{key:"stalker-pro",title:"\u{1F50D} Stalker Pro"},[a.React.createElement(s,{key:"recent",label:"Recent Messages",subLabel:"Find their messages across servers",trailing:s.Arrow?a.React.createElement(s.Arrow,null):null,onPress:function(){const h=N(l,r);m.showToast(`Found ${h.length} messages`,S.getAssetIDByName("Check"))}}),a.React.createElement(F,{key:"div"}),a.React.createElement(s,{key:"hidden",label:"Hidden Channels",subLabel:"Channels they can see but you can't",trailing:s.Arrow?a.React.createElement(s.Arrow,null):null,onPress:function(){m.showToast(`Checking ${r.length} servers`,S.getAssetIDByName("Check"))}})]);e.props.children.push(g)}return e})),m.showToast("Stalker Pro loaded!",S.getAssetIDByName("Check")),v.logger.log("Stalker Pro plugin loaded successfully")}catch(n){v.logger.error("Stalker Pro load error:",n)}},D=function(){for(const n of p)n?.();p=[],v.logger.log("Stalker Pro plugin unloaded")};return y.onLoad=E,y.onUnload=D,y})({},vendetta,vendetta.metro,vendetta.patcher,vendetta.metro.common,vendetta.ui.components,vendetta.ui.assets,vendetta.ui.toasts);
