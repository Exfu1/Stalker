(function(v,u,a,r,z,g,f,$){"use strict";var K,q,W;const{FormSection:E,FormRow:c,FormInput:ee,FormDivider:J}=z.Forms,{ScrollView:te,View:re,Text:A,TouchableOpacity:ne,ActivityIndicator:le,Linking:ae}=z.General,j=ae||((K=r.ReactNative)==null?void 0:K.Linking),B=a.findByStoreName("UserStore"),O=a.findByStoreName("GuildStore"),Q=a.findByStoreName("GuildMemberStore"),X=a.findByStoreName("ChannelStore"),b=a.findByStoreName("RelationshipStore"),P=a.findByProps("UserProfileSection")||a.findByProps("default","UserProfileSection")||a.findByName("UserProfileSection")||a.findByDisplayName("UserProfileSection")||a.findByProps("UserProfile")||a.findByName("UserProfile")||a.findByDisplayName("UserProfile")||a.findByProps("ProfileBanner")||a.findByProps("UserProfileHeader")||a.findByName("UserProfileHeader")||a.findByProps("UserProfileBody")||null,ie=((q=a.findByProps("UserProfileSection"))==null?void 0:q.UserProfileSection)||a.findByName("UserProfileSection")||a.findByDisplayName("UserProfileSection")||((W=a.findByProps("Section","UserProfileSection"))==null?void 0:W.Section)||null,H=a.findByProps("getAPIBaseURL","get")||a.findByProps("API_HOST","get"),k=a.findByProps("transitionToGuild","transitionTo")||a.findByProps("transitionTo")||a.findByProps("replaceWith","back")||a.findByProps("openURL"),V=a.findByProps("jumpToMessage")||a.findByProps("fetchMessages","jumpToMessage");let R=[],Z="";const h={NONE:0,FRIEND:1,BLOCKED:2,PENDING_INCOMING:3,PENDING_OUTGOING:4,IMPLICIT:5};let U="Not attempted";function _(n){var e,t,l,i,y;try{if(!b)return null;const s=(y=(i=(e=b.getRelationshipType)==null?void 0:e.call(b,n))!=null?i:(l=(t=b.getRelationship)==null?void 0:t.call(b,n))==null?void 0:l.type)!=null?y:h.NONE;return{type:s,isFriend:s===h.FRIEND,isBlocked:s===h.BLOCKED,hasPendingIncoming:s===h.PENDING_INCOMING,hasPendingOutgoing:s===h.PENDING_OUTGOING,label:oe(s),emoji:se(s)}}catch(s){return u.logger.error("Error getting relationship:",s),null}}function oe(n){switch(n){case h.FRIEND:return"Friend";case h.BLOCKED:return"Blocked";case h.PENDING_INCOMING:return"Pending (Incoming)";case h.PENDING_OUTGOING:return"Pending (Outgoing)";default:return"Not Friends"}}function se(n){switch(n){case h.FRIEND:return"\u2705";case h.BLOCKED:return"\u{1F6AB}";case h.PENDING_INCOMING:return"\u{1F4E8}";case h.PENDING_OUTGOING:return"\u{1F4E4}";default:return"\u274C"}}function Y(n){try{const e=O?Object.values(O.getGuilds()||{}):[],t=[];for(const l of e)Q?.getMember(l.id,n)&&t.push(l);return t}catch(e){return u.logger.error("Error getting mutual guilds:",e),[]}}function ue(n,e,t){const l=`discord://-/channels/${n}/${e}/${t}`;try{if(r.FluxDispatcher)return r.FluxDispatcher.dispatch({type:"NAVIGATE_TO_JUMP_TO_MESSAGE",messageId:t,channelId:e,guildId:n}),!0}catch{}try{if(V!=null&&V.jumpToMessage)return V.jumpToMessage({channelId:e,messageId:t,flash:!0}),!0}catch{}try{if(k!=null&&k.transitionToGuild)return k.transitionToGuild(n,e,t),!0;if(k!=null&&k.transitionTo)return k.transitionTo(`/channels/${n}/${e}/${t}`),!0}catch{}try{if(j!=null&&j.openURL)return j.openURL(l),!0}catch{}return!1}async function x(n,e){var t;try{if(!(H!=null&&H.get))return[];const l=await H.get({url:`/guilds/${n}/messages/search`,query:{author_id:e,include_nsfw:!0}});return(t=l?.body)!=null&&t.messages?l.body.messages.map(function(i){var y;const s=i[0];return{id:s.id,content:s.content||"[No text content]",channelId:s.channel_id,guildId:n,timestamp:s.timestamp,attachments:((y=s.attachments)==null?void 0:y.length)||0}}):[]}catch(l){return l?.status!==403&&u.logger.error(`Error searching guild ${n}:`,l?.message||l),[]}}function ce(n){try{const e=X?.getChannel(n);return e?.name||"unknown"}catch{return"unknown"}}function de(n){try{const e=O?.getGuild(n);return e?.name||"Unknown Server"}catch{return"Unknown Server"}}function ge(n){try{const e=B?.getUser(n);if(e)return{username:e.username,globalName:e.globalName,id:e.id,avatar:e.avatar,discriminator:e.discriminator}}catch(e){u.logger.error("Error getting user info:",e)}return null}async function fe(n){const e=Y(n);if(e.length===0){f.showToast("No mutual servers found",g.getAssetIDByName("Small"));return}f.showToast(`Searching ${e.length} servers...`,g.getAssetIDByName("ic_search"));const t=[];for(let l=0;l<Math.min(e.length,10);l++){try{const i=await x(e[l].id,n);t.push(...i)}catch{}l<e.length-1&&await new Promise(function(i){return setTimeout(i,300)})}if(t.sort(function(l,i){return new Date(i.timestamp).getTime()-new Date(l.timestamp).getTime()}),f.showToast(`Found ${t.length} messages!`,g.getAssetIDByName("Check")),t.length>0){const l=t[0],i=l.content.length>40?l.content.substring(0,40)+"...":l.content;setTimeout(function(){f.showToast(`Latest: "${i}"`,g.getAssetIDByName("ic_message"))},1500)}}function he(){const[n,e]=r.React.useState(Z),[t,l]=r.React.useState([]),[i,y]=r.React.useState(null),[s,N]=r.React.useState(null),[D,T]=r.React.useState([]),[p,I]=r.React.useState(!1),[L,F]=r.React.useState(""),Ne=async function(){if(!n||n.length<17){f.showToast("Enter a valid User ID (17-19 digits)",g.getAssetIDByName("Small"));return}I(!0),l([]),F("Finding user info..."),Z=n;try{const o=ge(n);y(o);const d=_(n);N(d),F("Finding mutual servers...");const S=Y(n);if(T(S),S.length===0){f.showToast("No mutual servers found",g.getAssetIDByName("Small")),I(!1);return}const w=[];for(let m=0;m<Math.min(S.length,15);m++){const C=S[m];F(`${C.name} (${m+1}/${Math.min(S.length,15)})`);try{const M=await x(C.id,n);w.push(...M)}catch{}m<S.length-1&&await new Promise(function(M){return setTimeout(M,400)})}w.sort(function(m,C){return new Date(C.timestamp).getTime()-new Date(m.timestamp).getTime()}),l(w.slice(0,50)),f.showToast(`Found ${w.length} messages`,g.getAssetIDByName("Check"))}catch(o){f.showToast("Error: "+(o?.message||"Unknown"),g.getAssetIDByName("Small"))}finally{I(!1),F("")}},Se=async function(o){I(!0),F(`Searching ${o.name}...`);try{const d=await x(o.id,n);d.sort(function(S,w){return new Date(w.timestamp).getTime()-new Date(S.timestamp).getTime()}),l(d),f.showToast(`Found ${d.length} messages`,g.getAssetIDByName("Check"))}catch(d){f.showToast("Error: "+(d?.message||"Unknown"),g.getAssetIDByName("Small"))}finally{I(!1),F("")}},Ee=function(o){try{const d=new Date(o);return`${d.toLocaleDateString()} ${d.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}`}catch{return o}},be=function(o){f.showToast("Opening message...",g.getAssetIDByName("Check")),ue(o.guildId,o.channelId,o.id)||f.showToast("Navigation failed",g.getAssetIDByName("Small"))};return r.React.createElement(te,{style:{flex:1,backgroundColor:"#1e1f22"}},[r.React.createElement(E,{key:"search",title:"\u{1F50D} USER SEARCH"},[r.React.createElement(ee,{key:"input",title:"User ID",placeholder:"Enter Discord User ID",value:n,onChangeText:e,keyboardType:"numeric"}),r.React.createElement(c,{key:"searchBtn",label:p?"\u23F3 Searching...":"\u{1F50D} Search All Servers",subLabel:p?L:"Find messages across mutual servers",onPress:p?void 0:Ne})]),i&&r.React.createElement(E,{key:"userInfo",title:"\u{1F464} USER INFO"},[r.React.createElement(c,{key:"name",label:i.globalName||i.username||"Unknown",subLabel:`@${i.username} \u2022 ID: ${i.id}`}),s&&r.React.createElement(c,{key:"relationship",label:`${s.emoji} ${s.label}`,subLabel:s.isFriend?"You are friends with this user":s.isBlocked?"You have blocked this user":s.hasPendingIncoming?"This user sent you a friend request":s.hasPendingOutgoing?"You sent this user a friend request":"You are not friends with this user"})]),D.length>0&&r.React.createElement(E,{key:"servers",title:`\u{1F3E0} MUTUAL SERVERS (${D.length})`},D.slice(0,20).map(function(o,d){return r.React.createElement(c,{key:`s-${d}`,label:o.name,trailing:c.Arrow?r.React.createElement(c.Arrow,null):null,onPress:function(){return Se(o)}})})),p&&r.React.createElement(re,{key:"loading",style:{padding:20,alignItems:"center"}},[r.React.createElement(le,{key:"spin",size:"large",color:"#5865f2"}),r.React.createElement(A,{key:"txt",style:{color:"#b5bac1",marginTop:10}},L)]),!p&&t.length>0&&r.React.createElement(E,{key:"msgs",title:`\u{1F4AC} MESSAGES (${t.length})`},t.map(function(o,d){return r.React.createElement(ne,{key:`m-${d}`,style:{padding:12,borderBottomWidth:1,borderBottomColor:"#3f4147",backgroundColor:"#2b2d31"},onPress:function(){return be(o)},activeOpacity:.7},[r.React.createElement(A,{key:"ch",style:{color:"#5865f2",fontSize:12,marginBottom:2}},`#${ce(o.channelId)} \u2022 ${de(o.guildId)}`),r.React.createElement(A,{key:"ct",style:{color:"#f2f3f5",fontSize:14,marginBottom:4}},o.content.length>150?o.content.substring(0,150)+"...":o.content),r.React.createElement(A,{key:"tm",style:{color:"#949ba4",fontSize:11}},Ee(o.timestamp)+(o.attachments>0?` \u2022 \u{1F4CE}${o.attachments}`:"")+" \u2022 Tap to open")])})),r.React.createElement(E,{key:"debug",title:"\u{1F527} DEBUG INFO"},[r.React.createElement(c,{key:"relStore",label:"RelationshipStore",subLabel:b?"\u2705 Found":"\u274C Not Found"}),r.React.createElement(c,{key:"userStore",label:"UserStore",subLabel:B?"\u2705 Found":"\u274C Not Found"}),r.React.createElement(c,{key:"profileModule",label:"Profile Module",subLabel:P?"\u2705 Found":"\u274C Not Found"}),r.React.createElement(c,{key:"profileInjection",label:"Profile Injection",subLabel:U})]),!p&&t.length===0&&r.React.createElement(E,{key:"help",title:"\u2139\uFE0F HOW TO USE"},[r.React.createElement(c,{key:"h0",label:"\u{1F4F1} Quick Access",subLabel:"Tap any user \u2192 scroll down \u2192 Stalker Pro section"}),r.React.createElement(c,{key:"h1",label:"1. Get User ID",subLabel:"Long-press user \u2192 Copy ID (enable Developer Mode)"}),r.React.createElement(c,{key:"h2",label:"2. Search",subLabel:"Paste ID and tap Search All Servers"}),r.React.createElement(c,{key:"h3",label:"3. View Results",subLabel:"See friend status, mutual servers & messages"})])])}const ye=he,pe=function(){var n;u.logger.log("=== Stalker Pro Loading ==="),u.logger.log("RelationshipStore:",!!b),u.logger.log("UserProfileModule:",!!P),u.logger.log("UserProfileSectionModule:",!!ie),P&&u.logger.log("UserProfileModule keys:",Object.keys(P));let e=!1;if(P!=null&&P.default)try{const t=$.after("default",P,G);R.push(t),e=!0,U="\u2705 Patched (default)",u.logger.log("Profile patch applied via default!")}catch(t){u.logger.error("Failed to patch default:",t)}if(!e&&P!=null&&P.UserProfileSection)try{const t=$.after("UserProfileSection",P,G);R.push(t),e=!0,U="\u2705 Patched (UserProfileSection)",u.logger.log("Profile patch applied via UserProfileSection!")}catch(t){u.logger.error("Failed to patch UserProfileSection:",t)}if(!e){const t=a.findByName("UserProfileSection",!1);if(t!=null&&t.default)try{const l=$.after("default",t,G);R.push(l),e=!0,U="\u2705 Patched (findByName)",u.logger.log("Profile patch applied via findByName!")}catch(l){u.logger.error("Failed to patch findByName result:",l)}}if(!e){const t=a.findByName("UserProfile",!1)||a.findByDisplayName("UserProfile")||((n=a.findByProps("UserProfile"))==null?void 0:n.UserProfile);if(t)try{const l=t.default?"default":"UserProfile",i=t.default?t:{UserProfile:t},y=$.after(l,i,G);R.push(y),e=!0,U="\u2705 Patched (UserProfile)",u.logger.log("Profile patch applied via UserProfile!")}catch(l){u.logger.error("Failed to patch UserProfile:",l)}}e||(U="\u274C No compatible module found",u.logger.warn("Could not find profile module to patch")),f.showToast("Stalker Pro ready!",g.getAssetIDByName("Check"))};function G(n,e){var t,l,i,y,s;try{const N=((t=n[0])==null?void 0:t.userId)||((i=(l=n[0])==null?void 0:l.user)==null?void 0:i.id);if(!N)return e;const D=(y=B?.getCurrentUser)==null?void 0:y.call(B);if(D&&N===D.id||!((s=e?.props)!=null&&s.children))return e;Array.isArray(e.props.children)||(e.props.children=[e.props.children]);const T=_(N),p=Y(N),I=r.React.createElement(E,{key:"stalker-pro",title:"\u{1F50D} Stalker Pro"},[T&&r.React.createElement(c,{key:"relationship",label:`${T.emoji} ${T.label}`,subLabel:T.isFriend?"You are friends":"Not friends"}),r.React.createElement(J,{key:"div1"}),r.React.createElement(c,{key:"recent",label:"\u{1F50E} Find Recent Messages",subLabel:`Search across ${p.length} mutual servers`,trailing:c.Arrow?r.React.createElement(c.Arrow,null):null,onPress:function(){return fe(N)}}),r.React.createElement(J,{key:"div2"}),r.React.createElement(c,{key:"servers",label:`\u{1F3E0} ${p.length} Mutual Servers`,subLabel:p.slice(0,3).map(function(L){return L.name}).join(", ")+(p.length>3?"...":"")})]);e.props.children.push(I)}catch(N){u.logger.error("Error injecting profile section:",N)}return e}const Pe=function(){u.logger.log("Stalker Pro unloading...");for(const n of R)try{n()}catch(e){u.logger.error("Error unpatching:",e)}R=[],u.logger.log("Stalker Pro unloaded")};return v.onLoad=pe,v.onUnload=Pe,v.settings=ye,v})({},vendetta,vendetta.metro,vendetta.metro.common,vendetta.ui.components,vendetta.ui.assets,vendetta.ui.toasts,vendetta.patcher);
