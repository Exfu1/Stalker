(function(B,f,u,t,j,y,p,G){"use strict";var O;const{FormSection:E,FormRow:s,FormInput:K,FormDivider:V}=j.Forms,{ScrollView:Q,View:X,Text:w,TouchableOpacity:Z,ActivityIndicator:ee,Linking:te}=j.General,z=te||((O=t.ReactNative)==null?void 0:O.Linking),R=u.findByStoreName("UserStore"),D=u.findByStoreName("GuildStore"),H=u.findByStoreName("GuildMemberStore"),Y=u.findByStoreName("ChannelStore"),$=u.findByStoreName("RelationshipStore"),L=u.findByProps("getAPIBaseURL","get")||u.findByProps("API_HOST","get");u.findByProps("transitionToGuild","transitionTo")||u.findByProps("transitionTo");const q=u.findByProps("jumpToMessage");let A=[],x="",F="Not attempted";function C(n){var r,l;if(!$)return null;try{const e=(l=(r=$.getRelationshipType)==null?void 0:r.call($,n))!=null?l:0;return{type:e,isFriend:e===1,emoji:e===1?"\u2705":e===2?"\u{1F6AB}":e===3?"\u{1F4E8}":e===4?"\u{1F4E4}":"\u274C",label:e===1?"Friend":e===2?"Blocked":e===3?"Pending In":e===4?"Pending Out":"Not Friends"}}catch{return null}}function N(n){if(!D||!H)return[];try{return Object.values(D.getGuilds()||{}).filter(function(r){return H.getMember(r.id,n)})}catch{return[]}}async function J(n,r){var l;if(!(L!=null&&L.get))return[];try{const e=await L.get({url:`/guilds/${n}/messages/search`,query:{author_id:r,include_nsfw:!0}});return(((l=e?.body)==null?void 0:l.messages)||[]).map(function(a){return{id:a[0].id,content:a[0].content||"[No text]",channelId:a[0].channel_id,guildId:n,timestamp:a[0].timestamp}})}catch{return[]}}async function W(n){const r=N(n);if(r.length===0){p.showToast("No mutual servers",y.getAssetIDByName("Small"));return}p.showToast(`Searching ${r.length} servers...`,y.getAssetIDByName("ic_search"));let l=[];for(let e=0;e<Math.min(r.length,8);e++){const a=await J(r[e].id,n);l.push(...a),e<r.length-1&&await new Promise(function(b){return setTimeout(b,250)})}if(l.sort(function(e,a){return new Date(a.timestamp).getTime()-new Date(e.timestamp).getTime()}),p.showToast(`Found ${l.length} messages!`,y.getAssetIDByName("Check")),l.length>0){const e=l[0].content.substring(0,35);setTimeout(function(){return p.showToast(`Latest: "${e}..."`,y.getAssetIDByName("ic_message"))},1200)}}function re(n){var r;return((r=Y?.getChannel(n))==null?void 0:r.name)||"unknown"}function ne(n){var r;return((r=D?.getGuild(n))==null?void 0:r.name)||"Unknown"}function le(n){const r=R?.getUser(n);return r?{username:r.username,globalName:r.globalName,id:r.id}:null}function ae(n,r,l){var e;try{return(e=t.FluxDispatcher)==null||e.dispatch({type:"NAVIGATE_TO_JUMP_TO_MESSAGE",messageId:l,channelId:r,guildId:n}),!0}catch{}try{return q?.jumpToMessage({channelId:r,messageId:l,flash:!0}),!0}catch{}try{return z?.openURL(`discord://-/channels/${n}/${r}/${l}`),!0}catch{}return!1}function ie(){const[n,r]=t.React.useState(x),[l,e]=t.React.useState([]),[a,b]=t.React.useState(null),[i,k]=t.React.useState(null),[o,P]=t.React.useState([]),[c,h]=t.React.useState(!1),[g,v]=t.React.useState(""),T=async function(){if(!n||n.length<17){p.showToast("Invalid User ID",y.getAssetIDByName("Small"));return}h(!0),e([]),x=n;const d=le(n);b(d);const S=C(n);k(S);const I=N(n);if(P(I),I.length===0){p.showToast("No mutual servers",y.getAssetIDByName("Small")),h(!1);return}const U=[];for(let m=0;m<Math.min(I.length,12);m++){v(`${I[m].name} (${m+1}/${Math.min(I.length,12)})`);const M=await J(I[m].id,n);U.push(...M),await new Promise(function(ce){return setTimeout(ce,350)})}U.sort(function(m,M){return new Date(M.timestamp).getTime()-new Date(m.timestamp).getTime()}),e(U.slice(0,50)),p.showToast(`Found ${U.length} messages`,y.getAssetIDByName("Check")),h(!1),v("")},_=function(d){try{const S=new Date(d);return`${S.toLocaleDateString()} ${S.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}`}catch{return d}};return t.React.createElement(Q,{style:{flex:1,backgroundColor:"#1e1f22"}},[t.React.createElement(E,{key:"search",title:"\u{1F50D} USER SEARCH"},[t.React.createElement(K,{key:"in",title:"User ID",placeholder:"Enter Discord User ID",value:n,onChangeText:r,keyboardType:"numeric"}),t.React.createElement(s,{key:"btn",label:c?"\u23F3 Searching...":"\u{1F50D} Search All Servers",subLabel:c?g:"Find messages",onPress:c?void 0:T})]),a&&t.React.createElement(E,{key:"user",title:"\u{1F464} USER"},[t.React.createElement(s,{key:"n",label:a.globalName||a.username,subLabel:`@${a.username} \u2022 ${a.id}`}),i&&t.React.createElement(s,{key:"r",label:`${i.emoji} ${i.label}`,subLabel:i.isFriend?"You are friends":"Not friends"})]),o.length>0&&t.React.createElement(E,{key:"srv",title:`\u{1F3E0} SERVERS (${o.length})`},o.slice(0,15).map(function(d,S){return t.React.createElement(s,{key:`s${S}`,label:d.name})})),c&&t.React.createElement(X,{key:"load",style:{padding:20,alignItems:"center"}},[t.React.createElement(ee,{key:"sp",size:"large",color:"#5865f2"}),t.React.createElement(w,{key:"t",style:{color:"#b5bac1",marginTop:10}},g)]),!c&&l.length>0&&t.React.createElement(E,{key:"msgs",title:`\u{1F4AC} MESSAGES (${l.length})`},l.map(function(d,S){return t.React.createElement(Z,{key:`m${S}`,style:{padding:12,borderBottomWidth:1,borderBottomColor:"#3f4147",backgroundColor:"#2b2d31"},onPress:function(){p.showToast("Opening...",y.getAssetIDByName("Check")),ae(d.guildId,d.channelId,d.id)}},[t.React.createElement(w,{key:"c",style:{color:"#5865f2",fontSize:12}},`#${re(d.channelId)} \u2022 ${ne(d.guildId)}`),t.React.createElement(w,{key:"m",style:{color:"#f2f3f5",fontSize:14,marginVertical:3}},d.content.substring(0,120)),t.React.createElement(w,{key:"t",style:{color:"#949ba4",fontSize:11}},_(d.timestamp)+" \u2022 Tap to open")])})),t.React.createElement(E,{key:"dbg",title:"\u{1F527} DEBUG"},[t.React.createElement(s,{key:"d1",label:"RelationshipStore",subLabel:$?"\u2705":"\u274C"}),t.React.createElement(s,{key:"d2",label:"Profile Injection",subLabel:F})]),!c&&l.length===0&&t.React.createElement(E,{key:"help",title:"\u2139\uFE0F HELP"},[t.React.createElement(s,{key:"h1",label:"1. Copy User ID",subLabel:"Long-press user \u2192 Copy ID"}),t.React.createElement(s,{key:"h2",label:"2. Paste & Search",subLabel:"Enter ID above and tap Search"})])])}const ue=ie,se=function(){f.logger.log("=== Stalker Pro Loading ===");const n=u.findByProps("UserProfileSection");if(f.logger.log("UserProfileSection module:",!!n),f.logger.log("Has .default:",!!(n!=null&&n.default)),n&&n.default)try{const r=G.after("default",n,function(l,e){var a,b,i,k;try{const o=(a=l[0])==null?void 0:a.userId;if(!o)return e;const P=(b=R?.getCurrentUser)==null?void 0:b.call(R);if(P&&o===P.id)return e;if(!((i=e?.props)!=null&&i.children)||!Array.isArray(e.props.children))return f.logger.log("Profile: children not array, type:",typeof((k=e?.props)==null?void 0:k.children)),e;const c=C(o),h=N(o),g=t.React.createElement(E,{key:"stalker-pro",title:"\u{1F50D} Stalker Pro"},[c&&t.React.createElement(s,{key:"rel",label:`${c.emoji} ${c.label}`,subLabel:c.isFriend?"You are friends":"Not friends"}),t.React.createElement(V,{key:"d1"}),t.React.createElement(s,{key:"search",label:"\u{1F50E} Find Messages",subLabel:`${h.length} mutual servers`,trailing:s.Arrow?t.React.createElement(s.Arrow,null):null,onPress:function(){return W(o)}}),t.React.createElement(V,{key:"d2"}),t.React.createElement(s,{key:"srv",label:`\u{1F3E0} ${h.length} Mutual Servers`,subLabel:h.slice(0,2).map(function(v){return v.name}).join(", ")+(h.length>2?"...":"")})]);e.props.children.push(g),f.logger.log("Profile section injected for user:",o)}catch(o){f.logger.error("Injection error:",o)}return e});A.push(r),F="\u2705 Method 1: UserProfileSection.default",f.logger.log("Patch applied: UserProfileSection.default")}catch(r){f.logger.error("Failed to patch UserProfileSection.default:",r),F="\u274C Patch failed (Method 1)"}else{const r=[u.findByProps("default","UserProfileSection"),u.findByProps("UserProfile"),u.findByProps("ProfileBody"),u.findByProps("UserProfileBody")];let l=!1;for(const e of r)if(e!=null&&e.default)try{const a=G.after("default",e,function(b,i){var k,o,P,c,h;try{const g=((k=b[0])==null?void 0:k.userId)||((P=(o=b[0])==null?void 0:o.user)==null?void 0:P.id);if(!g)return i;const v=(c=R?.getCurrentUser)==null?void 0:c.call(R);if(v&&g===v.id||!((h=i?.props)!=null&&h.children))return i;Array.isArray(i.props.children)||(i.props.children=[i.props.children]);const T=C(g),_=N(g);i.props.children.push(t.React.createElement(E,{key:"stalker-pro",title:"\u{1F50D} Stalker Pro"},[T&&t.React.createElement(s,{key:"rel",label:`${T.emoji} ${T.label}`}),t.React.createElement(s,{key:"search",label:"\u{1F50E} Find Messages",onPress:function(){return W(g)}})]))}catch(g){f.logger.error("Alt injection error:",g)}return i});A.push(a),l=!0,F="\u2705 Alt method";break}catch{}l||(F="\u274C No module found",f.logger.warn("Could not find any profile module to patch"))}p.showToast("Stalker Pro ready!",y.getAssetIDByName("Check"))},oe=function(){f.logger.log("Stalker Pro unloading..."),A.forEach(function(n){try{n()}catch{}}),A=[]};return B.onLoad=se,B.onUnload=oe,B.settings=ue,B})({},vendetta,vendetta.metro,vendetta.metro.common,vendetta.ui.components,vendetta.ui.assets,vendetta.ui.toasts,vendetta.patcher);
