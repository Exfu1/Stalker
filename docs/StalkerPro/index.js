(function(L,y,R,e,q,u,d){"use strict";var J;const{FormSection:z,FormRow:B,FormInput:Q}=q.Forms,{ScrollView:oe,View:A,Text:s,TouchableOpacity:M}=q.General,C=R.findByStoreName("UserStore"),k=R.findByStoreName("GuildStore"),$=R.findByStoreName("GuildMemberStore"),p=R.findByStoreName("ChannelStore"),D=R.findByStoreName("SelectedGuildStore"),U=R.findByStoreName("PermissionStore"),G=R.findByProps("getChannels","getSelectableChannelIds"),I=((J=e.ReactNative)==null?void 0:J.Clipboard)||R.findByProps("setString","getString"),x=R.findByProps("getAPIBaseURL","get")||R.findByProps("API_HOST","get"),X=1024;let H=!1,Y="",O=null,Z=[],_=new Map;function ee(t){switch(t){case 0:return"\u{1F4AC}";case 2:return"\u{1F50A}";case 4:return"\u{1F4C1}";case 5:return"\u{1F4E2}";case 13:return"\u{1F3AD}";case 15:return"\u{1F4CB}";default:return"\u{1F4DD}"}}function ce(t){var l;if(!t||!U)return!1;try{return((l=U.can)==null?void 0:l.call(U,X,t))===!1}catch{return!1}}function te(t){var l,c;const a=[];try{if(G!=null&&G.getChannels){const n=G.getChannels(t);if(y.logger.log("getChannels result keys:",Object.keys(n||{})),n)for(const o of Object.keys(n)){const h=n[o];if(Array.isArray(h))for(const S of h){const g=S?.channel||S;g!=null&&g.id&&g?.guild_id===t&&a.push(g)}}}const r=((l=p?.getMutableGuildChannelsForGuild)==null?void 0:l.call(p,t))||((c=p?.getGuildChannels)==null?void 0:c.call(p,t))||{};for(const n of Object.values(r))n!=null&&n.id&&n?.guild_id===t&&(a.find(function(o){return o.id===n.id})||a.push(n));y.logger.log("Total channels from all methods:",a.length)}catch(r){y.logger.error("getAllGuildChannels error:",r)}return a}function ne(t){var l,c;const a=[];try{y.logger.log("=== SCANNING HIDDEN CHANNELS ==="),y.logger.log("GuildChannelStoreModule:",!!G),y.logger.log("PermissionStore:",!!U);const r=te(t);y.logger.log("All channels count:",r.length);for(const n of r)if(n!=null&&n.id&&n.type!==4&&!(n.type===1||n.type===3)&&!(n.type===11||n.type===12)&&ce(n)){const o=se(n,t);a.push({id:n.id,name:n.name||"unknown",type:n.type||0,parentName:n.parent_id&&((c=(l=p?.getChannel)==null?void 0:l.call(p,n.parent_id))==null?void 0:c.name)||"",rolesWithAccess:o})}y.logger.log("Hidden channels found:",a.length),_.set(t,a)}catch(r){y.logger.error("getHiddenChannels error:",r)}return a.sort(function(r,n){return r.name.localeCompare(n.name)})}function se(t,l){var c,a;const r=[];try{const n=t.permissionOverwrites||{},o=(c=k?.getGuild)==null?void 0:c.call(k,l);for(const[h,S]of Object.entries(n))if(S&&Number(S.allow||0)&X&&(S.type===0||S.type==="role")){const g=(a=o?.roles)==null?void 0:a[h];g&&g.name!=="@everyone"&&r.push({id:g.id,name:g.name,color:g.color||0})}}catch{}return r}function ue(t,l){var c;let a=_.get(t);a||(a=ne(t));const r=(c=$?.getMember)==null?void 0:c.call($,t,l);return r!=null&&r.roles?a.filter(function(n){return n.rolesWithAccess.some(function(o){return r.roles.includes(o.id)})}):[]}function de(t){if(!k||!$)return[];try{return Object.values(k.getGuilds()||{}).filter(function(l){return $.getMember(l.id,t)})}catch{return[]}}async function ge(t,l){var c;if(!(x!=null&&x.get))return[];try{const a=await x.get({url:`/guilds/${t}/messages/search`,query:{author_id:l,include_nsfw:!0,sort_by:"timestamp",sort_order:"desc"}});return(((c=a?.body)==null?void 0:c.messages)||[]).map(function(r){return{id:r[0].id,content:r[0].content||"[No text]",channelId:r[0].channel_id,guildId:t,timestamp:r[0].timestamp}})}catch{return[]}}function fe(t){var l;return((l=p?.getChannel(t))==null?void 0:l.name)||"unknown"}function ye(t){var l;return((l=k?.getGuild(t))==null?void 0:l.name)||"Unknown"}function he(t){const l=C?.getUser(t);return l?{username:l.username,globalName:l.globalName,id:l.id}:null}function Se(t){return t?/^\d{17,19}$/.test(t.trim()):!1}async function le(t){var l;const c=(l=C?.getCurrentUser)==null?void 0:l.call(C);if(c&&t===c.id)return;const a=de(t),r=he(t);if(a.length===0){d.showToast("\u274C No mutual servers",u.getAssetIDByName("Small"));return}const n=r?.globalName||r?.username||"User";d.showToast(`\u{1F50D} Searching ${n}...`,u.getAssetIDByName("ic_search"));let o=[];for(let b=0;b<Math.min(a.length,8);b++){try{const N=await ge(a[b].id,t);o.push(...N)}catch{}b<a.length-1&&await new Promise(function(N){return setTimeout(N,250)})}if(o.sort(function(b,N){return new Date(N.timestamp).getTime()-new Date(b.timestamp).getTime()}),o.length===0){d.showToast("\u{1F4ED} No messages found",u.getAssetIDByName("Small"));return}d.showToast(`\u2705 Found ${o.length} messages!`,u.getAssetIDByName("Check"));const h=o[0],S=fe(h.channelId);ye(h.guildId);const g=`https://discord.com/channels/${h.guildId}/${h.channelId}/${h.id}`,W=new Date(h.timestamp),F=Date.now()-W.getTime(),m=Math.floor(F/6e4),P=Math.floor(m/60),T=Math.floor(P/24);let j=m<60?`${m}m ago`:P<24?`${P}h ago`:`${T}d ago`;setTimeout(function(){d.showToast(`\u{1F4CD} #${S} (${j})`,u.getAssetIDByName("ic_message"))},1500),setTimeout(async function(){I!=null&&I.setString&&(I.setString(g),d.showToast("\u{1F4CB} Link copied!",u.getAssetIDByName("Check")))},3e3)}async function pe(){try{if(!(I!=null&&I.getString))return;const t=await I.getString();t&&t!==Y&&Se(t)&&(Y=t,d.showToast("\u{1F3AF} User ID detected!",u.getAssetIDByName("Check")),setTimeout(function(){return le(t.trim())},1e3))}catch{}}function be(){const[t,l]=e.React.useState("hidden"),[c,a]=e.React.useState([]),[r,n]=e.React.useState(!1),[o,h]=e.React.useState(null),[S,g]=e.React.useState(null),[W,F]=e.React.useState(""),[m,P]=e.React.useState(""),[T,j]=e.React.useState([]),[b,N]=e.React.useState(""),[re,ae]=e.React.useState(!1);e.React.useEffect(function(){ie()},[]);const ie=function(){var i,v;n(!0),F("Scanning...");try{const f=(i=D?.getGuildId)==null?void 0:i.call(D);if(f){const w=(v=k?.getGuild)==null?void 0:v.call(k,f);h(w);const E=ne(f);a(E);const V=te(f);F(`Total: ${V.length} | Hidden: ${E.length}`),E.length>0?d.showToast(`\u{1F512} Found ${E.length} hidden!`,u.getAssetIDByName("Check")):d.showToast("\u2728 No hidden channels",u.getAssetIDByName("Check"))}else h(null),a([]),F("No server selected"),d.showToast("Open a server first!",u.getAssetIDByName("Small"))}catch(f){y.logger.error("Scan error:",f),F(`Error: ${f}`)}finally{n(!1)}},me=async function(){if(!b||b.length<17){d.showToast("Enter valid User ID",u.getAssetIDByName("Small"));return}ae(!0),await le(b),ae(!1)},Ee=function(){var i,v;if(!m||m.length<17){d.showToast("Enter valid User ID",u.getAssetIDByName("Small"));return}const f=(i=D?.getGuildId)==null?void 0:i.call(D);if(!f){d.showToast("Open a server first!",u.getAssetIDByName("Small"));return}const w=ue(f,m);j(w);const E=(v=C?.getUser)==null?void 0:v.call(C,m),V=E?.globalName||E?.username||"User";d.showToast(`${V}: ${w.length} hidden`,u.getAssetIDByName("Check"))},Ae=function(i){return i?`#${i.toString(16).padStart(6,"0")}`:"#99AAB5"},K=function({id:i,label:v,icon:f}){return e.React.createElement(M,{style:{flex:1,padding:10,backgroundColor:t===i?"#5865F2":"#2b2d31",borderRadius:8,marginHorizontal:2},onPress:function(){return l(i)}},e.React.createElement(s,{style:{color:"#fff",textAlign:"center",fontSize:12,fontWeight:t===i?"bold":"normal"}},`${f} ${v}`))};return e.React.createElement(oe,{style:{flex:1,backgroundColor:"#1e1f22"}},[e.React.createElement(A,{key:"h",style:{padding:16,backgroundColor:"#2b2d31",marginBottom:8}},[e.React.createElement(s,{key:"t",style:{color:"#fff",fontSize:20,fontWeight:"bold",textAlign:"center"}},"\u{1F50D} Stalker Pro v3.2"),e.React.createElement(s,{key:"s",style:{color:"#b5bac1",fontSize:12,textAlign:"center",marginTop:4}},o?`\u{1F4CD} ${o.name}`:"Open a server to scan")]),e.React.createElement(A,{key:"tabs",style:{flexDirection:"row",padding:8,marginBottom:8}},[e.React.createElement(K,{key:"1",id:"hidden",label:"Hidden",icon:"\u{1F512}"}),e.React.createElement(K,{key:"2",id:"user",label:"User",icon:"\u{1F464}"}),e.React.createElement(K,{key:"3",id:"search",label:"Messages",icon:"\u{1F4AC}"})]),t==="hidden"&&[e.React.createElement(M,{key:"scan",style:{margin:12,padding:14,backgroundColor:"#5865F2",borderRadius:12,alignItems:"center"},onPress:ie},e.React.createElement(s,{style:{color:"#fff",fontWeight:"bold",fontSize:16}},r?"\u23F3 Scanning...":"\u{1F504} Scan Current Server")),e.React.createElement(s,{key:"debug",style:{color:"#949ba4",textAlign:"center",fontSize:11,marginBottom:8}},W),...c.map(function(i,v){return e.React.createElement(M,{key:`c${v}`,style:{margin:8,marginTop:4,padding:14,backgroundColor:"#2b2d31",borderRadius:12,borderLeftWidth:4,borderLeftColor:"#5865F2"},onPress:function(){return g(S===i.id?null:i.id)}},[e.React.createElement(A,{key:"h",style:{flexDirection:"row",alignItems:"center"}},[e.React.createElement(s,{key:"i",style:{fontSize:18,marginRight:10}},ee(i.type)),e.React.createElement(A,{key:"n",style:{flex:1}},[e.React.createElement(s,{key:"nm",style:{color:"#fff",fontSize:16,fontWeight:"bold"}},i.name),i.parentName&&e.React.createElement(s,{key:"p",style:{color:"#949ba4",fontSize:12}},`in ${i.parentName}`)]),e.React.createElement(s,{key:"a",style:{color:"#b5bac1"}},S===i.id?"\u25BC":"\u25B6")]),e.React.createElement(s,{key:"r",style:{color:"#00b894",fontSize:12,marginTop:6}},`\u{1F465} ${i.rolesWithAccess.length} roles`),S===i.id&&e.React.createElement(A,{key:"d",style:{marginTop:12,paddingTop:12,borderTopWidth:1,borderTopColor:"#3f4147"}},i.rolesWithAccess.length>0?i.rolesWithAccess.map(function(f,w){return e.React.createElement(s,{key:`r${w}`,style:{color:Ae(f.color),marginLeft:12,marginTop:2,fontSize:14}},`\u2022 ${f.name}`)}):[e.React.createElement(s,{key:"no",style:{color:"#949ba4",marginLeft:12}},"No role overwrites")])])}),c.length===0&&!r&&e.React.createElement(A,{key:"empty",style:{padding:30,alignItems:"center"}},[e.React.createElement(s,{key:"e1",style:{fontSize:40}},"\u2728"),e.React.createElement(s,{key:"e2",style:{color:"#fff",fontSize:16,marginTop:10}},o?"No hidden channels found":"Open a server first"),e.React.createElement(s,{key:"e3",style:{color:"#b5bac1",marginTop:4,textAlign:"center",fontSize:12}},"Make sure you're in a server with private channels")])],t==="user"&&[e.React.createElement(z,{key:"us",title:"\u{1F464} USER HIDDEN ACCESS"},[e.React.createElement(Q,{key:"in",title:"User ID",placeholder:"Enter User ID",value:m,onChangeText:P,keyboardType:"numeric"}),e.React.createElement(B,{key:"btn",label:"\u{1F50D} Check Access",subLabel:o?`In ${o.name}`:"Open server first",onPress:Ee})]),T.length>0&&e.React.createElement(z,{key:"res",title:`\u2705 Can access ${T.length} hidden:`},T.map(function(i,v){return e.React.createElement(B,{key:`uc${v}`,label:`${ee(i.type)} ${i.name}`,subLabel:i.parentName||void 0})})),T.length===0&&m.length>=17&&e.React.createElement(A,{key:"no",style:{padding:30,alignItems:"center"}},[e.React.createElement(s,{key:"n1",style:{fontSize:40}},"\u{1F6AB}"),e.React.createElement(s,{key:"n2",style:{color:"#fff",fontSize:16,marginTop:10}},"No hidden access")])],t==="search"&&[e.React.createElement(z,{key:"auto",title:"\u{1F4AC} MESSAGE SEARCH"},[e.React.createElement(B,{key:"a1",label:"\u{1F4CB} Auto-Detection",subLabel:H?"\u2705 Copy User ID to auto-search":"\u274C Inactive"}),e.React.createElement(B,{key:"a2",label:"\u23F1\uFE0F Most Recent First",subLabel:"Sorted by timestamp (newest)"})]),e.React.createElement(z,{key:"man",title:"\u{1F50D} MANUAL SEARCH"},[e.React.createElement(Q,{key:"in",title:"User ID",placeholder:"Enter Discord User ID",value:b,onChangeText:N,keyboardType:"numeric"}),e.React.createElement(B,{key:"btn",label:re?"\u23F3 Searching...":"\u{1F50D} Find Messages",onPress:re?void 0:me})])],e.React.createElement(A,{key:"ft",style:{padding:20,alignItems:"center"}},e.React.createElement(s,{style:{color:"#949ba4",fontSize:10,textAlign:"center"}},"\u{1F4A1} Copy User ID \u2192 auto-search"))])}const ve=be,Re=function(){y.logger.log("=== STALKER PRO v3.2 LOADING ==="),y.logger.log("GuildChannelStoreModule:",!!G),y.logger.log("PermissionStore:",!!U),I!=null&&I.getString&&(H=!0,O=setInterval(pe,2e3)),d.showToast("\u{1F50D} Stalker Pro v3.2 ready!",u.getAssetIDByName("Check"))},ke=function(){y.logger.log("=== STALKER PRO UNLOADING ==="),O&&(clearInterval(O),O=null,H=!1);for(const t of Z)try{t()}catch{}Z=[]};return L.onLoad=Re,L.onUnload=ke,L.settings=ve,L})({},vendetta,vendetta.metro,vendetta.metro.common,vendetta.ui.components,vendetta.ui.assets,vendetta.ui.toasts);
